/*
 * deCarta JavaScript Mapping API
 * Copyright 2006-2009 deCarta. All rights reserved.
 * version DDS 4.5.2
 *
 * Bundles:
 *   Raphael
 *   Project: http://raphaeljs.com/
 *   License: MIT License
 *
 *   Sarissa
 *   Project: http://dev.abiss.gr/sarissa/
 *   License: Apache 2.0
 *   License Location: http://dev.abiss.gr/sarissa/licenses/asl.txt
 */
/*
 * Raphael 1.2.4 - JavaScript Vector Library
 *
 * Copyright (c) 2008 - 2009 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
window.Raphael=(function(){var a=/[, ]+/,G=document,am=window,k={was:"Raphael" in am,is:am.Raphael},ai=function(){if(ai.is(arguments[0],"array")){var E=arguments[0],R=s[aL](ai,E.splice(0,3+ai.is(E[0],ag))),aQ=R.set();for(var aP=0,aR=E[l];aP<aR;aP++){var S=E[aP]||{};({circle:1,rect:1,path:1,ellipse:1,text:1,image:1})[M](S.type)&&aQ[d](R[S.type]().attr(S))}return aQ}return s[aL](ai,arguments)},aC="appendChild",aL="apply",aI="concat",al="",z=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup"],M="hasOwnProperty",ae=/^\[object\s+|\]$/gi,aq="join",l="length",aN="prototype",aO=String[aN].toLowerCase,f=Math.max,az=Math.min,ag="number",ar="toString",ao=Object[aN][ar],aG={},aD=Math.pow,d="push",aJ=/^(?=[\da-f]$)/,c=/^url\(['"]?([^\)]+)['"]?\)$/i,K=Math.round,ah=" ",r="setAttribute",u="split",Q=parseFloat,B=parseInt,aE=String[aN].toUpperCase,h={"clip-rect":"0 0 10e9 10e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},V={"clip-rect":"csv",cx:ag,cy:ag,fill:"colour","fill-opacity":ag,"font-size":ag,height:ag,opacity:ag,path:"path",r:ag,rotation:"csv",rx:ag,ry:ag,scale:"csv",stroke:"colour","stroke-opacity":ag,"stroke-width":ag,translation:"csv",width:ag,x:ag,y:ag},aF="replace";ai.version="1.2.4";ai.type=(am.SVGAngle||G.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");ai.svg=!(ai.vml=ai.type=="VML");ai._id=0;ai._oid=0;ai.fn={};ai.is=function(R,E){E=aO.call(E);return((E=="object"||E=="undefined")&&typeof R==E)||(R==null&&E=="null")||aO.call(ao.call(R)[aF](ae,al))==E};ai.setWindow=function(E){am=E;G=am.document};var au=function(R){if(ai.vml){var E=/^\s+|\s+$/g;au=ad(function(aR){var aS;aR=(aR+al).replace(E,al);try{var aP=new ActiveXObject("htmlfile");aP.write("<body>");aP.close();aS=aP.body}catch(aU){aS=createPopup().document.body}var aQ=aS.createTextRange();try{aS.style.color=aR;var aT=aQ.queryCommandValue("ForeColor");aT=((aT&255)<<16)|(aT&65280)|((aT&16711680)>>>16);return"#"+("000000"+aT[ar](16)).slice(-6)}catch(aU){return"none"}})}else{var S=G.createElement("i");S.className="Rapha\xebl Colour Picker";S.style.cssText="display:none";G.body[aC](S);au=ad(function(aP){S.style.color=aP;return G.defaultView.getComputedStyle(S,al).getPropertyValue("color")})}return au(R)};ai.hsb2rgb=ad(function(aU,aS,aY){if(ai.is(aU,"object")&&"h" in aU&&"s" in aU&&"b" in aU){aY=aU.b;aS=aU.s;aU=aU.h}var aP,aQ,aZ;if(aY==0){return{r:0,g:0,b:0,hex:"#000"}}if(aU>1||aS>1||aY>1){aU/=255;aS/=255;aY/=255}var aR=~~(aU*6),aV=(aU*6)-aR,S=aY*(1-aS),R=aY*(1-(aS*aV)),a0=aY*(1-(aS*(1-aV)));aP=[aY,R,S,S,a0,aY,aY][aR];aQ=[a0,aY,aY,R,S,S,a0][aR];aZ=[S,S,a0,aY,aY,R,S][aR];aP*=255;aQ*=255;aZ*=255;var aW={r:aP,g:aQ,b:aZ},E=(~~aP)[ar](16),aT=(~~aQ)[ar](16),aX=(~~aZ)[ar](16);E=E[aF](aJ,"0");aT=aT[aF](aJ,"0");aX=aX[aF](aJ,"0");aW.hex="#"+E+aT+aX;return aW},ai);ai.rgb2hsb=ad(function(E,R,aT){if(ai.is(E,"object")&&"r" in E&&"g" in E&&"b" in E){aT=E.b;R=E.g;E=E.r}if(ai.is(E,"string")){var aV=ai.getRGB(E);E=aV.r;R=aV.g;aT=aV.b}if(E>1||R>1||aT>1){E/=255;R/=255;aT/=255}var aS=f(E,R,aT),S=az(E,R,aT),aQ,aP,aR=aS;if(S==aS){return{h:0,s:0,b:aS}}else{var aU=(aS-S);aP=aU/aS;if(E==aS){aQ=(R-aT)/aU}else{if(R==aS){aQ=2+((aT-E)/aU)}else{aQ=4+((E-R)/aU)}}aQ/=6;aQ<0&&aQ++;aQ>1&&aQ--}return{h:aQ,s:aP,b:aR}},ai);var av=/,?([achlmqrstvxz]),?/gi;ai._path2string=function(){return this.join(",")[aF](av,"$1")};function A(aP,R,E){function S(){var aQ=Array[aN].slice.call(arguments,0),aS=aQ[aq]("\u25ba"),aR=S.cache=S.cache||{},aT=S.count=S.count||[];if(aR[M](aS)){return E?E(aR[aS]):aR[aS]}aT[l]>=1000&&delete aR[aT.shift()];aT[d](aS);aR[aS]=aP[aL](R,aQ);return E?E(aR[aS]):aR[aS]}return S}function ad(aP,R,E){function S(){var aR=Array[aN].slice.call(arguments,0);var aQ=aP[aL](R,aR);return E?E(aQ):aQ}return S}ai.getRGB=ad(function(E){if(!E||!!((E+al).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1}}E=E+al;if(E=="none"){return{r:-1,g:-1,b:-1,hex:"none"}}!({hs:1,rg:1})[M](E.substring(0,2))&&(E=au(E));var aR,S,aP,aU,aS=E.match(/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgb\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|rgb\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\)|hs[bl]\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|hs[bl]\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\))\s*$/i);if(aS){if(aS[2]){aU=B(aS[2].substring(5),16);aP=B(aS[2].substring(3,5),16);S=B(aS[2].substring(1,3),16)}if(aS[3]){aU=B(aS[3].substring(3)+aS[3].substring(3),16);aP=B(aS[3].substring(2,3)+aS[3].substring(2,3),16);S=B(aS[3].substring(1,2)+aS[3].substring(1,2),16)}if(aS[4]){aS=aS[4][u](/\s*,\s*/);S=Q(aS[0]);aP=Q(aS[1]);aU=Q(aS[2])}if(aS[5]){aS=aS[5][u](/\s*,\s*/);S=Q(aS[0])*2.55;aP=Q(aS[1])*2.55;aU=Q(aS[2])*2.55}if(aS[6]){aS=aS[6][u](/\s*,\s*/);S=Q(aS[0]);aP=Q(aS[1]);aU=Q(aS[2]);return ai.hsb2rgb(S,aP,aU)}if(aS[7]){aS=aS[7][u](/\s*,\s*/);S=Q(aS[0])*2.55;aP=Q(aS[1])*2.55;aU=Q(aS[2])*2.55;return ai.hsb2rgb(S,aP,aU)}aS={r:S,g:aP,b:aU};var R=(~~S)[ar](16),aQ=(~~aP)[ar](16),aT=(~~aU)[ar](16);R=R[aF](aJ,"0");aQ=aQ[aF](aJ,"0");aT=aT[aF](aJ,"0");aS.hex="#"+R+aQ+aT;return aS}return{r:-1,g:-1,b:-1,hex:"none",error:1}},ai);ai.getColor=function(R){var S=this.getColor.start=this.getColor.start||{h:0,s:1,b:R||0.75},E=this.hsb2rgb(S.h,S.s,S.b);S.h+=0.075;if(S.h>1){S.h=0;S.s-=0.2;S.s<=0&&(this.getColor.start={h:0,s:1,b:S.b})}return E.hex};ai.getColor.reset=function(){delete this.start};ai.parsePathString=ad(function(E){if(!E){return null}var S={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},R=[];if(ai.is(E,"array")&&ai.is(E[0],"array")){R=an(E)}if(!R[l]){(E+al)[aF](/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,function(aQ,aP,aT){var aS=[],aR=aO.call(aP);aT[aF](/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,function(aV,aU){aU&&aS[d](+aU)});while(aS[l]>=S[aR]){R[d]([aP][aI](aS.splice(0,S[aR])));if(!S[aR]){break}}})}R[ar]=ai._path2string;return R});var O=ad(function(aV){if(!aV){return{x:0,y:0,width:0,height:0}}aV=C(aV);var aS=0,aR=0,S=[],R=[];for(var aP=0,aU=aV[l];aP<aU;aP++){if(aV[aP][0]=="M"){aS=aV[aP][1];aR=aV[aP][2];S[d](aS);R[d](aR)}else{var aQ=at(aS,aR,aV[aP][1],aV[aP][2],aV[aP][3],aV[aP][4],aV[aP][5],aV[aP][6]);S=S[aI](aQ.min.x,aQ.max.x);R=R[aI](aQ.min.y,aQ.max.y)}}var E=az[aL](0,S),aT=az[aL](0,R);return{x:E,y:aT,width:f[aL](0,S)-E,height:f[aL](0,R)-aT}}),an=function(aR){var S=[];if(!ai.is(aR,"array")||!ai.is(aR&&aR[0],"array")){aR=ai.parsePathString(aR)}for(var R=0,aP=aR[l];R<aP;R++){S[R]=[];for(var E=0,aQ=aR[R][l];E<aQ;E++){S[R][E]=aR[R][E]}}S[ar]=ai._path2string;return S},Y=ad(function(aP){if(!ai.is(aP,"array")||!ai.is(aP&&aP[0],"array")){aP=ai.parsePathString(aP)}var aV=[],aX=0,aW=0,a0=0,aZ=0,S=0;if(aP[0][0]=="M"){aX=aP[0][1];aW=aP[0][2];a0=aX;aZ=aW;S++;aV[d](["M",aX,aW])}for(var aS=S,a1=aP[l];aS<a1;aS++){var E=aV[aS]=[],aY=aP[aS];if(aY[0]!=aO.call(aY[0])){E[0]=aO.call(aY[0]);switch(E[0]){case"a":E[1]=aY[1];E[2]=aY[2];E[3]=aY[3];E[4]=aY[4];E[5]=aY[5];E[6]=+(aY[6]-aX).toFixed(3);E[7]=+(aY[7]-aW).toFixed(3);break;case"v":E[1]=+(aY[1]-aW).toFixed(3);break;case"m":a0=aY[1];aZ=aY[2];default:for(var aR=1,aT=aY[l];aR<aT;aR++){E[aR]=+(aY[aR]-((aR%2)?aX:aW)).toFixed(3)}}}else{E=aV[aS]=[];if(aY[0]=="m"){a0=aY[1]+aX;aZ=aY[2]+aW}for(var aQ=0,R=aY[l];aQ<R;aQ++){aV[aS][aQ]=aY[aQ]}}var aU=aV[aS][l];switch(aV[aS][0]){case"z":aX=a0;aW=aZ;break;case"h":aX+=+aV[aS][aU-1];break;case"v":aW+=+aV[aS][aU-1];break;default:aX+=+aV[aS][aU-2];aW+=+aV[aS][aU-1]}}aV[ar]=ai._path2string;return aV},0,an),p=ad(function(aP){if(!ai.is(aP,"array")||!ai.is(aP&&aP[0],"array")){aP=ai.parsePathString(aP)}var aU=[],aW=0,aV=0,aZ=0,aY=0,S=0;if(aP[0][0]=="M"){aW=+aP[0][1];aV=+aP[0][2];aZ=aW;aY=aV;S++;aU[0]=["M",aW,aV]}for(var aS=S,a0=aP[l];aS<a0;aS++){var E=aU[aS]=[],aX=aP[aS];if(aX[0]!=aE.call(aX[0])){E[0]=aE.call(aX[0]);switch(E[0]){case"A":E[1]=aX[1];E[2]=aX[2];E[3]=aX[3];E[4]=aX[4];E[5]=aX[5];E[6]=+(aX[6]+aW);E[7]=+(aX[7]+aV);break;case"V":E[1]=+aX[1]+aV;break;case"H":E[1]=+aX[1]+aW;break;case"M":aZ=+aX[1]+aW;aY=+aX[2]+aV;default:for(var aR=1,aT=aX[l];aR<aT;aR++){E[aR]=+aX[aR]+((aR%2)?aW:aV)}}}else{for(var aQ=0,R=aX[l];aQ<R;aQ++){aU[aS][aQ]=aX[aQ]}}switch(E[0]){case"Z":aW=aZ;aV=aY;break;case"H":aW=E[1];break;case"V":aV=E[1];break;default:aW=aU[aS][aU[aS][l]-2];aV=aU[aS][aU[aS][l]-1]}}aU[ar]=ai._path2string;return aU},null,an),aM=function(R,aP,E,S){return[R,aP,E,S,E,S]},aB=function(R,aP,aS,aQ,E,S){var aR=1/3,aT=2/3;return[aR*R+aT*aS,aR*aP+aT*aQ,aR*E+aT*aS,aR*S+aT*aQ,E,S]},F=function(a0,bu,a9,a7,a1,aV,aQ,aZ,bt,a2){var aP=Math.PI,a6=aP*120/180,E=aP/180*(+a1||0),bd=[],ba,bq=ad(function(bw,bz,bv){var by=bw*Math.cos(bv)-bz*Math.sin(bv),bx=bw*Math.sin(bv)+bz*Math.cos(bv);return{x:by,y:bx}});if(!a2){ba=bq(a0,bu,-E);a0=ba.x;bu=ba.y;ba=bq(aZ,bt,-E);aZ=ba.x;bt=ba.y;var R=Math.cos(aP/180*a1),aX=Math.sin(aP/180*a1),bf=(a0-aZ)/2,be=(bu-bt)/2;a9=f(a9,Math.abs(bf));a7=f(a7,Math.abs(be));var S=a9*a9,bi=a7*a7,bk=(aV==aQ?-1:1)*Math.sqrt(Math.abs((S*bi-S*be*be-bi*bf*bf)/(S*be*be+bi*bf*bf))),a4=bk*a9*be/a7+(a0+aZ)/2,a3=bk*-a7*bf/a9+(bu+bt)/2,aU=Math.asin((bu-a3)/a7),aT=Math.asin((bt-a3)/a7);aU=a0<a4?aP-aU:aU;aT=aZ<a4?aP-aT:aT;aU<0&&(aU=aP*2+aU);aT<0&&(aT=aP*2+aT);if(aQ&&aU>aT){aU=aU-aP*2}if(!aQ&&aT>aU){aT=aT-aP*2}}else{aU=a2[0];aT=a2[1];a4=a2[2];a3=a2[3]}var aY=aT-aU;if(Math.abs(aY)>a6){var a5=aT,a8=aZ,aW=bt;aT=aU+a6*(aQ&&aT>aU?1:-1);aZ=a4+a9*Math.cos(aT);bt=a3+a7*Math.sin(aT);bd=F(aZ,bt,a9,a7,a1,0,aQ,a8,aW,[aT,a5,a4,a3])}aY=aT-aU;var aS=Math.cos(aU),bs=Math.sin(aU),aR=Math.cos(aT),br=Math.sin(aT),bg=Math.tan(aY/4),bj=4/3*a9*bg,bh=4/3*a7*bg,bp=[a0,bu],bo=[a0+bj*bs,bu-bh*aS],bn=[aZ+bj*br,bt-bh*aR],bl=[aZ,bt];bo[0]=2*bp[0]-bo[0];bo[1]=2*bp[1]-bo[1];if(a2){return[bo,bn,bl][aI](bd)}else{bd=[bo,bn,bl][aI](bd)[aq](",")[u](",");var bb=[];for(var bm=0,bc=bd[l];bm<bc;bm++){bb[bm]=bm%2?bq(bd[bm-1],bd[bm],E).y:bq(bd[bm],bd[bm+1],E).x}return bb}},H=ad(function(R,E,a4,a2,aR,aQ,aT,aS,aY){var aW=aD(1-aY,3)*R+aD(1-aY,2)*3*aY*a4+(1-aY)*3*aY*aY*aR+aD(aY,3)*aT,aU=aD(1-aY,3)*E+aD(1-aY,2)*3*aY*a2+(1-aY)*3*aY*aY*aQ+aD(aY,3)*aS,a0=R+2*aY*(a4-R)+aY*aY*(aR-2*a4+R),aZ=E+2*aY*(a2-E)+aY*aY*(aQ-2*a2+E),a3=a4+2*aY*(aR-a4)+aY*aY*(aT-2*aR+a4),a1=a2+2*aY*(aQ-a2)+aY*aY*(aS-2*aQ+a2),aX=(1-aY)*R+aY*a4,aV=(1-aY)*E+aY*a2,aP=(1-aY)*aR+aY*aT,S=(1-aY)*aQ+aY*aS;return{x:aW,y:aU,m:{x:a0,y:aZ},n:{x:a3,y:a1},start:{x:aX,y:aV},end:{x:aP,y:S}}}),at=ad(function(R,E,aP,S,a2,a1,aY,aV){var a0=(a2-2*aP+R)-(aY-2*a2+aP),aX=2*(aP-R)-2*(a2-aP),aU=R-aP,aS=(-aX+Math.sqrt(aX*aX-4*a0*aU))/2/a0,aQ=(-aX-Math.sqrt(aX*aX-4*a0*aU))/2/a0,aW=[E,aV],aZ=[R,aY],aT=H(R,E,aP,S,a2,a1,aY,aV,aS>0&&aS<1?aS:0),aR=H(R,E,aP,S,a2,a1,aY,aV,aQ>0&&aQ<1?aQ:0);aZ=aZ[aI](aT.x,aR.x);aW=aW[aI](aT.y,aR.y);a0=(a1-2*S+E)-(aV-2*a1+S);aX=2*(S-E)-2*(a1-S);aU=E-S;aS=(-aX+Math.sqrt(aX*aX-4*a0*aU))/2/a0;aQ=(-aX-Math.sqrt(aX*aX-4*a0*aU))/2/a0;aT=H(R,E,aP,S,a2,a1,aY,aV,aS>0&&aS<1?aS:0);aR=H(R,E,aP,S,a2,a1,aY,aV,aQ>0&&aQ<1?aQ:0);aZ=aZ[aI](aT.x,aR.x);aW=aW[aI](aT.y,aR.y);return{min:{x:az[aL](0,aZ),y:az[aL](0,aW)},max:{x:f[aL](0,aZ),y:f[aL](0,aW)}}}),C=ad(function(a0,aV){var aP=p(a0),aW=aV&&p(aV),aX={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},E={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},aR=function(a2,a3){var a1,a4;if(!a2){return["C",a3.x,a3.y,a3.x,a3.y,a3.x,a3.y]}!(a2[0] in {T:1,Q:1})&&(a3.qx=a3.qy=null);switch(a2[0]){case"M":a3.X=a2[1];a3.Y=a2[2];break;case"A":a2=["C"][aI](F[aL](0,[a3.x,a3.y][aI](a2.slice(1))));break;case"S":a1=a3.x+(a3.x-(a3.bx||a3.x));a4=a3.y+(a3.y-(a3.by||a3.y));a2=["C",a1,a4][aI](a2.slice(1));break;case"T":a3.qx=a3.x+(a3.x-(a3.qx||a3.x));a3.qy=a3.y+(a3.y-(a3.qy||a3.y));a2=["C"][aI](aB(a3.x,a3.y,a3.qx,a3.qy,a2[1],a2[2]));break;case"Q":a3.qx=a2[1];a3.qy=a2[2];a2=["C"][aI](aB(a3.x,a3.y,a2[1],a2[2],a2[3],a2[4]));break;case"L":a2=["C"][aI](aM(a3.x,a3.y,a2[1],a2[2]));break;case"H":a2=["C"][aI](aM(a3.x,a3.y,a2[1],a3.y));break;case"V":a2=["C"][aI](aM(a3.x,a3.y,a3.x,a2[1]));break;case"Z":a2=["C"][aI](aM(a3.x,a3.y,a3.X,a3.Y));break}return a2},R=function(a1,a2){if(a1[a2][l]>7){a1[a2].shift();var a3=a1[a2];while(a3[l]){a1.splice(a2++,0,["C"][aI](a3.splice(0,6)))}a1.splice(a2,1);aY=f(aP[l],aW&&aW[l]||0)}},S=function(a7,a6,a4,a3,a5){if(a7&&a6&&a7[a5][0]=="M"&&a6[a5][0]!="M"){a6.splice(a5,0,["M",a3.x,a3.y]);a4.bx=0;a4.by=0;a4.x=a7[a5][1];a4.y=a7[a5][2];aY=f(aP[l],aW&&aW[l]||0)}};for(var aT=0,aY=f(aP[l],aW&&aW[l]||0);aT<aY;aT++){aP[aT]=aR(aP[aT],aX);R(aP,aT);aW&&(aW[aT]=aR(aW[aT],E));aW&&R(aW,aT);S(aP,aW,aX,E,aT);S(aW,aP,E,aX,aT);var aS=aP[aT],aZ=aW&&aW[aT],aQ=aS[l],aU=aW&&aZ[l];aX.x=aS[aQ-2];aX.y=aS[aQ-1];aX.bx=Q(aS[aQ-4])||aX.x;aX.by=Q(aS[aQ-3])||aX.y;E.bx=aW&&(Q(aZ[aU-4])||E.x);E.by=aW&&(Q(aZ[aU-3])||E.y);E.x=aW&&aZ[aU-2];E.y=aW&&aZ[aU-1]}return aW?[aP,aW]:aP},null,an),n=ad(function(aU){var aT=[];for(var aQ=0,aV=aU[l];aQ<aV;aQ++){var E={},aS=aU[aQ].match(/^([^:]*):?([\d\.]*)/);E.color=ai.getRGB(aS[1]);if(E.color.error){return null}E.color=E.color.hex;aS[2]&&(E.offset=aS[2]+"%");aT[d](E)}for(var aQ=1,aV=aT[l]-1;aQ<aV;aQ++){if(!aT[aQ].offset){var R=Q(aT[aQ-1].offset||0),S=0;for(var aP=aQ+1;aP<aV;aP++){if(aT[aP].offset){S=aT[aP].offset;break}}if(!S){S=100;aP=aV}S=Q(S);var aR=(S-R)/(aP-aQ+1);for(;aQ<aP;aQ++){R+=aR;aT[aQ].offset=R+"%"}}}return aT}),aj=function(){var S,R,aQ,aP,E;if(ai.is(arguments[0],"string")||ai.is(arguments[0],"object")){if(ai.is(arguments[0],"string")){S=G.getElementById(arguments[0])}else{S=arguments[0]}if(S.tagName){if(arguments[1]==null){return{container:S,width:S.style.pixelWidth||S.offsetWidth,height:S.style.pixelHeight||S.offsetHeight}}else{return{container:S,width:arguments[1],height:arguments[2]}}}}else{if(ai.is(arguments[0],ag)&&arguments[l]>3){return{container:1,x:arguments[0],y:arguments[1],width:arguments[2],height:arguments[3]}}}},ax=function(E,S){var R=this;for(var aP in S){if(S[M](aP)&&!(aP in E)){switch(typeof S[aP]){case"function":(function(aQ){E[aP]=E===R?aQ:function(){return aQ[aL](R,arguments)}})(S[aP]);break;case"object":E[aP]=E[aP]||{};ax.call(this,E[aP],S[aP]);break;default:E[aP]=S[aP];break}}}},af=function(E,R){E==R.top&&(R.top=E.prev);E==R.bottom&&(R.bottom=E.next);E.next&&(E.next.prev=E.prev);E.prev&&(E.prev.next=E.next)},U=function(E,R){if(R.top===E){return}af(E,R);E.next=null;E.prev=R.top;R.top.next=E;R.top=E},j=function(E,R){if(R.bottom===E){return}af(E,R);E.next=R.bottom;E.prev=null;R.bottom.prev=E;R.bottom=E},v=function(R,E,S){af(R,S);E==S.top&&(S.top=R);E.next&&(E.next.prev=R);R.next=E.next;R.prev=E;E.next=R},ak=function(R,E,S){af(R,S);E==S.bottom&&(S.bottom=R);E.prev&&(E.prev.next=R);R.prev=E.prev;E.prev=R;R.next=E};if(ai.svg){aG.svgns="http://www.w3.org/2000/svg";aG.xlink="http://www.w3.org/1999/xlink";var K=function(E){return +E+(~~E===E)*0.5},P=function(aQ){for(var R=0,S=aQ[l];R<S;R++){if(aO.call(aQ[R][0])!="a"){for(var E=1,aP=aQ[R][l];E<aP;E++){aQ[R][E]=K(aQ[R][E])}}else{aQ[R][6]=K(aQ[R][6]);aQ[R][7]=K(aQ[R][7])}}return aQ},aA=function(S,E){if(E){for(var R in E){if(E[M](R)){S[r](R,E[R])}}}else{return G.createElementNS(aG.svgns,S)}};ai[ar]=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var o=function(E,aP){var R=aA("path");aP.canvas&&aP.canvas[aC](R);var S=new ap(R,aP);S.type="path";W(S,{fill:"none",stroke:"#000",path:E});return S};var b=function(S,aY,E){var aV="linear",aS=0.5,aQ=0.5,a0=S.style;aY=(aY+al)[aF](/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,function(a2,a1,a3){aV="radial";if(a1&&a3){aS=Q(a1);aQ=Q(a3);if(aD(aS-0.5,2)+aD(aQ-0.5,2)>0.25){aQ=Math.sqrt(0.25-aD(aS-0.5,2))+0.5}}return al});aY=aY[u](/\s*\-\s*/);if(aV=="linear"){var aR=aY.shift();aR=-Q(aR);if(isNaN(aR)){return null}var aP=[0,0,Math.cos(aR*Math.PI/180),Math.sin(aR*Math.PI/180)],aX=1/(f(Math.abs(aP[2]),Math.abs(aP[3]))||1);aP[2]*=aX;aP[3]*=aX;if(aP[2]<0){aP[0]=-aP[2];aP[2]=0}if(aP[3]<0){aP[1]=-aP[3];aP[3]=0}}var aU=n(aY);if(!aU){return null}var R=aA(aV+"Gradient");R.id="r"+(ai._id++)[ar](36);aV=="radial"?aA(R,{fx:aS,fy:aQ}):aA(R,{x1:aP[0],y1:aP[1],x2:aP[2],y2:aP[3]});E.defs[aC](R);for(var aT=0,aZ=aU[l];aT<aZ;aT++){var aW=aA("stop");aA(aW,{offset:aU[aT].offset?aU[aT].offset:!aT?"0%":"100%","stop-color":aU[aT].color||"#fff"});R[aC](aW)}aA(S,{fill:"url(#"+R.id+")",opacity:1,"fill-opacity":1});a0.fill=al;a0.opacity=1;a0.fillOpacity=1;return 1};var I=function(R){var E=R.getBBox();aA(R.pattern,{patternTransform:ai.format("translate({0},{1})",E.x,E.y)})};var W=function(aY,a7){var a1={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},a3=aY.node,aZ=aY.attrs,aV=aY.rotate(),aR=function(be,bd){bd=a1[aO.call(bd)];if(bd){var bb=be.attrs["stroke-width"]||"1",a9={round:bb,square:bb,butt:0}[be.attrs["stroke-linecap"]||a7["stroke-linecap"]]||0,bc=[];var ba=bd[l];while(ba--){bc[ba]=bd[ba]*bb+((ba%2)?1:-1)*a9}aA(a3,{"stroke-dasharray":bc[aq](",")})}};a7[M]("rotation")&&(aV=a7.rotation);var aU=(aV+al)[u](a);if(!(aU.length-1)){aU=null}else{aU[1]=+aU[1];aU[2]=+aU[2]}Q(aV)&&aY.rotate(0,true);for(var a2 in a7){if(a7[M](a2)){if(!h[M](a2)){continue}var a0=a7[a2];aZ[a2]=a0;switch(a2){case"rotation":aY.rotate(a0,true);break;case"href":case"title":case"target":var a5=a3.parentNode;if(aO.call(a5.tagName)!="a"){var aP=aA("a");a5.insertBefore(aP,a3);aP[aC](a3);a5=aP}a5.setAttributeNS(aY.paper.xlink,a2,a0);break;case"cursor":a3.style.cursor=a0;break;case"clip-rect":var R=(a0+al)[u](a);if(R[l]==4){aY.clip&&aY.clip.parentNode.parentNode.removeChild(aY.clip.parentNode);var S=aA("clipPath"),a4=aA("rect");S.id="r"+(ai._id++)[ar](36);aA(a4,{x:R[0],y:R[1],width:R[2],height:R[3]});S[aC](a4);aY.paper.defs[aC](S);aA(a3,{"clip-path":"url(#"+S.id+")"});aY.clip=a4}if(!a0){var a6=G.getElementById(a3.getAttribute("clip-path")[aF](/(^url\(#|\)$)/g,al));a6&&a6.parentNode.removeChild(a6);aA(a3,{"clip-path":al});delete aY.clip}break;case"path":if(a0&&aY.type=="path"){aZ.path=P(p(a0));aA(a3,{d:aZ.path})}break;case"width":a3[r](a2,a0);if(aZ.fx){a2="x";a0=aZ.x}else{break}case"x":if(aZ.fx){a0=-aZ.x-(aZ.width||0)}case"rx":if(a2=="rx"&&aY.type=="rect"){break}case"cx":aU&&(a2=="x"||a2=="cx")&&(aU[1]+=a0-aZ[a2]);a3[r](a2,K(a0));aY.pattern&&I(aY);break;case"height":a3[r](a2,a0);if(aZ.fy){a2="y";a0=aZ.y}else{break}case"y":if(aZ.fy){a0=-aZ.y-(aZ.height||0)}case"ry":if(a2=="ry"&&aY.type=="rect"){break}case"cy":aU&&(a2=="y"||a2=="cy")&&(aU[2]+=a0-aZ[a2]);a3[r](a2,K(a0));aY.pattern&&I(aY);break;case"r":if(aY.type=="rect"){aA(a3,{rx:a0,ry:a0})}else{a3[r](a2,a0)}break;case"src":if(aY.type=="image"){a3.setAttributeNS(aY.paper.xlink,"href",a0)}break;case"stroke-width":a3.style.strokeWidth=a0;a3[r](a2,a0);if(aZ["stroke-dasharray"]){aR(aY,aZ["stroke-dasharray"])}break;case"stroke-dasharray":aR(aY,a0);break;case"translation":var aS=(a0+al)[u](a);aS[0]=+aS[0]||0;aS[1]=+aS[1]||0;if(aU){aU[1]+=aS[0];aU[2]+=aS[1]}q.call(aY,aS[0],aS[1]);break;case"scale":var aS=(a0+al)[u](a);aY.scale(+aS[0]||1,+aS[1]||+aS[0]||1,+aS[2]||null,+aS[3]||null);break;case"fill":var aQ=(a0+al).match(c);if(aQ){var S=aA("pattern"),aX=aA("image");S.id="r"+(ai._id++)[ar](36);aA(S,{x:0,y:0,patternUnits:"userSpaceOnUse"});aA(aX,{x:0,y:0});aX.setAttributeNS(aY.paper.xlink,"href",aQ[1]);S[aC](aX);var a8=G.createElement("img");a8.style.cssText="position:absolute;left:-9999em;top-9999em";a8.onload=function(){aA(S,{width:this.offsetWidth,height:this.offsetHeight});aA(aX,{width:this.offsetWidth,height:this.offsetHeight});G.body.removeChild(this);aG.safari()};G.body[aC](a8);a8.src=aQ[1];aY.paper.defs[aC](S);a3.style.fill="url(#"+S.id+")";aA(a3,{fill:"url(#"+S.id+")"});aY.pattern=S;aY.pattern&&I(aY);break}if(!ai.getRGB(a0).error){delete a7.gradient;delete aZ.gradient;!ai.is(aZ.opacity,"undefined")&&ai.is(a7.opacity,"undefined")&&aA(a3,{opacity:aZ.opacity});!ai.is(aZ["fill-opacity"],"undefined")&&ai.is(a7["fill-opacity"],"undefined")&&aA(a3,{"fill-opacity":aZ["fill-opacity"]})}else{if((({circle:1,ellipse:1})[M](aY.type)||(a0+al).charAt()!="r")&&b(a3,a0,aY.paper)){aZ.gradient=a0;aZ.fill="none";break}}case"stroke":a3[r](a2,ai.getRGB(a0).hex);break;case"gradient":(({circle:1,ellipse:1})[M](aY.type)||(a0+al).charAt()!="r")&&b(a3,a0,aY.paper);break;case"opacity":case"fill-opacity":if(aZ.gradient){var E=G.getElementById(a3.getAttribute("fill")[aF](/^url\(#|\)$/g,al));if(E){var aT=E.getElementsByTagName("stop");aT[aT[l]-1][r]("stop-opacity",a0)}break}default:a2=="font-size"&&(a0=B(a0,10)+"px");var aW=a2[aF](/(\-.)/g,function(a9){return aE.call(a9.substring(1))});a3.style[aW]=a0;a3[r](a2,a0);break}}}y(aY,a7);if(aU){aY.rotate(aU.join(ah))}else{Q(aV)&&aY.rotate(aV,true)}};var g=1.2;var y=function(E,aP){if(E.type!="text"||!(aP[M]("text")||aP[M]("font")||aP[M]("font-size")||aP[M]("x")||aP[M]("y"))){return}var aU=E.attrs,R=E.node,aW=R.firstChild?B(G.defaultView.getComputedStyle(R.firstChild,al).getPropertyValue("font-size"),10):10;if(aP[M]("text")){aU.text=aP.text;while(R.firstChild){R.removeChild(R.firstChild)}var S=(aP.text+al)[u]("\n");for(var aQ=0,aV=S[l];aQ<aV;aQ++){if(S[aQ]){var aS=aA("tspan");aQ&&aA(aS,{dy:aW*g,x:aU.x});aS[aC](G.createTextNode(S[aQ]));R[aC](aS)}}}else{var S=R.getElementsByTagName("tspan");for(var aQ=0,aV=S[l];aQ<aV;aQ++){aQ&&aA(S[aQ],{dy:aW*g,x:aU.x})}}aA(R,{y:aU.y});var aR=E.getBBox(),aT=aU.y-(aR.y+aR.height/2);aT&&isFinite(aT)&&aA(R,{y:aU.y+aT})};var ap=function(R,E){var aP=0,S=0;this[0]=R;this.id=ai._oid++;this.node=R;R.raphael=this;this.paper=E;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!E.bottom&&(E.bottom=this);this.prev=E.top;E.top&&(E.top.next=this);E.top=this;this.next=null};ap[aN].rotate=function(R,E,aP){if(this.removed){return this}if(R==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][aq](ah)}return this._.rt.deg}var S=this.getBBox();R=(R+al)[u](a);if(R[l]-1){E=Q(R[1]);aP=Q(R[2])}R=Q(R[0]);if(E!=null){this._.rt.deg=R}else{this._.rt.deg+=R}(aP==null)&&(E=null);this._.rt.cx=E;this._.rt.cy=aP;E=E==null?S.x+S.width/2:E;aP=aP==null?S.y+S.height/2:aP;if(this._.rt.deg){this.transformations[0]=ai.format("rotate({0} {1} {2})",this._.rt.deg,E,aP);this.clip&&aA(this.clip,{transform:ai.format("rotate({0} {1} {2})",-this._.rt.deg,E,aP)})}else{this.transformations[0]=al;this.clip&&aA(this.clip,{transform:al})}aA(this.node,{transform:this.transformations[aq](ah)});return this};ap[aN].hide=function(){!this.removed&&(this.node.style.display="none");return this};ap[aN].show=function(){!this.removed&&(this.node.style.display="");return this};ap[aN].remove=function(){if(this.removed){return}af(this,this.paper);this.node.parentNode.removeChild(this.node);for(var E in this){delete this[E]}this.removed=true};ap[aN].getBBox=function(){if(this.removed){return this}if(this.type=="path"){return O(this.attrs.path)}if(this.node.style.display=="none"){this.show();var R=true}var aR={};try{aR=this.node.getBBox()}catch(aP){}finally{aR=aR||{}}if(this.type=="text"){aR={x:aR.x,y:Infinity,width:0,height:0};for(var E=0,S=this.node.getNumberOfChars();E<S;E++){var aQ=this.node.getExtentOfChar(E);(aQ.y<aR.y)&&(aR.y=aQ.y);(aQ.y+aQ.height-aR.y>aR.height)&&(aR.height=aQ.y+aQ.height-aR.y);(aQ.x+aQ.width-aR.x>aR.width)&&(aR.width=aQ.x+aQ.width-aR.x)}}R&&this.hide();return aR};ap[aN].attr=function(){if(this.removed){return this}if(arguments[l]==0){var aP={};for(var S in this.attrs){if(this.attrs[M](S)){aP[S]=this.attrs[S]}}return aP}if(arguments[l]==1&&ai.is(arguments[0],"string")){if(arguments[0]=="translation"){return q.call(this)}if(arguments[0]=="rotation"){return this.rotate()}if(arguments[0]=="scale"){return this.scale()}return this.attrs[arguments[0]]}if(arguments[l]==1&&ai.is(arguments[0],"array")){var E={};for(var R in arguments[0]){if(arguments[0][M](R)){E[arguments[0][R]]=this.attrs[arguments[0][R]]}}return E}if(arguments[l]==2){var aQ={};aQ[arguments[0]]=arguments[1];W(this,aQ)}else{if(arguments[l]==1&&ai.is(arguments[0],"object")){W(this,arguments[0])}}return this};ap[aN].toFront=function(){if(this.removed){return this}this.node.parentNode[aC](this.node);var E=this.paper;E.top!=this&&U(this,E);return this};ap[aN].toBack=function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);j(this,this.paper);var E=this.paper}return this};ap[aN].insertAfter=function(R){if(this.removed){return this}var E=this.paper,S=R.node;if(S.nextSibling){S.parentNode.insertBefore(this.node,S.nextSibling)}else{S.parentNode[aC](this.node)}v(this,R,this.paper);return this};ap[aN].insertBefore=function(E){if(this.removed){return this}var R=E.node;R.parentNode.insertBefore(this.node,R);ak(this,E,this.paper);return this};var L=function(R,E,aR,aQ){E=K(E);aR=K(aR);var aP=aA("circle");R.canvas&&R.canvas[aC](aP);var S=new ap(aP,R);S.attrs={cx:E,cy:aR,r:aQ,fill:"none",stroke:"#000"};S.type="circle";aA(aP,S.attrs);return S};var aw=function(S,E,aT,R,aR,aS){E=K(E);aT=K(aT);var aQ=aA("rect");S.canvas&&S.canvas[aC](aQ);var aP=new ap(aQ,S);aP.attrs={x:E,y:aT,width:R,height:aR,r:aS||0,rx:aS||0,ry:aS||0,fill:"none",stroke:"#000"};aP.type="rect";aA(aQ,aP.attrs);return aP};var ac=function(R,E,aS,aR,aQ){E=K(E);aS=K(aS);var aP=aA("ellipse");R.canvas&&R.canvas[aC](aP);var S=new ap(aP,R);S.attrs={cx:E,cy:aS,rx:aR,ry:aQ,fill:"none",stroke:"#000"};S.type="ellipse";aA(aP,S.attrs);return S};var m=function(S,aS,E,aT,R,aR){var aQ=aA("image");aA(aQ,{x:E,y:aT,width:R,height:aR,preserveAspectRatio:"none"});aQ.setAttributeNS(S.xlink,"href",aS);S.canvas&&S.canvas[aC](aQ);var aP=new ap(aQ,S);aP.attrs={x:E,y:aT,width:R,height:aR,src:aS};aP.type="image";return aP};var T=function(R,E,aR,aQ){var aP=aA("text");aA(aP,{x:E,y:aR,"text-anchor":"middle"});R.canvas&&R.canvas[aC](aP);var S=new ap(aP,R);S.attrs={x:E,y:aR,"text-anchor":"middle",text:aQ,font:h.font,stroke:"none",fill:"#000"};S.type="text";W(S,S.attrs);return S};var aK=function(R,E){this.width=R||this.width;this.height=E||this.height;this.canvas[r]("width",this.width);this.canvas[r]("height",this.height);return this};var s=function(){var aP=aj[aL](null,arguments),S=aP&&aP.container,R=aP.x,aT=aP.y,aQ=aP.width,E=aP.height;if(!S){throw new Error("SVG container not found.")}aG.canvas=aA("svg");var aS=aG.canvas;aG.width=aQ||512;aG.height=E||342;aS[r]("width",aG.width);aS[r]("height",aG.height);if(S==1){aS.style.cssText="position:absolute;left:"+R+"px;top:"+aT+"px";G.body[aC](aS)}else{if(S.firstChild){S.insertBefore(aS,S.firstChild)}else{S[aC](aS)}}S={canvas:aS};for(var aR in aG){if(aG[M](aR)){S[aR]=aG[aR]}}S.bottom=S.top=null;ax.call(S,S,ai.fn);S.clear();S.raphael=ai;return S};aG.clear=function(){var E=this.canvas;while(E.firstChild){E.removeChild(E.firstChild)}this.bottom=this.top=null;(this.desc=aA("desc"))[aC](G.createTextNode("Created with Rapha\xebl"));E[aC](this.desc);E[aC](this.defs=aA("defs"))};aG.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var E in this){delete this[E]}}}if(ai.vml){var ay=function(aZ){var aW=/[ahqtv]/ig,aR=p;(aZ+al).match(aW)&&(aR=C);aW=/[clmz]/g;if(aR==p&&!(aZ+al).match(aW)){var R={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},aP=/([clmz]),?([^clmz]*)/gi,aQ=/-?[^,\s-]+/g;var aV=(aZ+al)[aF](aP,function(a1,a3,a0){var a2=[];a0[aF](aQ,function(a4){a2[d](K(a4))});return R[a3]+a2});return aV}var aX=aR(aZ),S,aV=[],E;for(var aT=0,aY=aX[l];aT<aY;aT++){S=aX[aT];E=aO.call(aX[aT][0]);E=="z"&&(E="x");for(var aS=1,aU=S[l];aS<aU;aS++){E+=K(S[aS])+(aS!=aU-1?",":al)}aV[d](E)}return aV[aq](ah)};ai[ar]=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version};var o=function(E,aR){var aP=ab("group");aP.style.cssText="position:absolute;left:0;top:0;width:"+aR.width+"px;height:"+aR.height+"px";aP.coordsize=aR.coordsize;aP.coordorigin=aR.coordorigin;var S=ab("shape"),R=S.style;R.width=aR.width+"px";R.height=aR.height+"px";S.coordsize=this.coordsize;S.coordorigin=this.coordorigin;aP[aC](S);var aQ=new ap(S,aP,aR);aQ.isAbsolute=true;aQ.type="path";aQ.path=[];aQ.Path=al;E&&W(aQ,{fill:"none",stroke:"#000",path:E});aR.canvas[aC](aP);return aQ};var W=function(aV,a0){aV.attrs=aV.attrs||{};var aY=aV.node,a1=aV.attrs,aS=aY.style,aP,a5=aV;for(var aT in a0){if(a0[M](aT)){a1[aT]=a0[aT]}}a0.href&&(aY.href=a0.href);a0.title&&(aY.title=a0.title);a0.target&&(aY.target=a0.target);a0.cursor&&(aS.cursor=a0.cursor);if(a0.path&&aV.type=="path"){a1.path=a0.path;aY.path=ay(a1.path)}if(a0.rotation!=null){aV.rotate(a0.rotation,true)}if(a0.translation){aP=(a0.translation+al)[u](a);q.call(aV,aP[0],aP[1]);if(aV._.rt.cx!=null){aV._.rt.cx+=+aP[0];aV._.rt.cy+=+aP[1];aV.setBox(aV.attrs,aP[0],aP[1])}}if(a0.scale){aP=(a0.scale+al)[u](a);aV.scale(+aP[0]||1,+aP[1]||+aP[0]||1,+aP[2]||null,+aP[3]||null)}if("clip-rect" in a0){var E=(a0["clip-rect"]+al)[u](a);if(E[l]==4){E[2]=+E[2]+(+E[0]);E[3]=+E[3]+(+E[1]);var aU=aY.clipRect||G.createElement("div"),a4=aU.style,aR=aY.parentNode;a4.clip=ai.format("rect({1}px {2}px {3}px {0}px)",E);if(!aY.clipRect){a4.position="absolute";a4.top=0;a4.left=0;a4.width=aV.paper.width+"px";a4.height=aV.paper.height+"px";aR.parentNode.insertBefore(aU,aR);aU[aC](aR);aY.clipRect=aU}}if(!a0["clip-rect"]){aY.clipRect&&(aY.clipRect.style.clip=al)}}if(aV.type=="image"&&a0.src){aY.src=a0.src}if(aV.type=="image"&&a0.opacity){aY.filterOpacity=" progid:DXImageTransform.Microsoft.Alpha(opacity="+(a0.opacity*100)+")";aS.filter=(aY.filterMatrix||al)+(aY.filterOpacity||al)}a0.font&&(aS.font=a0.font);a0["font-family"]&&(aS.fontFamily='"'+a0["font-family"][u](",")[0][aF](/^['"]+|['"]+$/g,al)+'"');a0["font-size"]&&(aS.fontSize=a0["font-size"]);a0["font-weight"]&&(aS.fontWeight=a0["font-weight"]);a0["font-style"]&&(aS.fontStyle=a0["font-style"]);if(a0.opacity!=null||a0["stroke-width"]!=null||a0.fill!=null||a0.stroke!=null||a0["stroke-width"]!=null||a0["stroke-opacity"]!=null||a0["fill-opacity"]!=null||a0["stroke-dasharray"]!=null||a0["stroke-miterlimit"]!=null||a0["stroke-linejoin"]!=null||a0["stroke-linecap"]!=null){aY=aV.shape||aY;var aZ=(aY.getElementsByTagName("fill")&&aY.getElementsByTagName("fill")[0]),a2=false;!aZ&&(a2=aZ=ab("fill"));if("fill-opacity" in a0||"opacity" in a0){var R=((+a1["fill-opacity"]+1||2)-1)*((+a1.opacity+1||2)-1);R<0&&(R=0);R>1&&(R=1);aZ.opacity=R}a0.fill&&(aZ.on=true);if(aZ.on==null||a0.fill=="none"){aZ.on=false}if(aZ.on&&a0.fill){var S=a0.fill.match(c);if(S){aZ.src=S[1];aZ.type="tile"}else{aZ.color=ai.getRGB(a0.fill).hex;aZ.src=al;aZ.type="solid";if(ai.getRGB(a0.fill).error&&(a5.type in {circle:1,ellipse:1}||(a0.fill+al).charAt()!="r")&&b(a5,a0.fill)){a1.fill="none";a1.gradient=a0.fill}}}a2&&aY[aC](aZ);var aQ=(aY.getElementsByTagName("stroke")&&aY.getElementsByTagName("stroke")[0]),a3=false;!aQ&&(a3=aQ=ab("stroke"));if((a0.stroke&&a0.stroke!="none")||a0["stroke-width"]||a0["stroke-opacity"]!=null||a0["stroke-dasharray"]||a0["stroke-miterlimit"]||a0["stroke-linejoin"]||a0["stroke-linecap"]){aQ.on=true}(a0.stroke=="none"||aQ.on==null||a0.stroke==0||a0["stroke-width"]==0)&&(aQ.on=false);aQ.on&&a0.stroke&&(aQ.color=ai.getRGB(a0.stroke).hex);var R=((+a1["stroke-opacity"]+1||2)-1)*((+a1.opacity+1||2)-1),aW=(Q(a0["stroke-width"])||1)*0.75;R<0&&(R=0);R>1&&(R=1);a0["stroke-width"]==null&&(aW=a1["stroke-width"]);a0["stroke-width"]&&(aQ.weight=aW);aW&&aW<1&&(R*=aW)&&(aQ.weight=1);aQ.opacity=R;a0["stroke-linejoin"]&&(aQ.joinstyle=a0["stroke-linejoin"]||"miter");aQ.miterlimit=a0["stroke-miterlimit"]||8;a0["stroke-linecap"]&&(aQ.endcap=a0["stroke-linecap"]=="butt"?"flat":a0["stroke-linecap"]=="square"?"square":"round");if(a0["stroke-dasharray"]){var aX={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};aQ.dashstyle=aX[M](a0["stroke-dasharray"])?aX[a0["stroke-dasharray"]]:al}a3&&aY[aC](aQ)}if(a5.type=="text"){var aS=a5.paper.span.style;a1.font&&(aS.font=a1.font);a1["font-family"]&&(aS.fontFamily=a1["font-family"]);a1["font-size"]&&(aS.fontSize=a1["font-size"]);a1["font-weight"]&&(aS.fontWeight=a1["font-weight"]);a1["font-style"]&&(aS.fontStyle=a1["font-style"]);a5.node.string&&(a5.paper.span.innerHTML=(a5.node.string+al)[aF](/</g,"&#60;")[aF](/&/g,"&#38;")[aF](/\n/g,"<br>"));a5.W=a1.w=a5.paper.span.offsetWidth;a5.H=a1.h=a5.paper.span.offsetHeight;a5.X=a1.x;a5.Y=a1.y+K(a5.H/2);switch(a1["text-anchor"]){case"start":a5.node.style["v-text-align"]="left";a5.bbx=K(a5.W/2);break;case"end":a5.node.style["v-text-align"]="right";a5.bbx=-K(a5.W/2);break;default:a5.node.style["v-text-align"]="center";break}}};var b=function(E,aS){E.attrs=E.attrs||{};var aT=E.attrs,aV=E.node.getElementsByTagName("fill"),aQ="linear",aR=".5 .5";E.attrs.gradient=aS;aS=(aS+al)[aF](/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,function(aY,aZ,aX){aQ="radial";if(aZ&&aX){aZ=Q(aZ);aX=Q(aX);if(aD(aZ-0.5,2)+aD(aX-0.5,2)>0.25){aX=Math.sqrt(0.25-aD(aZ-0.5,2))+0.5}aR=aZ+ah+aX}return al});aS=aS[u](/\s*\-\s*/);if(aQ=="linear"){var R=aS.shift();R=-Q(R);if(isNaN(R)){return null}}var aP=n(aS);if(!aP){return null}E=E.shape||E.node;aV=aV[0]||ab("fill");if(aP[l]){aV.on=true;aV.method="none";aV.type=(aQ=="radial")?"gradientradial":"gradient";aV.color=aP[0].color;aV.color2=aP[aP[l]-1].color;var aW=[];for(var S=0,aU=aP[l];S<aU;S++){aP[S].offset&&aW[d](aP[S].offset+ah+aP[S].color)}aV.colors.value=aW[l]?aW[aq](","):"0% "+aV.color;if(aQ=="radial"){aV.focus="100%";aV.focussize=aR;aV.focusposition=aR}else{aV.angle=(270-R)%360}}return 1};var ap=function(aQ,aS,E){var aR=0,S=0,R=0,aP=1;this[0]=aQ;this.id=ai._oid++;this.node=aQ;aQ.raphael=this;this.X=0;this.Y=0;this.attrs={};this.Group=aS;this.paper=E;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!E.bottom&&(E.bottom=this);this.prev=E.top;E.top&&(E.top.next=this);E.top=this;this.next=null};ap[aN].rotate=function(R,E,S){if(this.removed){return this}if(R==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][aq](ah)}return this._.rt.deg}R=(R+al)[u](a);if(R[l]-1){E=Q(R[1]);S=Q(R[2])}R=Q(R[0]);if(E!=null){this._.rt.deg=R}else{this._.rt.deg+=R}S==null&&(E=null);this._.rt.cx=E;this._.rt.cy=S;this.setBox(this.attrs,E,S);this.Group.style.rotation=this._.rt.deg;return this};ap[aN].setBox=function(aQ,aR,aP){if(this.removed){return this}var R=this.Group.style,aS=(this.shape&&this.shape.style)||this.node.style;aQ=aQ||{};for(var aT in aQ){if(aQ[M](aT)){this.attrs[aT]=aQ[aT]}}aR=aR||this._.rt.cx;aP=aP||this._.rt.cy;var aW=this.attrs,aZ,aY,a0,aV;switch(this.type){case"circle":aZ=aW.cx-aW.r;aY=aW.cy-aW.r;a0=aV=aW.r*2;break;case"ellipse":aZ=aW.cx-aW.rx;aY=aW.cy-aW.ry;a0=aW.rx*2;aV=aW.ry*2;break;case"rect":case"image":aZ=+aW.x;aY=+aW.y;a0=aW.width||0;aV=aW.height||0;break;case"text":this.textpath.v=["m",K(aW.x),", ",K(aW.y-2),"l",K(aW.x)+1,", ",K(aW.y-2)][aq](al);aZ=aW.x-K(this.W/2);aY=aW.y-this.H/2;a0=this.W;aV=this.H;break;case"path":if(!this.attrs.path){aZ=0;aY=0;a0=this.paper.width;aV=this.paper.height}else{var aU=O(this.attrs.path);aZ=aU.x;aY=aU.y;a0=aU.width;aV=aU.height}break;default:aZ=0;aY=0;a0=this.paper.width;aV=this.paper.height;break}aR=(aR==null)?aZ+a0/2:aR;aP=(aP==null)?aY+aV/2:aP;var S=aR-this.paper.width/2,aX=aP-this.paper.height/2;if(this.type=="path"||this.type=="text"){(R.left!=S+"px")&&(R.left=S+"px");(R.top!=aX+"px")&&(R.top=aX+"px");this.X=this.type=="text"?aZ:-S;this.Y=this.type=="text"?aY:-aX;this.W=a0;this.H=aV;(aS.left!=-S+"px")&&(aS.left=-S+"px");(aS.top!=-aX+"px")&&(aS.top=-aX+"px")}else{(R.left!=S+"px")&&(R.left=S+"px");(R.top!=aX+"px")&&(R.top=aX+"px");this.X=aZ;this.Y=aY;this.W=a0;this.H=aV;(R.width!=this.paper.width+"px")&&(R.width=this.paper.width+"px");(R.height!=this.paper.height+"px")&&(R.height=this.paper.height+"px");(aS.left!=aZ-S+"px")&&(aS.left=aZ-S+"px");(aS.top!=aY-aX+"px")&&(aS.top=aY-aX+"px");(aS.width!=a0+"px")&&(aS.width=a0+"px");(aS.height!=aV+"px")&&(aS.height=aV+"px");var a1=(+aQ.r||0)/(az(a0,aV));if(this.type=="rect"&&this.arcsize!=a1&&(a1||this.arcsize)){var E=ab(a1?"roundrect":"rect");E.arcsize=a1;this.Group[aC](E);this.node.parentNode.removeChild(this.node);this.node=E;this.arcsize=a1;this.attr(this.attrs)}}};ap[aN].hide=function(){!this.removed&&(this.Group.style.display="none");return this};ap[aN].show=function(){!this.removed&&(this.Group.style.display="block");return this};ap[aN].getBBox=function(){if(this.removed){return this}if(this.type=="path"){return O(this.attrs.path)}return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}};ap[aN].remove=function(){if(this.removed){return}af(this,this.paper);this.node.parentNode.removeChild(this[0]);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var E in this){delete this[E]}this.removed=true};ap[aN].attr=function(){if(this.removed){return this}if(arguments[l]==0){var S={};for(var R in this.attrs){if(this.attrs[M](R)){S[R]=this.attrs[R]}}return S}if(arguments[l]==1&&ai.is(arguments[0],"string")){if(arguments[0]=="translation"){return q.call(this)}if(arguments[0]=="rotation"){return this.rotate()}if(arguments[0]=="scale"){return this.scale()}return this.attrs[arguments[0]]}if(this.attrs&&arguments[l]==1&&ai.is(arguments[0],"array")){var E={};for(var R=0,aP=arguments[0][l];R<aP;R++){E[arguments[0][R]]=this.attrs[arguments[0][R]]}return E}var aQ;if(arguments[l]==2){aQ={};aQ[arguments[0]]=arguments[1]}arguments[l]==1&&ai.is(arguments[0],"object")&&(aQ=arguments[0]);if(aQ){if(aQ.text&&this.type=="text"){this.node.string=aQ.text}W(this,aQ);if(aQ.gradient&&(({circle:1,ellipse:1})[M](this.type)||(aQ.gradient+al).charAt()!="r")){b(this,aQ.gradient)}(this.type!="path"||this._.rt.deg)&&this.setBox(this.attrs)}return this};ap[aN].toFront=function(){!this.removed&&this.Group.parentNode[aC](this.Group);this.paper.top!=this&&U(this,this.paper);return this};ap[aN].toBack=function(){if(this.removed){return this}if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);j(this,this.paper)}return this};ap[aN].insertAfter=function(E){if(this.removed){return this}if(E.Group.nextSibling){E.Group.parentNode.insertBefore(this.Group,E.Group.nextSibling)}else{E.Group.parentNode[aC](this.Group)}v(this,E,this.paper);return this};ap[aN].insertBefore=function(E){if(this.removed){return this}E.Group.parentNode.insertBefore(this.Group,E.Group);ak(this,E,this.paper);return this};var L=function(R,E,aT,aR){var aQ=ab("group"),aS=ab("oval"),S=aS.style;aQ.style.cssText="position:absolute;left:0;top:0;width:"+R.width+"px;height:"+R.height+"px";aQ.coordsize=R.coordsize;aQ.coordorigin=R.coordorigin;aQ[aC](aS);var aP=new ap(aS,aQ,R);aP.type="circle";W(aP,{stroke:"#000",fill:"none"});aP.attrs.cx=E;aP.attrs.cy=aT;aP.attrs.r=aR;aP.setBox({x:E-aR,y:aT-aR,width:aR*2,height:aR*2});R.canvas[aC](aQ);return aP};var aw=function(R,aT,aS,aU,aP,E){var aQ=ab("group"),S=ab(E?"roundrect":"rect"),aV=(+E||0)/(az(aU,aP));S.arcsize=aV;aQ.style.cssText="position:absolute;left:0;top:0;width:"+R.width+"px;height:"+R.height+"px";aQ.coordsize=R.coordsize;aQ.coordorigin=R.coordorigin;aQ[aC](S);var aR=new ap(S,aQ,R);aR.type="rect";W(aR,{stroke:"#000"});aR.arcsize=aV;aR.setBox({x:aT,y:aS,width:aU,height:aP,r:+E});R.canvas[aC](aQ);return aR};var ac=function(E,aU,aT,S,R){var aQ=ab("group"),aP=ab("oval"),aS=aP.style;aQ.style.cssText="position:absolute;left:0;top:0;width:"+E.width+"px;height:"+E.height+"px";aQ.coordsize=E.coordsize;aQ.coordorigin=E.coordorigin;aQ[aC](aP);var aR=new ap(aP,aQ,E);aR.type="ellipse";W(aR,{stroke:"#000"});aR.attrs.cx=aU;aR.attrs.cy=aT;aR.attrs.rx=S;aR.attrs.ry=R;aR.setBox({x:aU-S,y:aT-R,width:S*2,height:R*2});E.canvas[aC](aQ);return aR};var m=function(R,E,aU,aT,aV,aP){var aQ=ab("group"),S=ab("image"),aS=S.style;aQ.style.cssText="position:absolute;left:0;top:0;width:"+R.width+"px;height:"+R.height+"px";aQ.coordsize=R.coordsize;aQ.coordorigin=R.coordorigin;S.src=E;aQ[aC](S);var aR=new ap(S,aQ,R);aR.type="image";aR.attrs.src=E;aR.attrs.x=aU;aR.attrs.y=aT;aR.attrs.w=aV;aR.attrs.h=aP;aR.setBox({x:aU,y:aT,width:aV,height:aP});R.canvas[aC](aQ);return aR};var T=function(R,aU,aT,aV){var aQ=ab("group"),aP=ab("shape"),aS=aP.style,aW=ab("path"),E=aW.style,S=ab("textpath");aQ.style.cssText="position:absolute;left:0;top:0;width:"+R.width+"px;height:"+R.height+"px";aQ.coordsize=R.coordsize;aQ.coordorigin=R.coordorigin;aW.v=ai.format("m{0},{1}l{2},{1}",K(aU),K(aT),K(aU)+1);aW.textpathok=true;aS.width=R.width;aS.height=R.height;S.string=aV+al;S.on=true;aP[aC](S);aP[aC](aW);aQ[aC](aP);var aR=new ap(S,aQ,R);aR.shape=aP;aR.textpath=aW;aR.type="text";aR.attrs.text=aV;aR.attrs.x=aU;aR.attrs.y=aT;aR.attrs.w=1;aR.attrs.h=1;W(aR,{font:h.font,stroke:"none",fill:"#000"});aR.setBox();R.canvas[aC](aQ);return aR};var aK=function(S,E){var R=this.canvas.style;S==+S&&(S+="px");E==+E&&(E+="px");R.width=S;R.height=E;R.clip="rect(0 "+S+" "+E+" 0)";return this};G.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!G.namespaces.rvml&&G.namespaces.add("rvml","urn:schemas-microsoft-com:vml");var ab=function(E){return G.createElement("<rvml:"+E+' class="rvml">')}}catch(aa){var ab=function(E){return G.createElement("<"+E+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}var s=function(){var aP=aj[aL](null,arguments),R=aP.container,aV=aP.height,aW,S=aP.width,aU=aP.x,aT=aP.y;if(!R){throw new Error("VML container not found.")}var aR={},aS=aR.canvas=G.createElement("div"),aQ=aS.style;S=S||512;aV=aV||342;S==+S&&(S+="px");aV==+aV&&(aV+="px");aR.width=1000;aR.height=1000;aR.coordsize="1000 1000";aR.coordorigin="0 0";aR.span=G.createElement("span");aR.span.style.cssText="position:absolute;left:-9999px;top:-9999px;padding:0;margin:0;line-height:1;display:inline;";aS[aC](aR.span);aQ.cssText=ai.format("width:{0};height:{1};position:absolute;clip:rect(0 {0} {1} 0);overflow:hidden",S,aV);if(R==1){G.body[aC](aS);aQ.left=aU+"px";aQ.top=aT+"px";R={style:{width:S,height:aV}}}else{R.style.width=S;R.style.height=aV;if(R.firstChild){R.insertBefore(aS,R.firstChild)}else{R[aC](aS)}}for(var E in aG){if(aG[M](E)){aR[E]=aG[E]}}ax.call(aR,aR,ai.fn);aR.top=aR.bottom=null;aR.raphael=ai;return aR};aG.clear=function(){this.canvas.innerHTML=al;this.bottom=this.top=null};aG.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var E in this){delete this[E]}}}if({"Apple Computer, Inc.":1,"Google Inc.":1}[navigator.vendor]&&!(navigator.userAgent.indexOf("Version/4.0")+1)){aG.safari=function(){var E=this.rect(-99,-99,this.width+99,this.height+99);setTimeout(function(){E.remove()})}}else{aG.safari=function(){}}var Z=(function(){if(G.addEventListener){return function(aQ,S,R,E){var aP=function(aR){return R.call(E,aR)};aQ.addEventListener(S,aP,false);return function(){aQ.removeEventListener(S,aP,false);return true}}}else{if(G.attachEvent){return function(aR,aP,S,R){var aQ=function(aS){return S.call(R,aS||am.event)};aR.attachEvent("on"+aP,aQ);var E=function(){aR.detachEvent("on"+aP,aQ);return true};if(aP=="mouseover"){aR.attachEvent("onmouseenter",aQ);return function(){aR.detachEvent("onmouseenter",aQ);return E()}}else{if(aP=="mouseout"){aR.attachEvent("onmouseleave",aQ);return function(){aR.detachEvent("onmouseleave",aQ);return E()}}}return E}}}})();for(var X=z[l];X--;){(function(E){ap[aN][E]=function(R){if(ai.is(R,"function")){this.events=this.events||{};this.events[E]=this.events[E]||{};this.events[E][R]=this.events[E][R]||[];this.events[E][R][d](Z(this.shape||this.node,E,R,this))}return this};ap[aN]["un"+E]=function(R){var S=this.events;S&&S[E]&&S[E][R]&&S[E][R][l]&&S[E][R].shift()()&&!S[E][R][l]&&delete S[E][R];return this}})(z[X])}ap[aN].hover=function(R,E){return this.mouseover(R).mouseout(E)};aG.circle=function(E,S,R){return L(this,E||0,S||0,R||0)};aG.rect=function(E,aQ,R,S,aP){return aw(this,E||0,aQ||0,R||0,S||0,aP||0)};aG.ellipse=function(E,aP,S,R){return ac(this,E||0,aP||0,S||0,R||0)};aG.path=function(E){E&&!ai.is(E,"string")&&!ai.is(E[0],"array")&&(E+=al);return o(ai.format[aL](ai,arguments),this)};aG.image=function(aP,E,aQ,R,S){return m(this,aP||"about:blank",E||0,aQ||0,R||0,S||0)};aG.text=function(E,S,R){return T(this,E||0,S||0,R||al)};aG.set=function(E){arguments[l]>1&&(E=Array[aN].splice.call(arguments,0,arguments[l]));return new N(E)};aG.setSize=aK;ap[aN].scale=function(a0,aZ,S,R){if(a0==null&&aZ==null){return{x:this._.sx,y:this._.sy,toString:function(){return this.x+ah+this.y}}}aZ=aZ||a0;!+aZ&&(aZ=a0);var a4,a2,a3,a1,bg=this.attrs;if(a0!=0){var aX=this.getBBox(),aU=aX.x+aX.width/2,aQ=aX.y+aX.height/2,bf=a0/this._.sx,be=aZ/this._.sy;S=(+S||S==0)?S:aU;R=(+R||R==0)?R:aQ;var aW=~~(a0/Math.abs(a0)),aT=~~(aZ/Math.abs(aZ)),a7=this.node.style,bi=S+(aU-S)*bf,bh=R+(aQ-R)*be;switch(this.type){case"rect":case"image":var aV=bg.width*aW*bf,a6=bg.height*aT*be,aY=bg.r*az(bf,be),aS=bi-aV/2,aP=bh-a6/2;this.attr({width:aV,height:a6,x:aS,y:aP,r:aY});break;case"circle":case"ellipse":this.attr({rx:bg.rx*aW*bf,ry:bg.ry*aT*be,r:bg.r*az(aW*bf,aT*be),cx:bi,cy:bh});break;case"path":var a9=Y(bg.path),ba=true;for(var bd=0,a5=a9[l];bd<a5;bd++){var a8=a9[bd],bc,aR=aE.call(a8[0]);if(aR=="M"&&ba){continue}else{ba=false}if(ai.svg&&aR=="A"){a8[a9[bd][l]-2]*=bf;a8[a9[bd][l]-1]*=be;a8[1]*=aW*bf;a8[2]*=aT*be;a8[5]=+(aW+aT?!!+a8[5]:!+a8[5])}else{if(aR=="H"){for(bc=1,jj=a8[l];bc<jj;bc++){a8[bc]*=bf}}else{if(aR=="V"){for(bc=1,jj=a8[l];bc<jj;bc++){a8[bc]*=be}}else{for(bc=1,jj=a8[l];bc<jj;bc++){a8[bc]*=(bc%2)?bf:be}}}}}var E=O(a9),a4=bi-E.x-E.width/2,a2=bh-E.y-E.height/2;a9[0][1]+=a4;a9[0][2]+=a2;this.attr({path:a9});break}if(this.type in {text:1,image:1}&&(aW!=1||aT!=1)){if(this.transformations){this.transformations[2]="scale("[aI](aW,",",aT,")");this.node[r]("transform",this.transformations[aq](ah));a4=(aW==-1)?-bg.x-(aV||0):bg.x;a2=(aT==-1)?-bg.y-(a6||0):bg.y;this.attr({x:a4,y:a2});bg.fx=aW-1;bg.fy=aT-1}else{this.node.filterMatrix=" progid:DXImageTransform.Microsoft.Matrix(M11="[aI](aW,", M12=0, M21=0, M22=",aT,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");a7.filter=(this.node.filterMatrix||al)+(this.node.filterOpacity||al)}}else{if(this.transformations){this.transformations[2]=al;this.node[r]("transform",this.transformations[aq](ah));bg.fx=0;bg.fy=0}else{this.node.filterMatrix=al;a7.filter=(this.node.filterMatrix||al)+(this.node.filterOpacity||al)}}bg.scale=[a0,aZ,S,R][aq](ah);this._.sx=a0;this._.sy=aZ}return this};ai.easing_formulas={linear:function(E){return E},"<":function(E){return aD(E,3)},">":function(E){return aD(E-1,3)+1},"<>":function(E){E=E*2;if(E<1){return aD(E,3)/2}E-=2;return(aD(E,3)+2)/2},backIn:function(R){var E=1.70158;return R*R*((E+1)*R-E)},backOut:function(R){R=R-1;var E=1.70158;return R*R*((E+1)*R+E)+1},elastic:function(S){if(S==0||S==1){return S}var R=0.3,E=R/4;return aD(2,-10*S)*Math.sin((S-E)*(2*Math.PI)/R)+1},bounce:function(aP){var R=7.5625,S=2.75,E;if(aP<(1/S)){E=R*aP*aP}else{if(aP<(2/S)){aP-=(1.5/S);E=R*aP*aP+0.75}else{if(aP<(2.5/S)){aP-=(2.25/S);E=R*aP*aP+0.9375}else{aP-=(2.625/S);E=R*aP*aP+0.984375}}}return E}};var D={length:0},aH=function(){var aS=+new Date;for(var a3 in D){if(a3!="length"&&D[M](a3)){var a8=D[a3];if(a8.stop){delete D[a3];D[l]--;continue}var aQ=aS-a8.start,a1=a8.ms,a0=a8.easing,a4=a8.from,aX=a8.diff,R=a8.to,aW=a8.t,aZ=a8.prev||0,aR=a8.el,S=a8.callback,aY={},E;if(aQ<a1){var aP=ai.easing_formulas[a0]?ai.easing_formulas[a0](aQ/a1):aQ/a1;for(var a2 in a4){if(a4[M](a2)){switch(V[a2]){case"number":E=+a4[a2]+aP*a1*aX[a2];break;case"colour":E="rgb("+[w(K(a4[a2].r+aP*a1*aX[a2].r)),w(K(a4[a2].g+aP*a1*aX[a2].g)),w(K(a4[a2].b+aP*a1*aX[a2].b))][aq](",")+")";break;case"path":E=[];for(var a6=0,aV=a4[a2][l];a6<aV;a6++){E[a6]=[a4[a2][a6][0]];for(var a5=1,a7=a4[a2][a6][l];a5<a7;a5++){E[a6][a5]=+a4[a2][a6][a5]+aP*a1*aX[a2][a6][a5]}E[a6]=E[a6][aq](ah)}E=E[aq](ah);break;case"csv":switch(a2){case"translation":var aU=aX[a2][0]*(aQ-aZ),aT=aX[a2][1]*(aQ-aZ);aW.x+=aU;aW.y+=aT;E=aU+ah+aT;break;case"rotation":E=+a4[a2][0]+aP*a1*aX[a2][0];a4[a2][1]&&(E+=","+a4[a2][1]+","+a4[a2][2]);break;case"scale":E=[+a4[a2][0]+aP*a1*aX[a2][0],+a4[a2][1]+aP*a1*aX[a2][1],(2 in R[a2]?R[a2][2]:al),(3 in R[a2]?R[a2][3]:al)][aq](ah);break;case"clip-rect":E=[];var a6=4;while(a6--){E[a6]=+a4[a2][a6]+aP*a1*aX[a2][a6]}break}break}aY[a2]=E}}aR.attr(aY);aR._run&&aR._run.call(aR)}else{(aW.x||aW.y)&&aR.translate(-aW.x,-aW.y);R.scale&&(R.scale=R.scale+al);aR.attr(R);delete D[a3];D[l]--;aR.in_animation=null;ai.is(S,"function")&&S.call(aR)}a8.prev=aQ}}ai.svg&&aG.safari();D[l]&&setTimeout(aH)},w=function(E){return E>255?255:(E<0?0:E)},q=function(E,S){if(E==null){return{x:this._.tx,y:this._.ty}}this._.tx+=+E;this._.ty+=+S;switch(this.type){case"circle":case"ellipse":this.attr({cx:+E+this.attrs.cx,cy:+S+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+E+this.attrs.x,y:+S+this.attrs.y});break;case"path":var R=Y(this.attrs.path);R[0][1]+=+E;R[0][2]+=+S;this.attr({path:R});break}return this};ap[aN].animateWith=function(R,S,E,aQ,aP){D[R.id]&&(S.start=D[R.id].start);return this.animate(S,E,aQ,aP)};ap[aN].onAnimation=function(E){this._run=E||null;return this};ap[aN].animate=function(S,E,aV,a1){if(ai.is(aV,"function")||!aV){a1=aV||null}var aW={},aX={},aY={};for(var aU in S){if(S[M](aU)){if(V[M](aU)){aW[aU]=this.attr(aU);(aW[aU]==null)&&(aW[aU]=h[aU]);aX[aU]=S[aU];switch(V[aU]){case"number":aY[aU]=(aX[aU]-aW[aU])/E;break;case"colour":aW[aU]=ai.getRGB(aW[aU]);var aS=ai.getRGB(aX[aU]);aY[aU]={r:(aS.r-aW[aU].r)/E,g:(aS.g-aW[aU].g)/E,b:(aS.b-aW[aU].b)/E};break;case"path":var R=C(aW[aU],aX[aU]);aW[aU]=R[0];aX[aU]=R[1];aY[aU]=[];for(var aR=0,a0=aW[aU][l];aR<a0;aR++){aY[aU][aR]=[0];for(var aP=1,aT=aW[aU][aR][l];aP<aT;aP++){aY[aU][aR][aP]=(aX[aU][aR][aP]-aW[aU][aR][aP])/E}}break;case"csv":var aZ=(S[aU]+al)[u](a),aQ=(aW[aU]+al)[u](a);switch(aU){case"translation":aW[aU]=[0,0];aY[aU]=[aZ[0]/E,aZ[1]/E];break;case"rotation":aW[aU]=(aQ[1]==aZ[1]&&aQ[2]==aZ[2])?aQ:[0,aZ[1],aZ[2]];aY[aU]=[(aZ[0]-aW[aU][0])/E,0,0];break;case"scale":S[aU]=aZ;aW[aU]=(aW[aU]+al)[u](a);aY[aU]=[(aZ[0]-aW[aU][0])/E,(aZ[1]-aW[aU][1])/E,0,0];break;case"clip-rect":aW[aU]=(aW[aU]+al)[u](a);aY[aU]=[];var aR=4;while(aR--){aY[aU][aR]=(aZ[aR]-aW[aU][aR])/E}break}aX[aU]=aZ}}}}this.stop();this.in_animation=1;D[this.id]={start:S.start||+new Date,ms:E,easing:aV,from:aW,diff:aY,to:aX,el:this,callback:a1,t:{x:0,y:0}};++D[l]==1&&aH();return this};ap[aN].stop=function(){D[this.id]&&D[l]--;delete D[this.id];return this};ap[aN].translate=function(E,R){return this.attr({translation:E+" "+R})};ap[aN][ar]=function(){return"Rapha\xebl\u2019s object"};ai.ae=D;var N=function(E){this.items=[];this[l]=0;if(E){for(var R=0,S=E[l];R<S;R++){if(E[R]&&(E[R].constructor==ap||E[R].constructor==N)){this[this.items[l]]=this.items[this.items[l]]=E[R];this[l]++}}}};N[aN][d]=function(){var aP,E;for(var R=0,S=arguments[l];R<S;R++){aP=arguments[R];if(aP&&(aP.constructor==ap||aP.constructor==N)){E=this.items[l];this[E]=this.items[E]=aP;this[l]++}}return this};N[aN].pop=function(){delete this[this[l]--];return this.items.pop()};for(var t in ap[aN]){if(ap[aN][M](t)){N[aN][t]=(function(E){return function(){for(var R=0,S=this.items[l];R<S;R++){this.items[R][E][aL](this.items[R],arguments)}return this}})(t)}}N[aN].attr=function(R,aR){if(R&&ai.is(R,"array")&&ai.is(R[0],"object")){for(var E=0,aQ=R[l];E<aQ;E++){this.items[E].attr(R[E])}}else{for(var S=0,aP=this.items[l];S<aP;S++){this.items[S].attr[aL](this.items[S],arguments)}}return this};N[aN].animate=function(aQ,R,aT,aS){(ai.is(aT,"function")||!aT)&&(aS=aT||null);var E=this.items[l],S=E,aR=this,aP;aS&&(aP=function(){!--E&&aS.call(aR)});this.items[--S].animate(aQ,R,aT||aP,aP);while(S--){this.items[S].animateWith(this.items[E-1],aQ,R,aT||aP,aP)}return this};N[aN].insertAfter=function(R){var E=this.items[l];while(E--){this.items[E].insertAfter(R)}};N[aN].getBBox=function(){var E=[],aR=[],R=[],aP=[];for(var S=this.items[l];S--;){var aQ=this.items[S].getBBox();E[d](aQ.x);aR[d](aQ.y);R[d](aQ.x+aQ.width);aP[d](aQ.y+aQ.height)}E=az[aL](0,E);aR=az[aL](0,aR);return{x:E,y:aR,width:f[aL](0,R)-E,height:f[aL](0,aP)-aR}};ai.registerFont=function(R){if(!R.face){return R}this.fonts=this.fonts||{};var aP={w:R.w,face:{},glyphs:{}},S=R.face["font-family"];for(var aS in R.face){if(R.face[M](aS)){aP.face[aS]=R.face[aS]}}if(this.fonts[S]){this.fonts[S][d](aP)}else{this.fonts[S]=[aP]}if(!R.svg){aP.face["units-per-em"]=B(R.face["units-per-em"],10);for(var aQ in R.glyphs){if(R.glyphs[M](aQ)){var aR=R.glyphs[aQ];aP.glyphs[aQ]={w:aR.w,k:{},d:aR.d&&"M"+aR.d[aF](/[mlcxtrv]/g,function(aT){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[aT]||"M"})+"z"};if(aR.k){for(var E in aR.k){if(aR[M](E)){aP.glyphs[aQ].k[E]=aR.k[E]}}}}}}return R};aG.getFont=function(aT,aU,R,aP){aP=aP||"normal";R=R||"normal";aU=+aU||{normal:400,bold:700,lighter:300,bolder:800}[aU]||400;var aQ=ai.fonts[aT];if(!aQ){var S=new RegExp("(^|\\s)"+aT[aF](/[^\w\d\s+!~.:_-]/g,al)+"(\\s|$)","i");for(var E in ai.fonts){if(ai.fonts[M](E)){if(S.test(E)){aQ=ai.fonts[E];break}}}}var aR;if(aQ){for(var aS=0,aV=aQ[l];aS<aV;aS++){aR=aQ[aS];if(aR.face["font-weight"]==aU&&(aR.face["font-style"]==R||!aR.face["font-style"])&&aR.face["font-stretch"]==aP){break}}}return aR};aG.print=function(aP,S,E,aS,aT,a2){a2=a2||"middle";var aY=this.set(),a1=(E+al)[u](al),aZ=0,aV=al,a3;ai.is(aS,"string")&&(aS=this.getFont(aS));if(aS){a3=(aT||16)/aS.face["units-per-em"];var R=aS.face.bbox.split(a),aR=+R[0],aU=+R[1]+(a2=="baseline"?R[3]-R[1]+(+aS.face.descent):(R[3]-R[1])/2);for(var aX=0,aQ=a1[l];aX<aQ;aX++){var aW=aX&&aS.glyphs[a1[aX-1]]||{},a0=aS.glyphs[a1[aX]];aZ+=aX?(aW.w||aS.w)+(aW.k&&aW.k[a1[aX]]||0):0;a0&&a0.d&&aY[d](this.path(a0.d).attr({fill:"#000",stroke:"none",translation:[aZ,0]}))}aY.scale(a3,a3,aR,aU).translate(aP-aR,S-aU)}return aY};ai.format=function(S){var R=ai.is(arguments[1],"array")?[0][aI](arguments[1]):arguments,E=/\{(\d+)\}/g;S&&ai.is(S,"string")&&R[l]-1&&(S=S[aF](E,function(aQ,aP){return R[++aP]==null?al:R[aP]}));return S||al};ai.ninja=function(){var R=am.Raphael,E;if(k.was){am.Raphael=k.is}else{try{delete am.Raphael}catch(S){am.Raphael=E}}return R};ai.el=ap[aN];return ai})();function SarissaMediaWikiContext(b,a){this.baseUrl=b;this.format="json";this.languages=a}SarissaMediaWikiContext.prototype.doArticleGet=function(b,a){Sarissa.setRemoteJsonCallback(this.baseUrl+"?action=parse&redirects&format="+this.format+"&page"+encodeURIComponent(b),a)};SarissaMediaWikiContext.prototype.doBacklinksGet=function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?&generator=backlinks&format="+this.format+"&gbllimit="+a+"&gbltitle"+encodeURIComponent(c),b)};SarissaMediaWikiContext.prototype.doSearch=function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?action=query&list=search&srsearch="+encodeURIComponent(c)+"&srwhat=text&srnamespace=0&format="+this.format+"&srlimit="+a,b)};SarissaMediaWikiContext.prototype.doCategorySearch=function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?format="+this.format+"&list=categorymembers&action=query&cmlimit="+a+"&cmtitle=Category:"+encodeURIComponent(c),b)};SarissaMediaWikiContext.prototype.doArticleCategoriesGet=function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?format="+this.format+"&action=query&prop=categories&titles="+encodeURIComponent(c),b)};Sarissa.sortHtmlTableData=function(q,h,s,r){var l=q.parentNode.parentNode;while(l.nodeName.toLowerCase()!="table"){l=l.parentNode}if(!l.id){l.id="SarissaTable"+(Sarissa.tableIdGenCount++)}var a=q.cellIndex;var o;if(!s&&Sarissa.tableDataCache[l.id]){o=Sarissa.tableDataCache[l.id]}else{o=this.getArrayFromTableData(l,null,null,"th");if(!s){Sarissa.tableDataCache[l.id]=o}}if(!Sarissa.tableColumnSortStates[l.id]){Sarissa.tableColumnSortStates[l.id]=[]}var f=[];for(var g=0;g<o.length;g++){f[g]=Sarissa.stripTags(o[g][a])+"_mbns_"+g}if(h){f.sort(h)}else{f.sort()}var b=Sarissa.tableColumnSortStates[l.id][a];if(b!="asc"){Sarissa.tableColumnSortStates[l.id][a]="asc"}else{f.reverse();Sarissa.tableColumnSortStates[l.id][a]="desc"}var p=[];for(var d=0;d<o.length;d++){var n=f[d];var m=n.substring(n.indexOf("_mbns_")+6,n.length);p[d]=[];for(var c=0;c<o[d].length;c++){p[d][c]=o[m][c]}}this.updateTableData(l,p,null,null,"th");if(r){r(l,a)}};Sarissa.tableIdGenCount=0;Sarissa.tableColumnSortStates=[];Sarissa.tableDataCache=[];Sarissa.tableDataCacheSize=0;Sarissa.tableDataCacheMaxSize=5;Sarissa.tableDataCachePut=function(b,a){if(Sarissa.tableDataCacheSize.length>=Sarissa.tableDataCacheMaxSize){Sarissa.tableDataCache.shift();Sarissa.tableDataCacheSize--}Sarissa.tableDataCache[b]=a;Sarissa.tableDataCacheSize++};Sarissa.tableDataCacheMoveColumn=function(a,d,b){var k=Sarissa.tableDataCache[a];var l=[];var g,h,m;for(var f=0;f<k.length;f++){g=k[f];h=g.splice(d,1);m=[];for(var c=0;c<oldArr.length;J++){if(c==b){m.put(h)}m.put(g[c])}l[f]=m}Sarissa.tableDataCache[a]=l};Sarissa.SORT_IGNORE_CASE=function(f,c){var g=f.toLowerCase(),d=c.toLowerCase();if(g<d){return -1}else{if(g>d){return 1}else{return 0}}};Sarissa.SORT_DATE_US=function(d,c){var g=new Date(d.substring(0,d.lastIndexOf("_mbns_"))),f=new Date(c.substring(0,c.lastIndexOf("_mbns_")));if(g<f){return -1}else{if(g>f){return 1}else{return 0}}};Sarissa.SORT_DATE_EU=function(f,c){var g=f.substring(0,f.lastIndexOf("_mbns_")).split("/"),d=c.substring(0,c.lastIndexOf("_mbns_")).split("/"),j=new Date(g[2],g[1],g[0]),h=new Date(d[2],d[1],d[0]);if(j<h){return -1}else{if(j>h){return 1}else{return 0}}};Sarissa.getArrayFromTableData=function(n,h,f,d,l){if(!h){h="tr"}if(!f){f="td"}if(!d){d="th"}var p=n.getElementsByTagName(h);var g=[];for(var c=0,b=0;c<p.length;c++){var o=p[c];if((!d)||o.getElementsByTagName(d).length==0){g[b]=[];var m=o.getElementsByTagName(f);for(var a=0;a<m.length;a++){g[b][a]=l?Sarissa.stripTags(m[a].innerHTML):m[a].innerHTML}b++}}return g};Sarissa.updateTableData=function(l,o,g,f,d){if(!g){g="tr"}if(!f){f="td"}var n=l.getElementsByTagName(g);for(var c=0,b=0;c<o.length&&b<n.length;b++){var m=n[b];if((!d)||m.getElementsByTagName(d).length==0){var h=m.getElementsByTagName(f);for(var a=0;a<h.length;a++){h[a].innerHTML=o[c][a]}c++}}};function Sarissa(){}Sarissa.VERSION="0.9.9.5";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null}if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document}if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(f){var d=false,h;var g;for(var b=0;b<f.length&&!d;b++){try{var a=new ActiveXObject(f[b]);g=f[b];d=true}catch(c){h=c}}if(!d){throw"Could not retrieve a valid progID of Class: "+f[f.length-1]+". (original exception: "+h+")"}f=null;return g};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest=function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"])}return new ActiveXObject(_SARISSA_XMLHTTP_PROGID)};Sarissa.getDomDocument=function(f,d){if(!_SARISSA_DOM_PROGID){try{_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"])}catch(c){_SARISSA_DOM_PROGID="noActiveX"}}var a=_SARISSA_DOM_PROGID=="noActiveX"?document.createElement("xml"):new ActiveXObject(_SARISSA_DOM_PROGID);try{a.validateOnParse=false;a.resolveExternals="false";a.setProperty("ProhibitDTD",false)}catch(c){}if(d){var b="";if(f){if(d.indexOf(":")>1){b=d.substring(0,d.indexOf(":"));d=d.substring(d.indexOf(":")+1)}else{b="a"+Sarissa._getUniqueSuffix()}}if(f){a.loadXML("<"+b+":"+d+" xmlns:"+b+'="'+f+'" />')}else{a.loadXML("<"+d+" />")}}return a};Sarissa.getParseErrorText=function(a){var c=Sarissa.PARSED_OK;if(a&&a.parseError&&a.parseError.errorCode&&a.parseError.errorCode!=0){c="XML Parsing Error: "+a.parseError.reason+"\nLocation: "+a.parseError.url+"\nLine Number "+a.parseError.line+", Column "+a.parseError.linepos+":\n"+a.parseError.srcText+"\n";for(var b=0;b<a.parseError.linepos;b++){c+="-"}c+="^\n"}else{if(a.documentElement===null){c=Sarissa.PARSED_EMPTY}}return c};Sarissa.setXpathNamespaces=function(a,b){a.setProperty("SelectionLanguage","XPath");a.setProperty("SelectionNamespaces",b)};XSLTProcessor=function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"])}this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null};XSLTProcessor.prototype.importStylesheet=function(d){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"])}d.setProperty("SelectionLanguage","XPath");d.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var c=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{c.resolveExternals=true;c.setProperty("AllowDocumentFunction",true);c.setProperty("AllowXsltScript",true)}catch(b){}if(d.url&&d.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){c.async=false;c.load(d.url)}else{c.loadXML(d.xml)}c.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var a=c.selectSingleNode("//xsl:output");if(a){this.outputMethod=a.getAttribute("method")}else{delete this.outputMethod}this.template.stylesheet=c;this.processor=this.template.createProcessor();this.paramsSet=[]};XSLTProcessor.prototype.transformToDocument=function(c){var b;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=c;b=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=b;this.processor.transform();return b}else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"])}this.processor.input=c;b=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=b;this.processor.transform();var a=new ActiveXObject(_SARISSA_DOM_PROGID);a.loadXML(b.output+"");return a}};XSLTProcessor.prototype.transformToFragment=function(j,d){this.processor.input=j;this.processor.transform();var g=this.processor.output;var h=d.createDocumentFragment();var b;if(this.outputMethod=="text"){h.appendChild(d.createTextNode(g))}else{if(d.body&&d.body.innerHTML){b=d.createElement("div");b.innerHTML=g;while(b.hasChildNodes()){h.appendChild(b.firstChild)}}else{var a=new ActiveXObject(_SARISSA_DOM_PROGID);if(g.substring(0,5)=="<?xml"){g=g.substring(g.indexOf("?>")+2)}var c="".concat("<my>",g,"</my>");a.loadXML(c);b=a.documentElement;while(b.hasChildNodes()){h.appendChild(b.firstChild)}}}return h};XSLTProcessor.prototype.setParameter=function(c,a,b){b=b?b:"";if(c){this.processor.addParameter(a,b,c)}else{this.processor.addParameter(a,b)}c=""+(c||"");if(!this.paramsSet[c]){this.paramsSet[c]=[]}this.paramsSet[c][a]=b};XSLTProcessor.prototype.getParameter=function(b,a){b=""+(b||"");if(this.paramsSet[b]&&this.paramsSet[b][a]){return this.paramsSet[b][a]}else{return null}};XSLTProcessor.prototype.clearParameters=function(){for(var b in this.paramsSet){for(var a in this.paramsSet[b]){if(b!=""){this.processor.addParameter(a,"",b)}else{this.processor.addParameter(a,"")}}}this.paramsSet=[]}}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__=function(a){Sarissa.__setReadyState__(a,4)};_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this)};Sarissa.__setReadyState__=function(a,b){a.readyState=b;a.readystate=b;if(a.onreadystatechange!=null&&typeof a.onreadystatechange=="function"){a.onreadystatechange()}};Sarissa.getDomDocument=function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);if(!a.onreadystatechange){a.onreadystatechange=null}if(!a.readyState){a.readyState=0}a.addEventListener("load",_sarissa_XMLDocument_onload,false);return a};if(window.XMLDocument){}else{if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature("LS","3.0")){Sarissa.getDomDocument=function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);return a}}else{Sarissa.getDomDocument=function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);if(a&&(c||b)&&!a.documentElement){a.appendChild(a.createElementNS(c,b))}return a}}}}}if(!window.DOMParser){if(Sarissa._SARISSA_IS_SAFARI){DOMParser=function(){};DOMParser.prototype.parseFromString=function(b,c){var a=new XMLHttpRequest();a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(b),false);a.send(null);return a.responseXML}}else{if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser=function(){};DOMParser.prototype.parseFromString=function(a,d){var c=Sarissa.getDomDocument();try{c.validateOnParse=false;c.setProperty("ProhibitDTD",false)}catch(b){}c.loadXML(a);return c}}}}if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode=function(c,b){var a;if(c.nodeName=="#text"){return document.createTextNode(c.data)}else{if(c.nodeName=="tbody"||c.nodeName=="tr"){a=document.createElement("table")}else{if(c.nodeName=="td"){a=document.createElement("tr")}else{if(c.nodeName=="option"){a=document.createElement("select")}else{a=document.createElement("div")}}}if(b){a.innerHTML=c.xml?c.xml:c.outerHTML}else{a.innerHTML=c.xml?c.cloneNode(false).xml:c.cloneNode(false).outerHTML}return a.getElementsByTagName("*")[0]}}}catch(e){}}if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText=function(a){var c=Sarissa.PARSED_OK;if((!a)||(!a.documentElement)){c=Sarissa.PARSED_EMPTY}else{if(a.documentElement.tagName=="parsererror"){c=a.documentElement.firstChild.data;c+="\n"+a.documentElement.firstChild.nextSibling.firstChild.data}else{if(a.getElementsByTagName("parsererror").length>0){var b=a.getElementsByTagName("parsererror")[0];c=Sarissa.getText(b,true)+"\n"}else{if(a.parseError&&a.parseError.errorCode!=0){c=Sarissa.PARSED_UNKNOWN_ERROR}}}}return c}}Sarissa.getText=function(h,b){var f="";var c=h.childNodes;if(h.nodeType==Node.ATTRIBUTE_NODE&&c.length==0){return h.value}for(var d=0;d<c.length;d++){var g=c[d];var a=g.nodeType;if(a==Node.TEXT_NODE||a==Node.CDATA_SECTION_NODE){f+=g.data}else{if(b===true&&(a==Node.ELEMENT_NODE||a==Node.DOCUMENT_NODE||a==Node.DOCUMENT_FRAGMENT_NODE)){f+=Sarissa.getText(g,true)}}}return f};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer=function(){};XMLSerializer.prototype.serializeToString=function(a){return a.xml}}Sarissa.stripTags=function(a){return a?a.replace(/<[^>]+>/g,""):a};Sarissa.clearChildNodes=function(a){while(a.firstChild){a.removeChild(a.firstChild)}};Sarissa.copyChildNodes=function(d,f,g){if(Sarissa._SARISSA_IS_SAFARI&&f.nodeType==Node.DOCUMENT_NODE){f=f.documentElement}if((!d)||(!f)){throw"Both source and destination nodes must be provided"}if(!g){Sarissa.clearChildNodes(f)}var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;var a=d.childNodes;var c;if(typeof(b.importNode)!="undefined"){for(c=0;c<a.length;c++){f.appendChild(b.importNode(a[c],true))}}else{for(c=0;c<a.length;c++){f.appendChild(a[c].cloneNode(true))}}};Sarissa.moveChildNodes=function(d,f,g){if((!d)||(!f)){throw"Both source and destination nodes must be provided"}if(!g){Sarissa.clearChildNodes(f)}var a=d.childNodes;if(d.ownerDocument==f.ownerDocument){while(d.firstChild){f.appendChild(d.firstChild)}}else{var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;var c;if(typeof(b.importNode)!="undefined"){for(c=0;c<a.length;c++){f.appendChild(b.importNode(a[c],true))}}else{for(c=0;c<a.length;c++){f.appendChild(a[c].cloneNode(true))}}Sarissa.clearChildNodes(d)}};Sarissa.xmlize=function(g,j,d,f){d=d?d:"";var h=d+"<"+j+">";var b=false;if(!(g instanceof Object)||g instanceof Number||g instanceof String||g instanceof Boolean||g instanceof Date){h+=(f?Sarissa.escape(g):g);b=true}else{h+="\n";var a=g instanceof Array;for(var c in g){if(g[c] instanceof Function){continue}h+=Sarissa.xmlize(g[c],(a?'array-item key="'+c+'"':c),d+" ")}h+=d}return(h+=(j.indexOf(" ")!=-1?"</array-item>\n":"</"+j+">\n"))};Sarissa.escape=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};Sarissa.unescape=function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};Sarissa.updateCursor=function(b,a){if(b&&b.style&&b.style.cursor!=undefined){b.style.cursor=a}};Sarissa.updateContentFromURI=function(c,j,a,h,f){try{Sarissa.updateCursor(j,"wait");var b=new XMLHttpRequest();b.open("GET",c,true);b.onreadystatechange=function(){if(b.readyState==4){try{var k=b.responseXML;if(k&&Sarissa.getParseErrorText(k)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(b.responseXML,j,a);if(h){h(c,j)}}else{throw Sarissa.getParseErrorText(k)}}catch(l){if(h){h(c,j,l)}else{throw l}}}};if(f){var g="Sat, 1 Jan 2000 00:00:00 GMT";b.setRequestHeader("If-Modified-Since",g)}b.send("")}catch(d){Sarissa.updateCursor(j,"auto");if(h){h(c,j,d)}else{throw d}}};Sarissa.updateContentFromNode=function(f,g,a){try{Sarissa.updateCursor(g,"wait");Sarissa.clearChildNodes(g);var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;if(b.parseError&&b.parseError.errorCode!=0){var d=document.createElement("pre");d.appendChild(document.createTextNode(Sarissa.getParseErrorText(b)));g.appendChild(d)}else{if(a){f=a.transformToDocument(f)}if(g.tagName.toLowerCase()=="textarea"||g.tagName.toLowerCase()=="input"){g.value=new XMLSerializer().serializeToString(f)}else{try{g.appendChild(g.ownerDocument.importNode(f,true))}catch(c){g.innerHTML=new XMLSerializer().serializeToString(f)}}}}catch(c){throw c}finally{Sarissa.updateCursor(g,"auto")}};Sarissa.formToQueryString=function(h){var a="";for(var g=0;g<h.elements.length;g++){var f=h.elements[g];var d=f.getAttribute("name")?f.getAttribute("name"):f.getAttribute("id");if(d&&((!f.disabled)||f.type=="hidden")){switch(f.type){case"hidden":case"text":case"textarea":case"password":a+=d+"="+encodeURIComponent(f.value)+"&";break;case"select-one":a+=d+"="+encodeURIComponent(f.options[f.selectedIndex].value)+"&";break;case"select-multiple":for(var c=0;c<f.length;c++){var b=f.options[c];if(b.selected===true){a+=d+"[]="+encodeURIComponent(b.value)+"&"}}break;case"checkbox":case"radio":if(f.checked){a+=d+"="+encodeURIComponent(f.value)+"&"}break}}}return a.substr(0,a.length-1)};Sarissa.updateContentFromForm=function(g,j,a,h){try{Sarissa.updateCursor(j,"wait");var f=Sarissa.formToQueryString(g)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true";var b=new XMLHttpRequest();var c=g.getAttribute("method")&&g.getAttribute("method").toLowerCase()=="get";if(c){b.open("GET",g.getAttribute("action")+"?"+f,true)}else{b.open("POST",g.getAttribute("action"),true);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");b.setRequestHeader("Content-length",f.length);b.setRequestHeader("Connection","close")}b.onreadystatechange=function(){try{if(b.readyState==4){var k=b.responseXML;if(k&&Sarissa.getParseErrorText(k)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(b.responseXML,j,a);if(h){h(g,j)}}else{throw Sarissa.getParseErrorText(k)}}}catch(l){if(h){h(g,j,l)}else{throw l}}};b.send(c?"":f)}catch(d){Sarissa.updateCursor(j,"auto");if(h){h(g,j,d)}else{throw d}}return false};Sarissa.getFunctionName=function(c){if(!c||(typeof c!="function")){throw"The value of parameter 'oFunc' must be a function"}if(c.name){return c.name}var a=c.toString();alert("sFunc: "+a);var b=a.substring(a.indexOf("function")+8,a.indexOf("("));if(!b||b.length==0||b==" "){b="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[b]=c}return b};Sarissa.setRemoteJsonCallback=function(a,h,b){if(!b){b="callback"}var g=Sarissa.getFunctionName(h);var f="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var d=document.getElementsByTagName("head")[0];var c=document.createElement("script");c.type="text/javascript";c.id=f;c.onload=function(){};if(a.indexOf("?")!=-1){a+=("&"+b+"="+g)}else{a+=("?"+b+"="+g)}c.src=a;d.appendChild(c);return f};var _XMLSerializer=new XMLSerializer();Sarissa.serialize=function(a){return _XMLSerializer.serializeToString(a)};if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList=function(a){this.length=a};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item=function(a){return(a<0||a>=this.length)?null:this[a]};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty=function(a,b){}}Sarissa.setXpathNamespaces=function(h,c){h._sarissa_useCustomResolver=true;var a=c.indexOf(" ")>-1?c.split(" "):[c];h._sarissa_xpathNamespaces=[];for(var d=0;d<a.length;d++){var g=a[d];var j=g.indexOf(":");var k=g.indexOf("=");if(j>0&&k>j+1){var f=g.substring(j+1,k);var b=g.substring(k+2,g.length-1);h._sarissa_xpathNamespaces[f]=b}else{throw"Bad format on namespace declaration(s) given"}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes=function(c,h,a){var f=this;var b;if(this._sarissa_useCustomResolver){b=function(m){var l=f._sarissa_xpathNamespaces[m];if(l){return l}else{throw"No namespace URI found for prefix: '"+m+"'"}}}else{b=this.createNSResolver(this.documentElement)}var k=null;if(!a){var j=this.evaluate(c,(h?h:this),b,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var d=new SarissaNodeList(j.snapshotLength);d.expr=c;for(var g=0;g<d.length;g++){d[g]=j.snapshotItem(g)}k=d}else{k=this.evaluate(c,(h?h:this),b,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}return k};Element.prototype.selectNodes=function(a){var b=this.ownerDocument;if(b.selectNodes){return b.selectNodes(a,this)}else{throw"Method selectNodes is only supported by XML Elements"}};XMLDocument.prototype.selectSingleNode=function(c,b){var a=b?b:null;return this.selectNodes(c,a,true)};Element.prototype.selectSingleNode=function(a){var b=this.ownerDocument;if(b.selectSingleNode){return b.selectSingleNode(a,this)}else{throw"Method selectNodes is only supported by XML Elements"}};Sarissa.IS_ENABLED_SELECT_NODES=true}var deCarta={};function GLOBALS(){}GLOBALS.HYBRID="HYBRID";GLOBALS.STREET="STREET";GLOBALS.SATELLITE="SATELLITE";GLOBALS.PAN_PIXEL_DISTANCE=300;GLOBALS.DEFAULT_MAP_TILE_SIZE=256;GLOBALS.DEFAULT_MAP_WIDTH="800px";GLOBALS.DEFAULT_MAP_HEIGHT="500px";GLOBALS.API_VERSION="4.5.2";GLOBALS.API_BUILD="$LastChangedRevision: 63607 $";GLOBALS.API_RELEASECLASS="RELEASE";GLOBALS.ALLOWDOMEVENTS=true;GLOBALS.DEBUG_JSON=false;GLOBALS.TILE_SESSION_ID=1;function Credentials(){}Credentials.url="http://ws.decarta.com/openls/openls";Credentials.jsonServletName="JSON";Credentials.clientName="";Credentials.clientPassword="";Credentials.configuration="old-english-tile";Credentials.transparentConfiguration="transparent-tile";Credentials.mapType="STREET";Credentials.ISOCountryCode="US";Credentials.trafficEnabled=false;Credentials.rel="4.5.2";Credentials.dgkey="";Credentials.imgPath="img/";Credentials.errorTile=Credentials.imgPath+"tile.png";Credentials.transparentPNG=Credentials.imgPath+"tile.png";Credentials.transparentGIF=Credentials.imgPath+"x.gif";Credentials.infoWindowCloseButton=Credentials.imgPath+"close.png";Credentials.pinIconPath=Credentials.imgPath+"greenDot.png";Credentials.zoomUnselectedIconPath=Credentials.imgPath+"zoom.png";Credentials.zoomSelectedIconPath=Credentials.imgPath+"zoomChecked.png";Credentials.zoomOutIconPath=Credentials.imgPath+"zoomBottom.png";Credentials.zoomInIconPath=Credentials.imgPath+"zoomTop.png";deCarta.AJAXContentLoader={};deCarta.AJAXContentLoader.load=function(b,g,a){if(a&&a.mode=="iframe"){var c=document.createElement("iframe");c.style.width=a.height||"0px";c.style.height=a.width||"0px";c.style.border="0px";c.src=b;if(typeof(g)=="function"){c.onload=g}a.dom.appendChild(c)}else{if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(d){}}var f=new XMLHttpRequest();f.open("GET",b,true);f.onreadystatechange=function(){if(f.readyState==4){if(f.status==200){g(f.responseText)}else{g(f.responseText)}}};f.send(null)}};function AbstractSearchCriteria(){this.queryString="";this.maximumResponses=10;this.database=null;this.sortDirection="Ascending";this.sortCriteria="Distance";this.rankCriteria=null;this.allowAggregates=false;this.retrieveAll=false;this.properties={};this.defaultUOM=null}deCarta.AdManager={url:"http://mobile-dev.decarta.com/adproxies/AdController",callbacks:[],scriptCounter:0,scriptTagId:"deCartaAdScript",requestAds:function(g,j,h){var c=deCarta.AdManager.scriptCounter++;var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("id",deCarta.AdManager.scriptTagId+c);var k="?DECARTAADID="+c;var a="&ADPROVIDER="+g;deCarta.AdManager.callbacks[c]=h;var f=deCarta.AdManager.url+k+a;for(var b in j){if(j.hasOwnProperty(b)){f+="&"+b+"="+escape(j[b])}}d.setAttribute("src",f);document.getElementsByTagName("head").item(0).appendChild(d);deCarta.AdManager.scriptObj=d},callback:function(b){var c=parseInt(b.DECARTAADID);var a=document.getElementById(deCarta.AdManager.scriptTagId+c);if(a){document.getElementsByTagName("head").item(0).removeChild(a)}deCarta.AdManager.callbacks[c](b)}};function Address(f,j,c,b,h,g,d,a){if(f||f==0){this.buildingNumber=f}else{this.buildingNumber=""}this.landmark="";this.street=j||"";this.streetNameAndNumber="";this.speedLimit="";this.countryCode="";this.countrySubdivision=c||"";this.countrySecondarySubdivision=b||"";this.countryTertiarySubdivision="";this.municipality=h||"";this.postalCode=g||"";this.municipalitySubdivision=d||"";this.locale=a||new Locale("en","US");this.type="Structured"}Address.prototype.getBuildingNumber=function(){return this.buildingNumber};Address.prototype.setBuildingNumber=function(a){this.buildingNumber=a};Address.prototype.getStreet=function(){return this.street};Address.prototype.setStreet=function(a){this.street=a};Address.prototype.getCountrySubdivision=function(){return this.countrySubdivision};Address.prototype.setCountrySubdivision=function(a){this.countrySubdivision=a};Address.prototype.getCountrySecondarySubdivision=function(){return this.countrySecondarySubdivision};Address.prototype.setCountrySecondarySubdivision=function(a){this.countrySecondarySubdivision=a};Address.prototype.getMunicipality=function(){return this.municipality};Address.prototype.setMunicipality=function(a){this.municipality=a};Address.prototype.getMunicipalitySubdivision=function(){return this.municipalitySubdivision};Address.prototype.setMunicipalitySubdivision=function(a){this.municipalitySubdivision=a};Address.prototype.getPostalCode=function(){return this.postalCode};Address.prototype.setPostalCode=function(a){this.postalCode=a};Address.prototype.getLocale=function(){return this.locale};Address.prototype.setLocale=function(a){this.locale=a};Address.prototype.toString=function(){var a="";if(this.buildingNumber!=""){a+=this.buildingNumber+" "}if(this.street!=""){a+=this.street+" "}if(this.municipality!=""){a+=this.municipality+" "}if(this.countrySubdivision!=""){a+=this.countrySubdivision+" "}if(this.postalCode!=""){a+=this.postalCode}return a};deCarta.Animator=function(){};deCarta.Animator.prototype.objsToAnimate=null;deCarta.Animator.prototype.objsType=null;deCarta.Animator.prototype.scopeObj=null;deCarta.Animator.prototype.onendCallback=null;deCarta.Animator.prototype.animation=null;deCarta.Animator.prototype.animationId=null;deCarta.Animator.prototype.setObjsToAnimate=function(a){if(!deCarta.Array.isArray(a)){a=[a]}var b;var g=a[0].type;var f=["pin"];var c=f.length;for(b=0;b<c;b++){if(g==f[b]){break}}if(b>=c){throw new Exception("requesting to animate invalid object type: "+this.objsType)}var d=a.length;for(b=0;b<d;b++){if(a[b].type!=g){throw new Exception("obj index: "+b+" is of invalid type: "+a[b].type)}}this.objsType=g;this.objsToAnimate=a};deCarta.Animator.prototype.setScopeObj=function(a){this.scopeObj=a};deCarta.Animator.prototype.setOnendCallback=function(a){if(typeof a!="function"){throw new Exception("deCarta.Animator.setOnendCallback: callback not a function")}this.onendCallback=a};deCarta.Animator.prototype.setAnimation=function(a){};deCarta.Array={};deCarta.Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};deCarta.Array.indexOf=function(d,a,c){var b=d.length;c=(!c||isNaN(c))?0:c;c=(c<=0)?0:c;c=(c>=b-1)?b-1:c;for(;c<b;c++){if(d[c]===a){return c}}return -1};function BoundingBox(b,a){if(!(b&&(b.lat||b.lat==0)&&(b.lon||b.lon==0))||!(a&&(a.lat||a.lat==0)&&(a.lon||a.lon==0))){throw new Exception("Error instantiating BoundingBox, invalid parameters: "+b+a)}if(b.lat>a.lat){throw new Exception("Error instantiating BoundingBox, minPos.lat should <= maxPos.lat")}this.minPosition=new Position(b.lat,b.lon);this.maxPosition=new Position(a.lat,a.lon);this.getHeightInDegrees=function(){return this.maxPosition.lat-this.minPosition.lat};this.getWidthInDegrees=function(){if(this.minPosition.lon>this.maxPosition.lon){return(this.maxPosition.lon-this.minPosition.lon)+360}else{return(this.maxPosition.lon-this.minPosition.lon)}};this.getUpperLeftPosition=function(){var c=new Position(this.maxPosition.lat,this.minPosition.lon);return c};this.getLowerRightPosition=function(){var c=new Position(this.minPosition.lat,this.maxPosition.lon);return c};this.getMaxPosition=function(){return this.maxPosition};this.setMaxPosition=function(c){if(this.minPosition.lat>c.lat){throw new Exception("Error setting maxPosition, minPos.lat should <= maxPos.lat")}this.maxPosition=new Position(c.lat,c.lon)};this.getMinPosition=function(){return this.minPosition};this.setMinPosition=function(c){if(c.lat>this.maxPosition.lat){throw new Exception("Error setting minPosition, minPos.lat should <= maxPos.lat")}this.minPosition=new Position(c.lat,c.lon)};this.getCenterPosition=function(){var d=parseFloat(this.maxPosition.lat-((this.maxPosition.lat-this.minPosition.lat)/2));var c=parseFloat(this.maxPosition.lon-((this.maxPosition.lon-this.minPosition.lon)/2));if(this.maxPosition.lon<this.minPosition.lon){c=c+180}return new Position(d,c)};this.getRadius=function(){if(this.getHeightInDegrees()>this.getWidthInDegrees()){return(this.getHeightInDegrees()*111.111)/2}else{return(this.getWidthInDegrees()*111.111)/2}};this.contains=function(f){var d=this.maxPosition.lon;var c=f.lon;if(this.minPosition.lon>0&&this.maxPosition.lon<this.minPosition.lon){d=d+360;if(f.lon<this.minPosition.lon){c=c+360}}if(this.minPosition.lon<0&&this.maxPosition.lon<this.minPosition.lon){d=d+360;if(f.lon<this.minPosition.lon){c=c+360}}if(f.lat>=this.minPosition.lat&&c>=this.minPosition.lon&&f.lat<=this.maxPosition.lat&&c<=d){return true}else{return false}};this.containsBoundingBox=function(h){if(!h){return true}var c=new Position(h.maxPosition.lat,h.minPosition.lon);var f=h.minPosition;var d=h.maxPosition;var g=new Position(h.minPosition.lat,h.maxPosition.lon);if(this.contains(c)&&this.contains(f)&&this.contains(d)&&this.contains(g)){if(new BoundingBox(this.minPosition,d).contains(f)){return true}}return false};this.getOverlapBoundingBox=function(o){var f=this.minPosition;var l=this.maxPosition;var n=o.minPosition;var m=o.maxPosition;if(f.lat>=m.lat||n.lat>=l.lat){return null}var d=new BoundingBox(new Position(-90,f.lon),new Position(90,l.lon));var c=new BoundingBox(new Position(-90,n.lon),new Position(90,m.lon));if(!d.contains(n)&&!d.contains(m)&&!c.contains(f)&&!c.contains(l)){return null}var k=0,h=0;if(d.contains(n)){k=n.lon;if(c.contains(f)){h=l.lon}else{if(d.contains(m)){h=m.lon}else{h=l.lon}}}else{if(c.contains(f)){k=f.lon;if(c.contains(l)){h=l.lon}else{h=m.lon}}}var j=[f.lat,l.lat,n.lat,m.lat];g(j);return new BoundingBox(new Position(j[1],k),new Position(j[2],h));function g(s){var r=0,p=0;for(r=0;r<s.length-1;r++){for(p=0;p<s.length-r-1;p++){if(s[p]>s[p+1]){var q=s[p];s[p]=s[p+1];s[p+1]=q}}}}};this.extendedContains=function(h){var d=new Position(this.minPosition.lat-this.getHeightInDegrees(),this.minPosition.lon-this.getWidthInDegrees());var c=new Position(this.maxPosition.lat+this.getHeightInDegrees(),this.maxPosition.lon+this.getWidthInDegrees());var g=c.lon;var f=h.lon;if(d.lon>0&&c.lon<d.lon){g=g+360;if(h.lon<d.lon){f=f+360}}if(d.lon<0&&c.lon<d.lon){g=g+360;if(h.lon<d.lon){f=f+360}}if(h.lat>d.lat&&f>d.lon&&h.lat<c.lat&&f<g){return true}else{return false}};this.equals=function(c){if(c&&this.minPosition.toString()==c.getMinPosition().toString()&&this.maxPosition.toString()==c.getMaxPosition().toString()){return true}else{return false}};this.toString=function(){return this.minPosition.toString()+" "+this.maxPosition.toString()}}deCarta.CopyrightMessage=function(a){this.init(a)};deCarta.CopyrightMessage.prototype.map=null;deCarta.CopyrightMessage.prototype.type="CopyrightMessage";deCarta.CopyrightMessage.prototype.frame=null;deCarta.CopyrightMessage.prototype.cssClass="decarta-copyright";deCarta.CopyrightMessage.prototype.message=null;deCarta.CopyrightMessage.prototype.init=function(a){this.message=a};deCarta.CopyrightMessage.prototype.build=function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;this.frame.innerHTML=this.message;Utilities.setUnselectable(this.frame)};deCarta.CopyrightMessage.prototype.appendThis=function(){if(!this.frame){this.build()}return this.frame};deCarta.CopyrightMessage.prototype.removeThis=function(){this.map=null;return this.frame};deCarta.CopyrightMessage.prototype.position=function(a){this.frame.style.top=(a.height-20)+"px";this.frame.style.left="1px"};function CorridorSearchCriteria(a,c,b){if(!c){alert("CorridorSearchCriteria requires routeId");return}this.routeId=c;this.type="distance";this.duration=5;this.distance=500;if(b){if(b.type&&(b.type==="distance"||b.type==="euclideanDistance"||b.type==="drivetime")){this.type=b.type}else{if(b.type&&!(b.type==="distance"||b.type==="euclideanDistance"||b.type==="drivetime")){alert("allowed values for the CorridorSearchCriteria.type distance || euclideanDistance || drivetime ")}}if(b.duration&&parseInt(b.duration)>0){this.duration=parseInt(b.duration)}if(b.distance&&parseInt(b.distance)>0){this.distance=parseInt(b.distance)}}}CorridorSearchCriteria.prototype=new AbstractSearchCriteria();CorridorSearchCriteria.prototype.constructor=AbstractSearchCriteria;function DDSShape(){this.borderColor="(0.0.0)";this.borderColorRed=0;this.borderColorGreen=0;this.borderColorBlue=0;this.borderStyle="SOLID";this.borderWidth="2";this.fillColor="(0.0.0)";this.fillColorRed=0;this.fillColorBlue=0;this.fillColorGreen=0;this.id=null;this.opacity="65";this.opacityFloat=0.65;this.strokeOpacity="65";this.strokeOpacityFloat=0.65;this.fillOpacity="65";this.fillOpacityFloat=0.65;this.map=null;this.isVisible=true;this.rendering=null;this.eventListenerMap=null;this.raphael_element=null;this.title="";this.description="";this.customProperties=null;this.generalizedMinLonIndex=[]}DDSShape.prototype.inside=null;DDSShape.prototype.setBorderColor=function(b){if(!b.match(/\([0-9]+\.[0-9]+\.[0-9]+\)/)){throw new Exception("Error setting RGB value in DDSShape.setBorderColor. Please use format (255.255.255)");return}this.borderColor=b;var a=b.replace("(","").replace(")","").split(".");this.borderColorRed=parseInt(a[0],10);this.borderColorGreen=parseInt(a[1],10);this.borderColorBlue=parseInt(a[2],10)};DDSShape.prototype.getBorderColor=function(){return this.borderColor};DDSShape.prototype.setBorderStyle=function(a){if(a=="SOLID"||a=="DASH"||a=="DOT"||a=="DASHDOTDOT"||a=="ALTBLACKDASH"||a=="RAIL"||a=="NONE"){this.borderStyle=a}else{throw new Exception("Error setting border style value in DDSShape.setBorderStyle. Please use format SOLID, DASH, DOT, DASHDOTDOT, ALTBLACKDASH, RAIL, NONE");return}};DDSShape.prototype.getBorderStyle=function(){return this.borderStyle};DDSShape.prototype.setBorderWidth=function(a){this.borderWidth=a};DDSShape.prototype.getBorderWidth=function(){return this.borderWidth};DDSShape.prototype.setFillColor=function(b){if(!b.match(/\([0-9]+\.[0-9]+\.[0-9]+\)/)){throw new Exception("Error setting RGB value in DDSShape.setColor. Please use format (255.255.255)");return}this.fillColor=b;var a=b.replace("(","").replace(")","").split(".");this.fillColorRed=parseInt(a[0],10);this.fillColorGreen=parseInt(a[1],10);this.fillColorBlue=parseInt(a[2],10)};DDSShape.prototype.getFillColor=function(){return this.fillColor};DDSShape.prototype.getId=function(){return this.id};DDSShape.prototype.getTitle=function(){return this.title};DDSShape.prototype.setTitle=function(a){this.title=a};DDSShape.prototype.getDescription=function(){return this.description};DDSShape.prototype.setDescription=function(a){this.description=a};DDSShape.prototype.setOpacity=function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setOpacity: invalid argument of: "+a)}this.opacity=a;this.opacityFloat=b;this.strokeOpacityFloat=b;this.fillOpacityFloat=b};DDSShape.prototype.getOpacity=function(){return this.opacity};DDSShape.prototype.setStrokeOpacity=function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setStrokeOpacity: invalid argument of: "+a)}this.strokeOpacity=a;this.strokeOpacityFloat=b};DDSShape.prototype.getStrokeOpacity=function(){return this.strokeOpacity};DDSShape.prototype.setFillOpacity=function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setStrokeOpacity: invalid argument of: "+a)}this.fillOpacity=a;this.fillOpacityFloat=b};DDSShape.prototype.getFillOpacity=function(){return this.fillOpacity};DDSShape.prototype.hide=function(){if(this.isVisible==true){this.isVisible=false;if(this.map){if(this.map.getShapeRendering()=="client"){if(this.raphael_element){this.raphael_element.hide()}}else{this.map.reDrawMap()}}}};DDSShape.prototype.show=function(){if(this.isVisible==false){this.isVisible=true;if(this.map){if(this.map.getShapeRendering()=="client"){if(this.raphael_element){this.raphael_element.show()}else{this.map.drawShape(this)}}else{this.map.reDrawMap()}}}};DDSShape.prototype.equals=function(a){if(a&&this.id==a.id){return true}else{return false}};DDSShape.prototype.addEventListener=function(b,a){if(!this.eventListenerMap){this.eventListenerMap={}}if(typeof a=="function"){this.eventListenerMap[b]=a;if(this.raphael_element&&this.raphael_element.node){this.raphael_element.node[b]=function(g){g=g?g:window.event;var d=this.raphael.owner_shape;var c=g.type;c="on"+c;var f=d.eventListenerMap[c];f(d)}}}};DDSShape.getMercPixels=function(g,r){if(this.mercPixels[g]){return(this.mercPixels[g])}var a=this.positions;var s=this.getBoundingBox().minPosition.lon;var k=0;var h=Utilities.radsPerPixelAtZoomLevel(r,g);if(this.generalize){if(this.generalized[g]){a=this.generalized[g];if(this.generalizedMinLonIndex[g]){k=this.generalizedMinLonIndex[g]}else{var m=Utilities.pix2lon(10,h);for(var q=0;q<a.length;q++){if(Math.abs(a[q].lon-s)<=m){k=q;this.generalizedMinLonIndex[g]=q;break}}}}else{a=Utilities.generalize(a,g,10,r);this.generalized[g]=a;m=Utilities.pix2lon(10,h);for(q=0;q<a.length;q++){if(Math.abs(a[q].lon-s)<=m){k=q;this.generalizedMinLonIndex[g]=q;break}}}}var p=a.length;var d=[];for(var j=k;j<p;j++){var n=(a[j]);var c=Math.round(Utilities.lat2pix(n.lat,h));var f;if(j>k){var b=a[j-1].lon;var l=d[j-1].x;var o=n.lon-b;if(o>180){o-=360}else{if(o<-180){o+=360}}f=l+Math.round(Utilities.lon2pix(o,h))}else{f=Math.round(Utilities.lon2pix(n.lon,h))}d[j]=new PixelPoint(f,c)}for(j=k-1;j>=0;j--){n=(a[j]);c=Math.round(Utilities.lat2pix(n.lat,h));if(j<k){b=a[j+1].lon;l=d[j+1].x;o=n.lon-b;if(o>180){o-=360}else{if(o<-180){o+=360}}f=l+Math.round(Utilities.lon2pix(o,h))}d[j]=new PixelPoint(f,c)}this.mercPixels[g]=d;return(this.mercPixels[g])};function DDSCircle(b,a){this.id=Math.floor(Math.random()*10000000);this.type="circle";this.radius=a||new Radius(100,new UOM("M"));this.position=b;this.customProperties={}}DDSCircle.prototype=new DDSShape();DDSCircle.prototype.constructor=DDSCircle;DDSCircle.prototype.setPosition=function(a){this.position=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSCircle.prototype.getPosition=function(){return this.position};DDSCircle.prototype.setRadius=function(a){this.radius=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSCircle.prototype.getRadius=function(){return this.radius};DDSCircle.prototype.inside=function(b){var a=deCarta.Math.greatCircleDist(this.position,b,this.radius.uom);if(a<this.radius.distance){return true}else{return false}};DDSCircle.prototype.getBoundingBox=function(){if(this.bbox){return(this.bbox)}this.bbox=Utilities.centerContextToBoundingBox(this.position,this.radius.getDegrees()*111.111);return this.bbox};function DDSLine(a){this.id=Math.floor(Math.random()*10000000);this.type="line";this.generalize=true;this.generalized=[];this.mercPixels=[];this.positions=[];this.width=a||2;this.VR7="";this.clip=false;this.setFillColor("(0.0.0)");this.setBorderWidth("0");this.customProperties={}}DDSLine.prototype=new DDSShape();DDSLine.prototype.constructor=DDSLine;DDSLine.prototype.setColor=function(a){try{this.setBorderColor(a);this.setFillColor(a)}catch(b){throw new Exception("Error setting RGB value in DDSLine.setColor. Please use format (255.255.255)")}};DDSLine.prototype.setPositions=function(a){this.positions=a;this.generalized=[];this.mercPixels=[];if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSLine.prototype.getPositions=function(){return this.positions};DDSLine.prototype.getPosition=function(){return this.getBoundingBox().getCenterPosition()};DDSLine.prototype.setWidth=function(a){this.width=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSLine.prototype.getWidth=function(){return this.width};DDSLine.prototype.setVR7=function(a){this.VR7=a};DDSLine.prototype.getVR7=function(){return this.VR7};DDSLine.prototype.setGeneralize=function(a){this.generalize=a};DDSLine.prototype.getGeneralize=function(){return this.generalize};DDSLine.prototype.setClip=function(a){this.clip=(a)?true:false};DDSLine.prototype.getMercPixels=DDSShape.getMercPixels;DDSLine.prototype.getMercPixelsClipped=function(w,r,b){var F,E;var l=this.getMercPixels(w,r);var f=l.length;if(f<2){return[l]}var t=[];var s=0;for(F=0;F<f-1;F++){if(l[F].equals(l[F+1])){continue}t[s]=[];t[s][0]=l[F];t[s][1]=l[F+1];s++}var D=t.length;var H=Utilities.radsPerPixelAtZoomLevel(r,w);var g=Math.round(Utilities.lat2pix(b.maxPosition.lat,H));var z=Math.round(Utilities.lat2pix(b.minPosition.lat,H));var v=Math.round(Utilities.lon2pix(b.maxPosition.lon,H));var c=Math.round(Utilities.lon2pix(b.minPosition.lon,H));for(F=0;F<D;F++){a(t[F])}var I=[];var h=0;var G="oc";var n="oc0";var k="oc1";var A=1;var m=2;var q=4;var u=8;F=0;while(F<D){var d=t[F];if(!(d[n]|d[k])){if(!(d[0].equals(d[1]))){I[h++]=d}else{}F++;continue}else{if(d[n]&d[k]){F++;continue}else{for(E=0;E<2;E++){var B=d[G+E];var p,o;if(!B){continue}if(B&A){p=d[0].x+(d[1].x-d[0].x)*(g-d[0].y)/(d[1].y-d[0].y);o=g}else{if(B&m){p=d[0].x+(d[1].x-d[0].x)*(z-d[0].y)/(d[1].y-d[0].y);o=z}}if(B&q){p=v;o=d[0].y+(d[1].y-d[0].y)*(v-d[0].x)/(d[1].x-d[0].x)}else{if(B&u){p=c;o=d[0].y+(d[1].y-d[0].y)*(c-d[0].x)/(d[1].x-d[0].x)}}if(isNaN(p)||!isFinite(p)||isNaN(o)||!isFinite(o)){F++;break}var C=new PixelPoint(p,o);d[E]=C}a(d)}}}return I;function a(j){var P="oc";var N=1;var O=2;var M=4;var K=8;for(var y=0;y<2;y++){var L=j[y];j[P+y]=0;if(L.x>v){j[P+y]+=M}else{if(L.x<c){j[P+y]+=K}}if(L.y>g){j[P+y]=N}else{if(L.y<z){j[P+y]=O}}}}};DDSLine.prototype.getBoundingBox=function(){if(this.bbox){return(this.bbox)}if(this.positions.length>1){this.bbox=Utilities.positionsToBoundingBox(this.positions)}else{this.bbox=new BoundingBox(this.positions[0],this.positions[0])}return this.bbox};function DDSPolygon(){this.id=Math.floor(Math.random()*10000000);this.type="polygon";this.generalize=true;this.generalized=[];this.mercPixels=[];this.positions=[];this.VR7="";this.customProperties={}}DDSPolygon.prototype=new DDSShape();DDSPolygon.prototype.constructor=DDSPolygon;DDSPolygon.prototype.setPositions=function(a){this.positions=a;if(!this.positions[this.positions.length-1].equals(this.positions[0])){this.positions.push(this.positions[0].clone())}this.generalized=[];this.mercPixels=[];if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSPolygon.prototype.getPositions=function(){return this.positions};DDSPolygon.prototype.getPosition=function(){return this.getBoundingBox().getCenterPosition()};DDSPolygon.prototype.setVR7=function(a){this.VR7=a;if(this.map!=null){this.bbox=null;this.map.drawShape(this)}};DDSPolygon.prototype.getVR7=function(){return this.VR7};DDSPolygon.prototype.setGeneralize=function(a){this.generalize=a};DDSPolygon.prototype.getGeneralize=function(){return this.generalize};DDSPolygon.prototype.inside=function(a){return deCarta.Math.pointInPolygon(this.positions,a)};DDSPolygon.prototype.getMercPixels=DDSShape.getMercPixels;DDSPolygon.prototype.getBoundingBox=function(){if(this.bbox){return(this.bbox)}if(this.positions.length>1){this.bbox=Utilities.positionsToBoundingBox(this.positions)}else{this.bbox=new BoundingBox(this.positions[0],this.positions[0])}return this.bbox};deCarta.DOMDimensions=function(a){this.init(a)};deCarta.DOMDimensions.prototype.left=null;deCarta.DOMDimensions.prototype.top=null;deCarta.DOMDimensions.prototype.right=null;deCarta.DOMDimensions.prototype.bottom=null;deCarta.DOMDimensions.prototype.width=null;deCarta.DOMDimensions.prototype.height=null;deCarta.DOMDimensions.prototype.init=function(a){try{if(!a||(a&&!a.style)){throw new Exception("passed in element not valid")}this.width=parseInt(a.clientWidth,10);this.height=parseInt(a.clientHeight,10);this.left=parseInt(Utilities.getAbsoluteLeft(a),10);this.top=parseInt(Utilities.getAbsoluteTop(a),10);this.right=this.left+this.width;this.bottom=this.top+this.height;if(isNaN(this.width)||isNaN(this.height)||isNaN(this.left)||isNaN(this.top)||isNaN(this.right)||isNaN(this.bottom)){throw new Exception("element does not have calculable dimensions")}}catch(b){throw new Exception("DOMDimensions: Argument not applicable: "+b.message)}};function DefaultInfoWindow(c){this.width=255;this.height=213;this.autoHeight=false;var a=24;var b=66;var d=89;this.xOffset=-20;this.yOffset=undefined;this.bubble=null;this.bubbleClassName="decarta-bubble";this.bubbleIgnoreMapEvents=true;this.bubbleContent=null;this.bubbleContentClassName="decarta-bubbleContent";this.bubbleContentIgnoreMapEvents=true;this.bubbleContentSelectable=false;this.bubbleClose=null;this.bubbleCloseClassName="decarta-close";this.bubbleCloseIgnoreMapEvents=true;this.associatedPin=null;this.onCloseCallback=null;this.onHideCallback=null;this.onShowCallback=null;this.shouldAutoCenter=false;this.bubbleCloseSrc=Credentials.infoWindowCloseButton;this.setAutoCenter=function(f){f=f||false;this.shouldAutoCenter=f};this.setOnClose=function(f){this.onCloseCallback=f};this.setOnHide=function(f){this.onHideCallback=f};this.setOnShow=function(f){this.onShowCallback=f};this.setIgnoreMapEvents=function(g){for(var f in g){if(g.hasOwnProperty(f)){this[f]=g[f]}}this.resetMapEventIgnorance()};this.setContentSelectable=function(f){this.bubbleContentSelectable=f;this.resetSelectability()};this.init=function(m){for(var n in m){if(m.hasOwnProperty(n)){this[n]=m[n]}}this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.style.cssText="display:none;filter:alpha(opacity=100); opacity:1; position:absolute; z-index:10000;background-color:transparent;font-size:11px;";this.bubble.style.width=this.width+"px";var g=document.createElement("img");g.src="img/info-tl.png";g.style.cssText="top:0px;left:0px;margin:0px; padding:0px;position:absolute;background-color:transparent;";g.style.height=a+"px";g.style.width=a+"px";this.bubble.appendChild(g);var q=document.createElement("div");q.style.cssText="top:0px;margin:0px;padding:0px;border-top:1px solid #ABABAB;position:absolute;background-color:white;";q.style.left=a+"px";q.style.right=a+"px";q.style.height=a-1+"px";this.bubble.appendChild(q);this.tElement=q;var p=document.createElement("img");p.src="img/info-tr.png";p.style.cssText="top:0px;right:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";p.style.height=a+"px";p.style.width=a+"px";this.bubble.appendChild(p);var h=document.createElement("div");h.style.cssText="left:0px;margin:0px; padding:0px;border-left:1px solid #ABABAB;position:absolute;background-color:white;";h.style.top=a+"px";h.style.bottom=a+b+"px";h.style.width=a-1+"px";this.bubble.appendChild(h);this.lElement=h;var r=document.createElement("div");r.style.cssText="right:0px;margin:0px; padding:0px;border-right:1px solid #ABABAB;position:absolute;background-color:white;";r.style.top=a+"px";r.style.bottom=a+b+"px";r.style.width=a-1+"px";this.bubble.appendChild(r);this.rElement=r;var j=document.createElement("img");j.src="img/info-bl.png";j.style.cssText="left:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";j.style.bottom=b+"px";j.style.height=a+"px";j.style.width=a+"px";this.bubble.appendChild(j);var l=document.createElement("div");l.style.cssText="margin:0px; padding:0px;border-bottom:1px solid #ABABAB;position:absolute;background-color:white;";l.style.bottom=b+"px";l.style.left=a+"px";l.style.right=a+"px";l.style.height=a-1+"px";this.bubble.appendChild(l);this.bElement=l;var f=document.createElement("img");f.src="img/info-br.png";f.style.cssText="right:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";f.style.bottom=b+"px";f.style.height=a+"px";f.style.width=a+"px";this.bubble.appendChild(f);var k=document.createElement("img");k.src="img/info-pointer.png";k.style.cssText="bottom:1px;left:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";k.style.width=d+"px";k.style.height=b+"px";this.bubble.appendChild(k);this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.style.cssText="background-color:white;";this.bubbleContent.style.marginTop=a+"px";this.bubbleContent.style.marginRight=a+"px";this.bubbleContent.style.marginBottom=a+b+"px";this.bubbleContent.style.marginLeft=a+"px";this.bubbleContent.style.padding=0+"px";if(this.autoHeight){}else{var o=this.height-2*a-b;if(o>0){this.bubbleContent.style.height=o+"px";this.bubbleContent.style.overflowY="auto"}else{throw new Exception("height must be bigger than:"+(2*a+b))}}if(this.width<(a+d)){throw new Exception("width must be bigger than:"+(a+d))}this.bubble.appendChild(this.bubbleContent);if(this.bubbleCloseSrc){this.bubbleClose=document.createElement("img");this.bubbleClose.src=this.bubbleCloseSrc;this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.owner=this;this.bubbleClose.style.cssText="position:absolute; width:13px; height:13px; top:8px; right:8px; cursor:pointer;";deCarta.Events.addEvent(this.bubbleClose,"click",DefaultInfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)}};this.build=function(){try{this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.className=this.bubbleClassName;this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.className=this.bubbleContentClassName;if(Credentials.infoWindowCloseButton){this.buildCloseIcon(Credentials.infoWindowCloseButton)}this.bubble.appendChild(this.bubbleContent)}catch(f){throw new Exception("build error:"+f.message)}};this.buildCloseIcon=function(f){this.bubbleClose=document.createElement("img");if(f){this.bubbleClose.src=f}this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.className=this.bubbleCloseClassName;this.bubbleClose.owner=this;deCarta.Events.addEvent(this.bubbleClose,"click",DefaultInfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)};this.setPosition=function(g,f){f=f||0;g=g||0;if(this.yOffset!=undefined){this.bubble.style.top=f-this.yOffset+"px"}else{if(this.autoHeight){this.bubble.style.top=f+"px"}else{this.bubble.style.top=f-this.height+1+"px"}}this.bubble.style.left=g-this.xOffset+"px"};this.setContent=function(f){this.bubbleContent.innerHTML="";if(f.style){this.bubbleContent.appendChild(f)}else{this.bubbleContent.innerHTML=f}this.resetSelectability();this.resetMapEventIgnorance()};this.resetSelectability=function(){var k=(this.bubbleContentSelectable)?Utilities.setSelectable:Utilities.setUnselectable;var f=this.bubbleContent;k(f);if(f.hasChildNodes()){var g=f.getElementsByTagName("*");for(var h=0;h<g.length;h++){k(g[h])}}};this.resetMapEventIgnorance=function(){var k,h,l,g,f;if(this.bubbleIgnoreMapEvents){deCarta.IdManager.setTag(this.bubble,"ignoreForMapEvents");if(this.bubble.hasChildNodes()){g=this.bubble.childNodes;for(k=0;k<g.length;k++){l=g[k];if(l.id!=this.bubbleContentClassName&&l.id!=this.bubbleCloseClassName){f=l.getElementsByTagName("*");for(h=0;h<f.length;h++){deCarta.IdManager.setTag(f[h],"ignoreForMapEvents")}}}}}if(this.bubbleContentIgnoreMapEvents){deCarta.IdManager.setTag(this.bubbleContent,"ignoreForMapEvents");f=this.bubbleContent.getElementsByTagName("*");for(k=0;k<f.length;k++){deCarta.IdManager.setTag(f[k],"ignoreForMapEvents")}}if(this.bubbleCloseIgnoreMapEvents&&this.bubbleClose){deCarta.IdManager.setTag(this.bubbleClose,"ignoreForMapEvents")}};this.show=function(g){this.bubble.style.zIndex=Pin.zIndexCounter+10000;this.bubbleContent.style.zIndex=Pin.zIndexCounter+10000;if(this.bubbleClose){this.bubbleClose.style.zIndex=Pin.zIndexCounter+10000}this.bubble.style.display="block";if(this.autoHeight&&this.yOffset==undefined){var f=this.bubble.offsetHeight;var h=parseInt(this.bubble.style.top);this.bubble.style.top=h-f-1+"px"}if(g){this.associatedPin=g}else{this.associatedPin=null}if(this.onShowCallback){this.onShowCallback()}this.autoCenter();this.ie6sizeTLRB();this.ie6FixPng()};this.hide=function(){this.bubble.style.display="none";if(this.onHideCallback){this.onHideCallback()}};this.autoCenter=function(){var n=this.associatedPin;if(!(n&&n.map)||!this.shouldAutoCenter){return}var C=n.map;var k=n.pinImg.clientHeight;var q=n.pinImg.clientWidth;var A=parseInt(n.pinImg.style.top);var E=parseInt(n.pinImg.style.left);var F=Utilities.radsPerPixelAtZoomLevel(C.getTileSize(),C.getZoomController().selected);var t=n.getViewableBoundingBox(F);var D=t.getUpperLeftPosition();var v=C.posToMercPix(D);var B=new PixelPoint(v.x+q,v.y-k);var z=this.bubble.clientHeight;var y=this.bubble.clientWidth;var p=parseInt(this.bubble.style.top);var w=parseInt(this.bubble.style.left);var r=v.y+(A-p);var g=v.x-(E-w);var f=new PixelPoint(g,r);var m=new PixelPoint(g+y,r-z);var s=new PixelPoint(g,r-z);var o=new PixelPoint(g+y,r);var h=C.mercPixToPos(s);var u=C.mercPixToPos(o);var j=new BoundingBox(h,u);var l=j.getCenterPosition();C.panToPosition(l)};this.init(c);this.ie6sizeTLRB=function(){if(!Utilities.ie6){return}var f=document.getElementById(this.bubbleClassName).clientWidth-(a*2);var g=document.getElementById(this.bubbleClassName).clientHeight-a-b;this.bElement.style.width=f+"px";this.tElement.style.width=f+"px";this.lElement.style.height=g+"px";this.rElement.style.height=g+"px";return};this.ie6FixPng=function(){if(Utilities.ie6){var f=this.bubble.getElementsByTagName("img");for(var g=0;g<f.length;g++){if(f[g].src.match(/.png/ig)){Utilities.fixPng(f[g])}}}}}DefaultInfoWindow.eventClose=function(){var a=this.owner;if(a.onCloseCallback){a.onCloseCallback()}a.hide()};function EventRegistry(){}EventRegistry.addListener=function(c,a,b){if(c.type=="map"&&(a=="rightclick"||a=="dblclick"||a=="click"||a=="mousedown"||a=="mouseout"||a=="mouseup"||a=="move"||a=="movestart"||a=="moveend"||a=="zoomend")){c.addEventListener(a,b)}else{if(c.type=="pin"&&(a=="rightclick"||a=="dblclick"||a=="click"||a=="mousedown"||a=="mouseover"||a=="mouseout"||a=="mouseup")){c.addEventListener(a,b)}else{throw new Exception(a+" is unsupported event type for "+c.type)}}};EventRegistry.clearListeners=function(b,a){b.clearListeners(a)};EventRegistry.clearInstanceListeners=function(a){a.clearInstanceListeners()};deCarta.Events={};deCarta.Events.addEvent=function(d,c,b){var a=deCarta.Events.eventKey;if(!deCarta.IdManager.checkTag(d,a)){deCarta.IdManager.setTag(d,a,deCarta.IdManager.getUniqueId())}if(d.attachEvent){if(d["e"+c+b]){return}d["e"+c+b]=b;d[c+b]=function(){d["e"+c+b](window.event)};d.attachEvent("on"+c,d[c+b])}else{if(d.addEventListener){d.addEventListener(c,b,false)}else{d["on"+c]=b}}};deCarta.Events.removeEvent=function(c,b,a){if(c.detachEvent){if(c[b+a]){c.detachEvent("on"+b,c[b+a]);c["e"+b+a]=null;c[b+a]=null}}else{if(c.removeEventListener){c.removeEventListener(b,a,false)}else{c["on"+b]=undefined}}};deCarta.Events.checkIfTarget=function(c,b){var a=deCarta.Events.eventKey;if(c&&c[a]){if(b&&(b.target||b.srcElement)){var d=b.target||b.srcElement;if(d[a]==c[a]){return true}}}return false};deCarta.Events.eventKey="deCartaEventId";(function(){if(Error){Exception=Error}else{Exception=function(b){this.message=b||"an exception has occurred";var a=this;this.toString=function(){return a.message}}}})();function FreeFormAddress(b,a){if(!b||b.toString()==""){throw new Exception("Error instantiating FreeFormAddress, invalid parameters.");return false}this.locale=a||new Locale("en","US");this.address=b;this.type="FreeForm"}FreeFormAddress.prototype.getLocale=function(){return this.locale};FreeFormAddress.prototype.toString=function(){return this.address};function GeocodedAddress(){this.position=null;this.freeFormAddress=null;this.structuredAddress=null;this.boundingBox=null;this.matchType=""}GeocodedAddress.prototype.toString=function(){return this.position+"\n"+this.freeFormAddress+"\n"+this.boundingBox+"\n"+this.matchType};function Geocoder(){this.xmlRecFac=new deCarta.XMLStringBuilder();this.returnFreeForm=true;var b=[];var a=this;this.locale;this.authenticate=function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating Geocoder, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.setConfiguration=function(c){if(!c){throw new Exception("error calling Geocoder.setConfiguration()")}Credentials.configuration=c;this.xmlRecFac.configuration=c};this.geocode=function(d,j,f,c){var h=Utilities.getRequestId();this.locale=d.locale;if(typeof j=="function"){b[h]=j}else{throw new Exception("Geocode.geocode: callBack must be a function, arg was: "+j)}var g=this.xmlRecFac.createGeocodeRequest(d,h,this.returnFreeForm,c);JSRequest.send(g,a.geocodeCallback,null,f)};this.reverseGeocode=function(c,h,d){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("Geocode.reverseGeocode: callBack must be a function, arg was: "+h)}var f=this.xmlRecFac.createReverseGeocodeRequest(c,g);JSRequest.send(f,a.reverseGeocodeCallback,null,d)};this.reverseGeocodeCallback=function(f){var d=f.XLS.Response.requestID;var c;if(deCarta.JSONParser.parseErrors(f)){c=new Address()}else{c=deCarta.JSONParser.parseAddress(f.XLS.Response.ReverseGeocodeResponse.ReverseGeocodedLocation.Address)}if((d>=0)&&b[d]){b[d](c);b[d]=undefined}};this.geocodeCallback=function(j){var l=[];var c=[];var f=[];var h=j.XLS.Response.requestID;if(deCarta.JSONParser.parseErrors(j)){}else{if(j.XLS.Response.GeocodeResponse.GeocodeResponseList){var k;if(j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress.length==undefined){k=[];k.push(j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress)}else{k=j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress}for(var d=0;d<k.length;d++){var g=new GeocodedAddress();l.push(new Position(k[d].Point.pos));g.position=new Position(k[d].Point.pos.toString());if(k[d].Address.freeFormAddress){g.freeFormAddress=new FreeFormAddress(k[d].Address.freeFormAddress,a.locale);c.push(new FreeFormAddress(k[d].Address.freeFormAddress,a.locale))}else{if(k[d].Address.Place){g.structuredAddress=deCarta.JSONParser.parseAddress(k[d].Address);g.structuredAddress.locale=a.locale;c.push(g.structuredAddress)}}if(k[d].BoundingBox){g.boundingBox=new BoundingBox(new Position(k[d].BoundingBox.pos[0].content),new Position(k[d].BoundingBox.pos[1].content))}g.matchType=k[d].GeocodeMatchCode.matchType;g.accuracy=k[d].GeocodeMatchCode.accuracy;f.push(g)}}}if((h>=0)&&b[h]){b[h](l,c,f);b[h]=undefined}}}function Icon(g,d,b,f,a,c){if(!g||(d!=0&&!d)||(b!=0&&!b)||(f!=0&&!f)||(a!=0&&!a)){throw new Exception("Error instantiating Icon, missing parameters. Icon(src,iconAnchorX,iconAnchorY,width,height) all required. The last parameter overlay is optional.")}this._previousX=null;this._previousY=null;this.src=g;this.anchorX=d;this.anchorY=b;this.width=f;this.height=a;this.overlay=c||new TextOverlay("",1,1)}Icon.prototype.getAnchorX=function(){return this.anchorX};Icon.prototype.getAnchorY=function(){return this.anchorY};Icon.prototype.getHeight=function(){return this.height};Icon.prototype.getOverlay=function(){return this.overlay};Icon.prototype.getSrc=function(){return this.src};Icon.prototype.getWidth=function(){return this.width};Icon.prototype.setAnchorX=function(a){this._previousX=this.anchorX;this.anchorX=a};Icon.prototype.setAnchorY=function(a){this._previousY=this.anchorY;this.anchorY=a};Icon.prototype.setHeight=function(a){this.height=a};Icon.prototype.setOverlay=function(a){this.overlay=a};Icon.prototype.setSrc=function(a){this.src=a};Icon.prototype.setWidth=function(a){this.width=a};deCarta.IdManager={};deCarta.IdManager.getUniqueId=function(c){var b=deCarta.IdManager.getUniqueId.seedNumber++;var a=null;if(c){a=""+c+b}else{a=b}return a};deCarta.IdManager.getUniqueId.seedNumber=10000;deCarta.IdManager.setTag=function(c,a,d){var b=deCarta.IdManager.tagDitionary;d=d||true;if(!c[b]){c[b]={}}c[b][a]=d};deCarta.IdManager.checkTag=function(c,a){var b=deCarta.IdManager.tagDitionary;if(c&&a){if(c[b]){return c[b][a]}}return undefined};deCarta.IdManager.tagDitionary="deCartaTagDictionary";function InfoWindow(b,c,f,d,a){this.init(b,c,f,d,a)}InfoWindow.prototype.xOffset=-20;InfoWindow.prototype.yOffset=0;InfoWindow.prototype.bubble=null;InfoWindow.prototype.bubbleClassName="decarta-bubble";InfoWindow.prototype.bubbleIgnoreMapEvents=false;InfoWindow.prototype.bubbleContent=null;InfoWindow.prototype.bubbleContentClassName="decarta-bubbleContent";InfoWindow.prototype.bubbleContentIgnoreMapEvents=false;InfoWindow.prototype.bubbleContentSelectable=false;InfoWindow.prototype.bubbleClose=null;InfoWindow.prototype.bubbleCloseClassName="decarta-close";InfoWindow.prototype.bubbleCloseIgnoreMapEvents=true;InfoWindow.prototype.associatedPin=null;InfoWindow.prototype.onCloseCallback=null;InfoWindow.prototype.onHideCallback=null;InfoWindow.prototype.onShowCallback=null;InfoWindow.prototype.shouldAutoCenter=false;InfoWindow.prototype.setAutoCenter=function(a){a=a||false;this.shouldAutoCenter=a};InfoWindow.prototype.setOnClose=function(a){this.onCloseCallback=a};InfoWindow.prototype.setOnHide=function(a){this.onHideCallback=a};InfoWindow.prototype.setOnShow=function(a){this.onShowCallback=a};InfoWindow.prototype.setIgnoreMapEvents=function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}this.resetMapEventIgnorance()};InfoWindow.prototype.setContentSelectable=function(a){this.bubbleContentSelectable=a;this.resetSelectability()};InfoWindow.prototype.init=function(d,f,h,g,b){var c;this.build();if(d){this.bubble=d;this.bubble.id="decarta-bubble";this.bubbleContent.style.position="absolute";this.bubble.appendChild(this.bubbleContent);if(this.bubbleClose){this.bubble.appendChild(this.bubbleClose)}}if(b){this.bubble.style.width=b.width+"px";this.bubble.style.height=b.height+"px";this.bubble.style.backgroundImage="url("+b.src+")";this.bubble.style.backgroundRepeat="no-repeat";this.bubble.style.backgroundColor="transparent";this.bubble.style.borderStyle="none"}if(g){if(!this.bubbleClose){this.buildCloseIcon(g.src)}this.bubbleClose.style.position="absolute";this.bubbleClose.style.top=g.anchorY+"px";this.bubbleClose.style.left=g.anchorX+"px";if(g.height){this.bubbleClose.style.height=g.height+"px"}if(g.width){this.bubbleClose.style.width=g.width+"px"}}if(f){this.xOffset=f}if(h){this.yOffset=h}if(Utilities.ie6){var a=this.bubble.getElementsByTagName("img");for(c=0;c<a.length;c++){if(a[c].src.match(/\bpng\b/g)){Utilities.fixPng(a[c])}}}};InfoWindow.prototype.build=function(){try{this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.className=this.bubbleClassName;this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.className=this.bubbleContentClassName;if(Credentials.infoWindowCloseButton){this.buildCloseIcon(Credentials.infoWindowCloseButton)}this.bubble.appendChild(this.bubbleContent)}catch(a){throw new Exception("build error:"+a.message)}};InfoWindow.prototype.buildCloseIcon=function(a){this.bubbleClose=document.createElement("img");if(a){this.bubbleClose.src=a}this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.className=this.bubbleCloseClassName;this.bubbleClose.owner=this;deCarta.Events.addEvent(this.bubbleClose,"click",InfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)};InfoWindow.prototype.setPosition=function(b,a){a=a||0;b=b||0;this.bubble.style.top=a-this.yOffset+"px";this.bubble.style.left=b-this.xOffset+"px"};InfoWindow.prototype.setContent=function(a){this.bubbleContent.innerHTML="";if(a.style){this.bubbleContent.appendChild(a)}else{this.bubbleContent.innerHTML=a}this.resetSelectability();this.resetMapEventIgnorance()};InfoWindow.prototype.resetSelectability=function(){var d=(this.bubbleContentSelectable)?Utilities.setSelectable:Utilities.setUnselectable;var a=this.bubbleContent;d(a);if(a.hasChildNodes()){var b=a.getElementsByTagName("*");for(var c=0;c<b.length;c++){d(b[c])}}};InfoWindow.prototype.resetMapEventIgnorance=function(){var d,c,f,b,a;if(this.bubbleIgnoreMapEvents){deCarta.IdManager.setTag(this.bubble,"ignoreForMapEvents");if(this.bubble.hasChildNodes()){b=this.bubble.childNodes;for(d=0;d<b.length;d++){f=b[d];if(f.id!=this.bubbleContentClassName&&f.id!=this.bubbleCloseClassName){a=f.getElementsByTagName("*");for(c=0;c<a.length;c++){deCarta.IdManager.setTag(a[c],"ignoreForMapEvents")}}}}}if(this.bubbleContentIgnoreMapEvents){deCarta.IdManager.setTag(this.bubbleContent,"ignoreForMapEvents");a=this.bubbleContent.getElementsByTagName("*");for(d=0;d<a.length;d++){deCarta.IdManager.setTag(a[d],"ignoreForMapEvents")}}if(this.bubbleCloseIgnoreMapEvents&&this.bubbleClose){deCarta.IdManager.setTag(this.bubbleClose,"ignoreForMapEvents")}};InfoWindow.prototype.show=function(a){this.bubble.style.zIndex=Pin.zIndexCounter+10000;this.bubbleContent.style.zIndex=Pin.zIndexCounter+10000;if(this.bubbleClose){this.bubbleClose.style.zIndex=Pin.zIndexCounter+10000}this.bubble.style.display="block";if(a){this.associatedPin=a}else{this.associatedPin=null}if(this.onShowCallback){this.onShowCallback()}this.autoCenter()};InfoWindow.prototype.hide=function(){this.bubble.style.display="none";if(this.onHideCallback){this.onHideCallback()}};InfoWindow.prototype.autoCenter=function(){var j=this.associatedPin;if(!(j&&j.map)||!this.shouldAutoCenter){return}var y=j.map;var f=j.pinImg.clientHeight;var m=j.pinImg.clientWidth;var v=parseInt(j.pinImg.style.top);var A=parseInt(j.pinImg.style.left);var B=Utilities.radsPerPixelAtZoomLevel(y.getTileSize(),y.getZoomController().selected);var p=j.getViewableBoundingBox(B);var z=p.getUpperLeftPosition();var r=y.posToMercPix(z);var w=new PixelPoint(r.x+m,r.y-f);var u=this.bubble.clientHeight;var t=this.bubble.clientWidth;var l=parseInt(this.bubble.style.top);var s=parseInt(this.bubble.style.left);var n=r.y+(v-l);var b=r.x-(A-s);var a=new PixelPoint(b,n);var h=new PixelPoint(b+t,n-u);var o=new PixelPoint(b,n-u);var k=new PixelPoint(b+t,n);var c=y.mercPixToPos(o);var q=y.mercPixToPos(k);var d=new BoundingBox(c,q);var g=d.getCenterPosition();y.panToPosition(g)};InfoWindow.eventClose=function(){var a=this.owner;if(a.onCloseCallback){a.onCloseCallback()}a.hide()};deCarta.JSONParser={};deCarta.JSONParser.parseAddress=function(d){var b=new Address();var a=d.Place;if(d.Place&&d.Place.length){for(var c=0;c<a.length;c++){f(b,a[c])}}else{if(d.Place&&d.Place.type){f(b,a)}}b.postalCode=(d.PostalCode)?d.PostalCode:"";b.countryCode=d.countryCode;if(d.StreetAddress&&d.StreetAddress.Street){b.street=d.StreetAddress.Street.content||((typeof d.StreetAddress.Street=="string")?d.StreetAddress.Street:"");b.speedLimit=d.StreetAddress.Street.speedLimit||"";if(d.StreetAddress.Building){b.buildingNumber=d.StreetAddress.Building.number}}return b;function f(h,g){switch(g.type){case"CountrySubdivision":h.countrySubdivision=g.content;break;case"CountrySecondarySubdivision":h.countrySecondarySubdivision=g.content;break;case"CountryTertiarySubdivision":h.countryTertiarySubdivision=g.content;break;case"MunicipalitySubdivision":h.municipalitySubdivision=g.content;break;case"Municipality":h.municipality=g.content;break;case"Landmark":h.landmark=g.content;break}}};deCarta.JSONParser.parsePOI=function(r){var g=[];if(r.POI.POIAttributeList&&r.POI.POIAttributeList.POIInfoList&&r.POI.POIAttributeList.POIInfoList.POIInfo){g=r.POI.POIAttributeList.POIInfoList.POIInfo}var o={};for(var d=0;d<g.length;d++){var l=g[d];var j;for(var h in l){if(h=="name"){j=l[h]}else{if(h=="value"){o[j]=l[h]}}}}if(r.POI.ID){o.ID=r.POI.ID}var c=r.POI.POIName;var s=r.POI.phoneNumber;var m=r.POI.Point.pos;var q=deCarta.JSONParser.parseAddress(r.POI.Address);var f=new POI(c,new Position(m),q,s,o);if(r.Distance.length){for(var k=0;k<r.Distance.length;k++){var b=r.Distance[k].value;var a=r.Distance[k].uom;if(r.Distance[k].onRoute){f.distance={value:parseInt(b),uom:new UOM(a)}}else{f.distanceOffRoute={value:parseInt(b),uom:new UOM(a)}}}}else{var b=r.Distance.value;var a=r.Distance.uom;f.distance={value:parseInt(b),uom:new UOM(a)}}return f};deCarta.JSONParser.parseRoutes=function(f){var d;var c=f.XLS.Response.DetermineRouteResponse;var b=g(c);if(c.AlternateRoute){var j=c.AlternateRoute;var a=j.length;if(a==undefined){b.alternates[0]=g(j)}else{for(d=0;d<a;d++){b.alternates[d]=g(j[d])}}}return b;function g(s){var y=new Route();var p=s.RouteSummary;y.TotalTime=Utilities.podParse(p.TotalTime);y.TotalTimeObject=Utilities.podParseJSON(p.TotalTime);y.TotalDistance=p.TotalDistance.value;y.uom=new UOM(p.TotalDistance.uom);var n=p.BoundingBox;if(n){var r=new Position(n.pos[0].content);var t=new Position(n.pos[1].content);y.boundingBox=new BoundingBox(r,t);y.centerPosition=y.boundingBox.getCenterPosition()}var z=s.RouteHandle;if(z&&z.routeID){y.routeID=z.routeID}var u=s.viaPointSequence;if(u){y.viaPointSequence=u}var w=s.RouteGeometry;if(w){var m=w.LineString.pos;var v=m.length;if(v==undefined||!(deCarta.Array.isArray(m))){y.RouteGeometry[0]=new Position(m)}else{for(d=0;d<v;d++){y.RouteGeometry[d]=new Position(m[d])}}}var k=s.RouteInstructionsList;var q=s.RouteMap;if(k){var l=k.RouteInstruction;var A=l.length;if(A==undefined){y.RouteInstructions[0]=h(l)}else{for(d=0;d<A;d++){y.RouteInstructions[d]=h(l[d]);if(q){var o=new ManeuverMap();o.desc=q[d].Content.description;o.URL=q[d].Content.URL;o.format=q[d].Content.format;o.height=q[d].Content.height;o.width=q[d].Content.width;o.boundingBox=new BoundingBox(new Position(q[d].BBoxContext.pos[0].content),new Position(q[d].BBoxContext.pos[1].content));y.RouteInstructions[d].maneuverMap=o}}}}return y}function h(l){var k=new RouteInstruction();k.Instruction=l.Instruction;k.distance=l.distance.value;k.duration=Utilities.podParse(l.duration);k.position=new Position(l.Point);k.tour=l.tour;return k}};deCarta.JSONParser.parseErrors=function(b){var a=(b.XLS.ResponseHeader.ErrorList)?true:false;if(b.XLS.Response.ErrorList){a=true}return a};deCarta.JSONViewer=function(){deCarta.StyleManager.init();var j=0;var b="";var g=false;var d=0;var a="decarta-json-reflector";var f="decarta-json-type";var h="decarta-json-relation";var k="decarta-json-string";var c="decarta-json-number";this.reflect=function(w){var o;if(!g){j++}if(typeof(w)==="string"){r(null,w);return}else{if(typeof(w)==="number"){v(null,w);return}else{if(typeof(w)==="boolean"){E(null,w);return}else{if(typeof(w)==="null"){B(null,w);return}else{if(typeof(w)==="undefined"){u(null,w);return}else{if(g){if(Object.prototype.toString.call(w)==="[object Array]"){A(null,w);o=d;d=0;for(var F=0;F<w.length;F++){d++;this.reflect(w[F])}d=o;return}else{q(null);g=false;this.reflect(w);g=true;return}}else{for(var l in w){if(typeof(w[l])==="string"){r(l,w[l])}else{if(typeof(w[l])==="number"){v(l,w[l])}else{if(typeof(w[l])==="boolean"){E(l,w[l])}else{if(typeof(w[l])==="null"){B(l,w[l])}else{if(typeof(w[l])==="undefined"){u(l,w[l])}else{if(Object.prototype.toString.call(w[l])==="[object Array]"){A(l,w[l]);g=true;o=d;d=0;for(var D=0;D<w[l].length;D++){d++;this.reflect(w[l][D])}d=o;g=false}else{q(l);this.reflect(w[l])}}}}}}}}}}}}}j--;function r(s,t){var n;if(s){n=y("string ")+s+G()+z(t)}else{n=y("string ")+z(t)}m(n)}function v(s,t){var n;if(s){n=y("number ")+s+G()+C(t)}else{n=y("number ")+C(t)}m(n)}function E(s,t){var n;if(s){n=y("boolean ")+s+G()+C(t)}else{n=y("boolean ")+C(t)}m(n)}function B(s,t){var n;if(s){n=y("null ")+s+G()+C(t)}else{n=y("null ")+C(t)}m(n)}function u(s,t){var n;if(s){n=y("undefined ")+s+G()+C(t)}else{n=y("undefined ")+C(t)}m(n)}function A(s,t){var n;if(s){n=y("array ")+s+" ("+t.length+")"}else{n=y("array ")+" ("+t.length+")"}m(n)}function q(s){var n;if(s){n=y("object ")+s}else{n=y("object ")}m(n)}function y(n){return"<span class='"+f+"'>"+n+"</span>"}function G(){return"<span class='"+h+"'> = </span>"}function z(n){return"<span class='"+k+"'>\""+n+'"</span>'}function C(s){return"<span class='"+c+"'>"+s+"</span>"}function m(n){if(g){b+=p()+"["+d+"]"+n+"\n"}else{b+=p()+n+"\n"}}function p(){var s="";for(var n=0;n<j;n++){s+="\t"}return s}};this.show=function(){var l;l=document.getElementById(a);if(!l){l=document.createElement("pre");l.id=a;document.body.appendChild(l)}l.innerHTML+=b};this.clear=function(){b="";document.getElementById(a).innerHTML=""}};function JSRequest(){}JSRequest.host=null;JSRequest.TIMEOUT=60000;JSRequest.tHandler=function(a){throw new Exception("JSRequest timeout on requestID: "+a)};JSRequest.qtHandler=[];JSRequest.xmlhttp=true;JSRequest.hostInProgress=false;JSRequest.holder=[];JSRequest.callbackFunctions=[];JSRequest.interceptorXMLHTTPRequest=null;JSRequest.interceptorXMLRequest=null;JSRequest.interceptorXMLResponse=null;JSRequest.interceptorJSONResponse=null;JSRequest.registerXMLHTTPRequestInterceptor=function(a){JSRequest.interceptorXMLHTTPRequest=a};JSRequest.registerXMLRequestInterceptor=function(a){JSRequest.interceptorXMLRequest=a};JSRequest.registerQueryTimeoutHandler=function(b,a){JSRequest.qtHandler[b]=a};JSRequest.registerXMLResponseInterceptor=function(a){JSRequest.interceptorXMLResponse=a};JSRequest.registerJSONResponseInterceptor=function(a){JSRequest.interceptorJSONResponse=a};JSRequest.callbackRegistry=function(b){if(GLOBALS.DEBUG_JSON&&b){if(!window.jsonViewer){window.jsonViewer=new deCarta.JSONViewer()}window.jsonViewer.reflect(b);window.jsonViewer.show()}try{if(b&&(b.response!=null)){try{if(typeof JSRequest.interceptorXMLResponse==="function"&&b.xmlResponse){var a=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(b.xmlResponse),"text/xml");if(b.xmlResponse.indexOf("RUOK")==-1){JSRequest.interceptorXMLResponse(a)}}if(typeof JSRequest.interceptorJSONResponse==="function"){b.response=JSRequest.interceptorJSONResponse(b.response)}}catch(c){throw new Exception("Application Error: API user application response interceptor function threw error: "+c.message)}if(JSRequest.callbackFunctions[b.requestID]){if(b.responseFormat=="XML"){}else{if(deCarta.Array.isArray(b.response.XLS.Response)){if(b.response.XLS.Response[0].requestID==-1){b.response.XLS.Response[0].requestID=b.requestID}}else{if(b.response.XLS.Response.requestID==-1){b.response.XLS.Response.requestID=b.requestID}}}JSRequest.callbackFunctions[b.requestID](b.response);JSRequest.callbackFunctions[b.requestID]=undefined;JSRequest.qtHandler[b.requestID]=undefined}}if(document.getElementById(b.requestID+":"+b.chunkNo)){document.getElementsByTagName("head").item(0).removeChild(document.getElementById(b.requestID+":"+b.chunkNo))}}catch(c){throw new Exception(c.message)}};JSRequest.checkTimeout=function(c){var b=(c.split(":"))[0];if(JSRequest.callbackFunctions[b]||JSRequest.qtHandler[b]){JSRequest.host=null;JSRequest.tHandler(b);if(typeof JSRequest.qtHandler[b]=="function"){JSRequest.qtHandler[b](b);JSRequest.qtHandler[b]=undefined}JSRequest.callbackFunctions[b]=undefined;var a=document.getElementById(c);if(a){document.getElementsByTagName("head").item(0).removeChild(a)}}};JSRequest.timeoutHandler=function(b,a){JSRequest.tHandler=b;JSRequest.TIMEOUT=a||60000};JSRequest.send=function(f,j,s,m,l){if(!f){return}var k=s?"responseFormat="+s:(typeof JSRequest.interceptorXMLRequest==="function"||typeof JSRequest.interceptorXMLResponse==="function")?"responseFormat=ALL":"responseFormat=JSON";var h=(l)?l:Credentials.url;if((/\/openls$|\/openls\/$/.test(h))&&!l){h=h.substring(0,Credentials.url.lastIndexOf("openls"))+Credentials.jsonServletName}if(JSRequest.xmlhttp){JSRequest.sendXHR(f,j,k,h);return}if(JSRequest.host==null&&!l){JSRequest.holder.push(f);JSRequest.holder.push(j);JSRequest.holder.push(s);JSRequest.holder.push(m);if(JSRequest.hostInProgress){return}JSRequest.hostInProgress=true;m=JSRequest.getHostTimeout;var b=new deCarta.XMLStringBuilder();var c=b.createRUOKRequest(Utilities.getRequestId());f=c;j=JSRequest.getHost;k="responseFormat=JSON"}try{if(typeof JSRequest.interceptorXMLRequest==="function"&&JSRequest.host!=null){f=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(f),"text/xml");f=Sarissa.serialize(JSRequest.interceptorXMLRequest(f))}}catch(y){throw new Exception("Application Error: API user application request interceptor function threw error: "+y.message)}var u=1800;var z=h.length;var a=80;var w=(encodeURIComponent(f)).length;var o;var v=1;while(true){if(z+a+(w/v)<u){o=v;break}v++}var q="";var A=Math.ceil(f.length/o);var r=Utilities.parseRequestIDFromXLS(f);var p=0;for(v=1;v<=o;v++){JSRequest.callbackFunctions[r]=j;JSRequest.qtHandler[r]=m;var g;if(p==0){g=Math.round(A*v-A)}else{g=p}var d=Math.round(A*v);p=d;var n=f.substring(g,d);q=encodeURIComponent(n);var B=document.createElement("script");B.setAttribute("type","text/javascript");var t=h+"?reqID="+r+"&chunkNo="+v+"&numChunks="+o+"&callback=JSRequest.callbackRegistry&data="+q+"&"+k;t=t.replace(new RegExp("\\+","g"),"%2b");B.setAttribute("src",t);B.setAttribute("id",r+":"+v);document.getElementsByTagName("head").item(0).appendChild(B);if(JSRequest.TIMEOUT!=-1){setTimeout("JSRequest.checkTimeout('"+r+":"+v+"')",JSRequest.TIMEOUT)}}};JSRequest.sendXHR=function(xml,callback,responseFormat,url){try{if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(e){}}var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url+"?"+responseFormat,true)}catch(e){throw new Exception(e.message+"Depending on your browser settings you may have troubles running JavaScript code that uses the XMLHTTPRequest from your local file system.  XMLHTTPRequest verifies that the request to the server is from a script that is downloaded from that same server.  To remedy this problem, place your app inside tomcat and access from localhost.  Or see the feature of using dynamic script tags (JSON/GET) to bypass this security issue.")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.responseText==""){throw new Exception("Problem connecting to DDS Web Services: Please try again later or contact support")}if(xmlhttp.responseText&&xmlhttp.responseText!=null&&xmlhttp.responseText.indexOf("problem connecting to DDS")>0){throw new Exception("Problem connecting to DDS: Please try again later or contact support")}var r=eval(xmlhttp.responseText);if(typeof JSRequest.interceptorXMLResponse==="function"&&r.xmlResponse){var xml=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(r.xmlResponse),"text/xml");JSRequest.interceptorXMLResponse(xml)}if(typeof JSRequest.interceptorJSONResponse==="function"){r.response=JSRequest.interceptorJSONResponse(r.response)}if(r.response){callback(r.response)}else{callback(r)}}};if(typeof JSRequest.interceptorXMLHTTPRequest==="function"){JSRequest.interceptorXMLHTTPRequest(xmlhttp)}xmlhttp.send(xml);return};JSRequest.getHost=function(g){var d=g.XLS.Response.RUOKResponse.hostName;var a=Credentials.url;var f,h;if(a.indexOf("https://")>-1){f="https://"}else{f="http://"}var c=a.substring(f.length);if(c.indexOf(":")>-1){h=c.substring(c.indexOf(":"))}else{h=c.substring(c.indexOf("/"))}JSRequest.host=f+d+h;Credentials.url=JSRequest.host;for(var b=0;b<JSRequest.holder.length;b++){JSRequest.send(JSRequest.holder[b],JSRequest.holder[b+1],JSRequest.holder[b+2],JSRequest.holder[b+3]);b=b+3}JSRequest.holder=[];JSRequest.hostInProgress=false};JSRequest.getHostTimeout=function(b){for(var a=0;a<JSRequest.holder.length;a++){if(typeof JSRequest.holder[a+3]=="function"){JSRequest.holder[a+3](null)}a=a+3}JSRequest.holder=[];JSRequest.hostInProgress=false};JSRequest.setXMLHTTPMode=function(){JSRequest.xmlhttp=true};JSRequest.setDynamicScriptTagMode=function(){JSRequest.xmlhttp=false};JSRequest.emulatedZoomRequest=function(y,l,d,g,k){_ll_LUT=["0.000345636472797214,0.000343322753906250","0.000691272945568983,0.000686645507812500","0.001382546303032519,0.001373291015625000","0.002765092605263539,0.002746582031250000","0.005530185203987857,0.005493164062500000","0.011060370355776452,0.010986328125000000","0.022120740293895182,0.021972656250000000","0.044241477246363230,0.043945312500000000","0.088482927761462040,0.087890625000000000","0.176965641673330230,0.175781250000000000","0.353929573271679340,0.351562500000000000","0.707845460801532700,0.703125000000000000","1.415581451872543800,1.406250000000000000","2.830287664051185000,2.812500000000000000","5.653589942659626000,5.625000000000000000","11.251819676168665000,11.250000000000000000","22.076741328793200000,22.500000000000000000","41.170427238429790000,45.000000000000000000","66.653475896509040000,90.00000000000000000","85.084059050110410000,180.00000000000000000","89.787438015348100000,360.00000000000000000"];var m=GLOBALS.DEFAULT_MAP_TILE_SIZE;var B=Utilities.radsPerPixelAtZoomLevel(m,l);var c=0;var v=0;var w=0;var u=0;var n=0;var f=0;var r=y.lat;var o=y.lon;w=Math.round(Utilities.lon2pix(o,B));u=Math.round(Utilities.lat2pix(r,B));var s=r;var p=o;n=(m+(w%m))%m;f=(m+(u%m))%m;var A=n-m/2;var z=f-m/2;r=Utilities.pix2lat(u-f+m/2,B);o=Utilities.pix2lon(w-n+m/2,B);v=Math.floor(w/m);c=Math.floor(u/m);var j=m/2*B*Utilities.EARTH_RADIUS_METERS;j*=Math.cos(r*Math.PI/180);var t="";var b="";if(d){var q=Utilities.urlParse(d.baseUrl);q.queryParameters.LLMAX=_ll_LUT[l-1];q.queryParameters.N=c;q.queryParameters.E=v;b=Utilities.urlCompose(q)}if(g){var h=Utilities.urlParse(g.baseUrl);h.queryParameters.ZOOM=Utilities.deCartaToGXZoomLevel(l);h.queryParameters.LL=y.lat+", "+y.lon;h.queryParameters.N=0;h.queryParameters.E=0;t=Utilities.urlCompose(h)}var a={};a.XLS={};a.XLS.Response={};a.XLS.ResponseHeader={};a.XLS.ResponseHeader.ErrorList=false;a.XLS.Response.PortrayMapResponse={};a.XLS.Response.PortrayMapResponse.TileGrid=[];a.XLS.Response.PortrayMapResponse.TileGrid[0]={};a.XLS.Response.PortrayMapResponse.TileGrid[1]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan=[];a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].direction="E";a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].numTiles=(A/GLOBALS.DEFAULT_MAP_TILE_SIZE);a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].toLon=p;a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].direction="N";a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].numTiles=z/GLOBALS.DEFAULT_MAP_TILE_SIZE;a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].toLat=s;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content=r+" "+o;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.radius={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.radius.content=j;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content=j;a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL=b;a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL=t;if(typeof k==="function"){k(a)}};function KML(c,a,b){if(!c){throw new Exception("Error constructing a KML object, geometry is required")}this.geometry=c;this.name=a||null;this.description=b||null}function KMLGeometry(a,b){this.type=a;this.coordinates=b}deCarta.LinkedList=function(){this.length=0;this.head=null;this.index=deCarta.LinkedList.Config.genIndex()};deCarta.LinkedList.Config={};deCarta.LinkedList.Config.itemBackPointer="dCLLItemPointer";deCarta.LinkedList.Config.itemBackPointerIndex=0;deCarta.LinkedList.Config.genIndex=function(){return(deCarta.LinkedList.Config.itemBackPointer+deCarta.LinkedList.Config.itemBackPointerIndex++)};deCarta.LinkedList.prototype.add=function(a){var b=null;try{b=new deCarta.LinkedListItem(a,this.index)}catch(c){throw new Exception("Error LinkedList.add(): "+c.message)}if(!this.head){this.head=b;this.head.next=null;this.head.prev=null}else{this.head.prev=b;b.next=this.head;b.prev=null;this.head=b}this.length++};deCarta.LinkedList.prototype.remove=function(b){var c=null;var a=null;if(this.length<=0){return null}if(!b){c=this.head;this.head=c.next}else{if((b.data)&&b.data.hasOwnProperty(this.index)){c=b}else{if(b.hasOwnProperty(this.index)){c=b[this.index]}else{throw new Exception("Attempting to remove an item that's not really a part of the LinkedList.")}}}if(c.prev){c.prev.next=c.next}else{this.head=c.next}if(c.next){c.next.prev=c.prev}a=c.destroy(this.index);this.length--;return a};deCarta.LinkedList.prototype.removeByKey=function(g,b){var f;var d=this.length;var a=this.head;var c;var h=new Array();if(!g||!b){throw new Exception("Attempt to removeByKey keyName: "+g+" and keyVal: "+b)}if(this.length<=0){return null}for(f=0;f<d;f++){c=a;a=c.next;if(b==c.data[g.toString()]){h.push(this.remove(c))}}if(!h.length){return null}else{return h}};deCarta.LinkedList.prototype.removeById=function(c,h){var g;var f=this.length;var b=this.head;var d;var a=null;if(!c||!h){throw new Exception("Attempt to removeByKey keyName: "+c+" and keyVal: "+h)}if(this.length<=0){return null}for(g=0;g<f;g++){d=b;b=d.next;if(h==d.data[c.toString()]){a=this.remove(d);return a}}return null};deCarta.LinkedList.prototype.removeAll=function(){var a=[];var b=null;while(this.length>0){b=this.remove();a.push(b)}return a};deCarta.LinkedList.prototype.returnAsArray=function(){var a=[];var b;var d=this.head;var c=null;for(b=0;b<this.length;b++){a.push(d.data);c=d.next;d=c}return a};deCarta.LinkedList.prototype.operateOnData=function(a){var b;var d=this.head;var c=null;if(typeof a!="function"){throw new Exception("Attempt operateOnData without a function.")}for(b=0;b<this.length;b++){a(d.data);c=d.next;d=c}};deCarta.LinkedListItem=function(b,a){if(!b||(typeof b!="object")||!a){throw new Exception("LinkedList Error: Attempt to add null or primitive.")}if(b.hasOwnProperty(a)){throw new Exception("LinkedList Error: newData already containsproperty backpointer: "+a)}this.data=b;b[a]=this;this.next=null;this.prev=null};deCarta.LinkedListItem.prototype.destroy=function(b){var a=this.data;this.data=null;this.next=null;this.prev=null;delete a[b];return a};function Locale(b,a){this.language=b.toUpperCase();this.country=a.toUpperCase()}Locale.prototype.getLanguage=function(){return this.language};Locale.prototype.setLanguage=function(a){this.language=a.toUpperCase()};Locale.prototype.getCountry=function(){return this.country};Locale.prototype.setCountry=function(a){this.country=a.toUpperCase()};Locale.prototype.toString=function(){return this.country+"_"+this.language};function Map(S){deCarta.StyleManager.init();if(!(S&&S.style)){throw new Exception("Must supply a div element to construct the map.")}this.mapDiv=S;var b=parseInt(deCarta.StyleManager.getCurrentStyle(S,"height"));b=(!isNaN(b))?b:this.mapDiv.offsetHeight;b=(b)?b+"px":GLOBALS.DEFAULT_MAP_HEIGHT;this.mapDiv.style.height=b;var aV=parseInt(deCarta.StyleManager.getCurrentStyle(S,"width"));aV=(!isNaN(aV))?aV:this.mapDiv.offsetWidth;aV=(aV)?aV+"px":GLOBALS.DEFAULT_MAP_WIDTH;this.mapDiv.style.width=aV;this.type="map";var aO=this;var a={};var an=undefined;var aS=null;var B=null;var ag=null;var y=null;var aM=null;var N=null;var aF=null;var a5=new deCarta.XMLStringBuilder();a5.mapType=GLOBALS.STREET;var a8="server";var aT=false;var g=[];var U=new Array();var ac=new deCarta.LinkedList();var n={};var aQ=null;var aa=null;var c=Utilities.ie;var A="px";var aH=0;var ak=true;var aU=false;var ai=0;var af=0;var Q=false;var aK=false;var a1=0;var aZ=0;var s=false;var V=true;var at=true;var aC=new Date();var aj=new Date();var f=false;var aw=false;var aY=false;var h=37;var ah=null;var D=GLOBALS.DEFAULT_MAP_TILE_SIZE;var j=D;var av=0;var a0=0;var C=2;var ap=false;var aG=new PixelPoint(0,0);var aL=0;var aI=0;var aP=0;var aN=0;var a6=0;var aJ=0;var au=0;var ar=0;var a2=false;var T=false;var am=false;var ax={x:0,y:0};var Z={x:0,y:0};var E=null;var aW=null;var d=null;var aq=null;var I=true;var R=undefined;var F=false;this.authenticate=function(ba,a9){if(!ba||!a9||ba==""||a9==""){throw new Exception("Error calling Map.authenticate(), bad params")}Credentials.clientName=ba;Credentials.clientPassword=a9;a5.clientName=ba;a5.clientPassword=a9};this.setURL=function(a9){Credentials.url=a9};this.setConfiguration=function(a9){if(!a9){throw new Exception("error calling Map.setConfiguration() with argument: "+a9)}Credentials.configuration=a9;a5.configuration=a9};this.setTransparentConfiguration=function(a9){if(!a9){throw new Exception("error calling Map.setTransparentConfiguration() with arg: "+a9)}Credentials.transparentConfiguration=a9;a5.transparentConfiguration=a9};this.setMapStyle=function(a9){Credentials.configuration=a9;a5.configuration=a9;if(n[GLOBALS.STREET]&&n[GLOBALS.STREET].refUrl){n[GLOBALS.STREET].refUrl.setParameter("config",a9);n[GLOBALS.STREET].refresh()}};this.setMapFormat=function(a9){a5.streetImgFormat=a9;if(n[GLOBALS.STREET]&&n[GLOBALS.STREET].refUrl){n[GLOBALS.STREET].refUrl.setParameter("format",a9);n[GLOBALS.STREET].refresh()}};this.changeCurrentMapStyle=function(a9){setMapStyle(a9)};this.reDrawMap=function(a9){if(!n[GLOBALS.STREET]&&!n[GLOBALS.SATELLITE]&&!n[GLOBALS.HYBRID]){return false}aO.centerOnPosition(aO.getCenterPosition(),a9);return true};this.addCopyrightMessage=function(ba,a9,bb){if(deCarta.String.isString(ba)){aS=new deCarta.CopyrightMessage(ba)}else{aS=ba}aO.addMapControl(aS);if(a9&&bb){aS.position=function(){};aS.frame.style.top=bb+A;aS.frame.style.left=a9+A}};this.centerOnPosition=function(a9,be,bc,ba){var bf=Utilities.getRequestId();if(typeof be=="function"){g[bf]=be}else{g[bf]=null}var bd=Utilities.getRequestId();var bb=a5.createMapRequest(a9,D,bf,B?B.getZoomLevel():5,null,bc,bd);JSRequest.send(bb,function(bg){ah=a9.clone();Y();aO.hidePinsBeforeZoom();ao(bg)},null,function(bg){g[bg]=undefined});if(y&&y.frame&&!ba){y.centerOnPosition(a9)}else{if(y&&y.frame&&ba){y.panToPosition(a9)}}};this.panToPosition=function(be,a9,bf){var bb=be.clone();var bh=aO.getCenterPosition();var bd=this.posToMercPix(bh);var ba=this.posToMercPix(bb);var bc=new PixelPoint(Math.round(bd.x-ba.x),Math.round(bd.y-ba.y));if(ah&&B.getRadius()){var bg=Utilities.centerContextToBoundingBox(bh,B.getRadius());if(bg.extendedContains(bb)){if(typeof a9=="function"){g.panToPosition=a9}else{g.panToPosition=null}if(bc.x==0&&bc.y==0){if(g.panToPosition){g.panToPosition(aO.getCenterPosition());g.panToPosition=undefined}return}else{if(bf){aP+=bc.x;aN-=bc.y;au+=bc.x;ar-=bc.y;aE(aP,aN);a4()}else{z(bc.x,-1*bc.y)}if(y&&y.frame){y.panToPosition(bb)}}}else{this.centerOnPosition(bb,a9,null,true)}}else{this.centerOnPosition(bb,a9,null,true)}};this.getCenterPosition=function(){if(!ah){throw new Exception("Center Position not set")}var bb=aP-a6;var ba=aN-aJ;if(bb==0&&ba==0){return ah}var a9=aO.posToMercPix(ah);a9.x-=bb;a9.y+=ba;var bc=aO.mercPixToPos(a9);return bc};this.addCustomInfoWindow=function(a9){if(aa&&aF){aa.removeChild(aF.bubble)}aF=a9;if(aa){aa.appendChild(aF.bubble)}};this.getInfoWindow=function(){var a9=aF||null;return a9};this.addAndCenterOnPin=function(a9){this.addPin(a9);this.panToPosition(a9.position)};this.addPin=function(a9){if(ah==null){throw new Exception("Error adding Pin, you can not add a pin until the center Position is set. Please use the callback of map.centerPosition().")}try{ac.add(a9)}catch(ba){return}a9.map=aO;a9.setPosition(a9.position);aa.appendChild(a9.pinImg);if(a9.pinTxt){aa.appendChild(a9.pinTxt)}};this.getPins=function(){return ac.returnAsArray()};this.getPinById=function(ba){var a9=null;ac.operateOnData(function(bb){if(!bb){return null}if(bb.getId()==ba){a9=bb}});return a9};this.hidePins=function(){ac.operateOnData(function(a9){if(!a9){return}a9.pinImg.style.display="none";a9.pinTxt.style.display="none"})};this.showPins=function(){ac.operateOnData(function(a9){a9.pinImg.style.display="block";a9.pinTxt.style.display="block"})};this.removeAllPins=function(){var a9;while(ac.length>0){a9=ac.remove();if(c){Utilities.purge(a9.pinImg)}aa.removeChild(a9.pinImg);a9.pinImg=null;if(a9.pinTxt){if(c){Utilities.purge(a9.pinTxt)}aa.removeChild(a9.pinTxt);a9.pinTxt=null}}};this.removePin=function(ba){var a9=null;try{a9=ac.remove(ba)}catch(bb){return}if(!a9){return}a9.destroy()};this.removePinById=function(bb){try{var a9=ac.removeById("id",bb)}catch(ba){return}if(!a9){return}if(a9.pinTxt){Utilities.purge(a9.pinTxt);aa.removeChild(a9.pinTxt);a9.pinTxt=null}Utilities.purge(a9.pinImg);aa.removeChild(a9.pinImg)};this.removePinsById=function(bd){var a9=null;var bb=null;var ba;try{a9=ac.removeByKey("id",bd)}catch(bc){return}if(!a9){return}for(ba=0,bb=a9.length;ba<bb;ba++){if(a9[ba].pinTxt){Utilities.purge(a9[ba].pinTxt);aa.removeChild(a9[ba].pinTxt);a9[ba].pinTxt=null}Utilities.purge(a9[ba].pinImg);aa.removeChild(a9[ba].pinImg)}};this.setDragEasingEnabled=function(a9){T=a9};this.setDragEnabled=function(a9){if(!"boolean"==(typeof a9)){throw new Exception("Map.setDragEnabled requires boolean")}ak=a9};this.setRightClickBBoxZoomEnabled=function(a9){if(!"boolean"==(typeof a9)){throw new Exception("Map.setRightClickBBoxZoomEnabled requires boolean")}a2=a9};this.setShapeClippingEnabled=function(a9){if(!"boolean"==(typeof a9)){throw new Exception("Map.setShapeClippingEnabled requires boolean")}aT=a9};this.setDoubleClickRecenteringEnabled=function(a9){if(!"boolean"==(typeof a9)){throw new Exception("Map.setDoubleClickRecenteringEnabled requires boolean")}at=a9};this.setDoubleClickRecenterAndZoom=function(a9){if(a9){aw=true}else{aw=false}};this.setDigitalZoomEnabled=function(a9){if(a9){V=true}else{V=false}};this.setTileFadingEnabled=function(a9){I=a9};this.getTileFading=function(){return I};this.setWheelZoomEnabled=function(a9){F=a9};this.setPanTimeoutDelay=function(a9){h=a9||37};this.addOverlay=function(a9){if(!a9){return}if(deCarta.Array.isArray(a9)){var bb=a9.length;for(var ba=0;ba<bb;ba++){a9[ba].map=aO;a5.overlays.push(a9[ba]);this.drawShape(a9[ba])}}else{a9.map=aO;a5.overlays.push(a9);this.drawShape(a9)}};this.drawShape=function(bg,bc){if(!(bg instanceof DDSShape)){return}if(bg.rendering=="server"||(a8=="server"&&bg.rendering!="client")){return}if(!bg.isVisible){return}if(!aO.getTileDiv()){return}var a9=aW;if(!a9){aW=a9=k()}var bm=aO.getBoundingBox();var bh=a9.bbox;if(!bc&&w(bg,bm,bh)){aB();return}if(bg.raphael_element){bg.raphael_element.remove()}var bw=B.getZoomLevel();var bf=Utilities.radsPerPixelAtZoomLevel(D,bw);var be=new Position(bh.maxPosition.lat+" "+bh.minPosition.lon);var bi=Math.round(Utilities.lat2pix(be.lat,bf));var bj=Math.round(Utilities.lon2pix(be.lon,bf));var bt="rgb("+bg.borderColorRed+","+bg.borderColorGreen+","+bg.borderColorBlue+")";var bI="rgb("+bg.fillColorRed+","+bg.fillColorGreen+","+bg.fillColorBlue+")";var bs=bg.fillOpacityFloat;var bb=bg.getBorderWidth();var bd=bg.strokeOpacityFloat;var bJ=null;var bl=[];if(bg.type=="polygon"||bg.type=="line"){var bA="";var bH=[];var bG=[];if(bg.type=="line"){bb=bg.getWidth();bI="none";if(bg.clip||aT){bl=bg.getMercPixelsClipped(bw,D,bh)}else{bl[0]=bg.getMercPixels(bw,D)}}else{if(bg.type=="polygon"){bl[0]=bg.getMercPixels(bw,D)}else{throw new Exception("Map inner function draw: fell through to unacceptable situation with line/polygon client side rendering.")}}var ba=Math.round(Utilities.lon2pix(180,bf));var bx=bg.getBoundingBox();var bu=bh.minPosition.lon-bx.minPosition.lon;var bk=bl.length;for(var bF=0;bF<bk;bF++){var br=bl[bF].length;bH[bF]=[];bG[bF]=[];for(var bE=0;bE<br;bE++){var bC=bl[bF][bE];bH[bF][bE]=parseInt(bj-bC.x);if(bu>180){bH[bF][bE]=bH[bF][bE]-2*ba}else{if(bu<(-180)){bH[bF][bE]=bH[bF][bE]+2*ba}}bG[bF][bE]=parseInt(bi-bC.y);if(bE==0){bA+="M "+bH[bF][bE]*-1+" "+bG[bF][bE]+" "}else{bA+="L "+bH[bF][bE]*-1+" "+bG[bF][bE]+" "}}}if(bg.type=="polygon"){bA+="z"}bJ=a9.path(bA)}else{if(bg.type=="circle"){var bq=bg.getPosition();var bn=Math.round(Utilities.lat2pix(bq.lat,bf));var bp=Math.round(Utilities.lon2pix(bq.lon,bf));var by=parseInt(bj-bp);var bv=parseInt(bi-bn);var bB=bg.getRadius().getDegrees();var bD=Math.round(Utilities.lat2pix(bq.lat+bB,bf));var bo=parseInt(bD-bn);bJ=a9.circle(-by,bv,bo)}}bJ.attr({stroke:bt,fill:bI,"fill-opacity":bs,"stroke-width":bb,"stroke-opacity":bd});for(var bz in bg.eventListenerMap){if(bg.eventListenerMap.hasOwnProperty(bz)){if(typeof(bg.eventListenerMap[bz])=="function"){bJ.node[bz]=function(bN){bN=bN?bN:window.event;var bL=this.raphael.owner_shape;var bK=bN.type;bK="on"+bK;var bM=bL.eventListenerMap[bK];bM(bL)}}}}bJ.owner_shape=bg;deCarta.IdManager.setTag(bJ.node,"ignoreForMapEvents");bg.raphael_element=bJ};this.getOverlays=function(){var ba=[];var bb=a5.overlays.length;for(var a9=0;a9<bb;a9++){ba[a9]=a5.overlays[a9]}return ba};this.getOverlayById=function(ba){for(var a9=0;a9<a5.overlays.length;a9++){if(a5.overlays[a9]&&a5.overlays[a9].id==(ba)){return a5.overlays[a9]}}return null};this.removeOverlay=function(a9){if(!a9){return}a9.map=null;var bb=new Array();for(var ba=0;ba<a5.overlays.length;ba++){if(a5.overlays[ba]&&!a5.overlays[ba].equals(a9)){bb.push(a5.overlays[ba])}}a5.overlays=bb;if(a9.raphael_element){a9.raphael_element.remove()}a9.raphael_element=null};this.removeOverlayById=function(bb){var ba=new Array();for(var a9=0;a9<a5.overlays.length;a9++){if(a5.overlays[a9]&&a5.overlays[a9].id!=(bb)){ba.push(a5.overlays[a9])}else{if(a5.overlays[a9]&&a5.overlays[a9].id==(bb)){a5.overlays[a9].map=null;if(a5.overlays[a9].raphael_element){a5.overlays[a9].raphael_element.remove();a5.overlays[a9].raphael_element=null}}}}a5.overlays=ba};this.removeAllOverlays=function(){if(a5&&a5.overlays&&(a5.overlays.length<=0)){return}a5.overlays=[];aB(true)};this.addRouteIDOverlay=function(a9){a5.routeIDOverlay=a9};this.removeRouteIDOverlay=function(){a5.routeIDOverlay=null};this.setShapeRendering=function(a9){if(!a9||!a9=="client"||!a9=="server"){throw new Exception("map.setShapeRendering() error: use 'client' or 'server'")}if(a9=="server"){az()}else{a8=a9;a5.rendering=a9;aB()}a8=a9;a5.rendering=a9};this.getShapeRendering=function(){return a8};function w(a9,bb,bd){if(!bb){return false}if(!bd){return true}if(bd.equals(bb)||bd.containsBoundingBox(bb)){return false}var be=a9.getBoundingBox();if(bd.containsBoundingBox(be)){return false}var ba=be.getOverlapBoundingBox(bd);var bc=be.getOverlapBoundingBox(bb);if(bc&&(!ba||!ba.containsBoundingBox(bc))){return true}else{return false}}this.onRotate=function(a9){R=a9};this.redraw=function(){var ba=false;var a9=a5.overlays;if(!aW){return}if(!aO.getTileDiv()){return}aB()};this.panWest=function(){z(GLOBALS.PAN_PIXEL_DISTANCE,0)};this.panEast=function(){z(-GLOBALS.PAN_PIXEL_DISTANCE,0)};this.panNorth=function(){z(0,GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouth=function(){z(0,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouthEast=function(){z(-GLOBALS.PAN_PIXEL_DISTANCE,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panNorthEast=function(){z(-GLOBALS.PAN_PIXEL_DISTANCE,GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouthWest=function(){z(GLOBALS.PAN_PIXEL_DISTANCE,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panNorthWest=function(){z(GLOBALS.PAN_PIXEL_DISTANCE,GLOBALS.PAN_PIXEL_DISTANCE)};this.addScaleBar=function(a9){an=a9;aO.addMapControl(an)};this.getScaleBar=function(){return an};this.addMapTypeController=function(a9){if(!a9){throw new Exception("error adding mapTypeController to map")}N=a9;aO.addMapControl(N)};this.setMapType=function(ba){if(!(ba==GLOBALS.STREET||ba==GLOBALS.HYBRID||ba==GLOBALS.SATELLITE)){throw new Exception("unsupported mapType. Use '"+GLOBALS.STREET+"' || '"+GLOBALS.HYBRID+"' || '"+GLOBALS.SATELLITE+"'")}a5.mapType=ba;var a9=false;if(!n||Utilities.isObjectEmpty(n)){return}if(aQ){aQ.hide()}if(!n[ba]){ab(ba);a9=true}for(layerType in n){if(layerType==ba){n[layerType].show();if(ba==GLOBALS.HYBRID){n[GLOBALS.SATELLITE].show()}}else{if(ba==GLOBALS.HYBRID){if(layerType!=GLOBALS.SATELLITE){n[layerType].hide()}}else{n[layerType].hide()}}}if(y&&y.frame){y.setMapType(ba)}if(a9){this.centerOnPosition(aO.getCenterPosition())}};this.addZoomController=function(a9){B=a9;aO.addMapControl(B);if(ag){B.frame.style.top="61px";B.frame.style.left="21px"}};this.addShapeDrawingTool=function(a9){aM=a9;aO.addMapControl(aM)};this.addPanController=function(a9){ag=a9;aO.addMapControl(ag);if(B){B.frame.style.top="61px";B.frame.style.left="21px"}};this.addMapOverviewController=function(a9){y=a9;aO.addMapControl(y)};this.getZoomController=function(){return B};this.getPanController=function(){return ag};this.getXmlRecFac=function(){return a5};this.resize=function(bi,a9,bg){var bc=parseInt(aO.mapDiv.style.width);var bh=parseInt(aO.mapDiv.style.height);aO.mapDiv.style.height=parseInt(bi)+A;aO.mapDiv.style.width=parseInt(a9)+A;aO.positionMapControls();if(!aa){return}a3();for(var bd in n){if(n.hasOwnProperty(bd)){var bf=n[bd];bf.resize(av,a0)}}var bb=aP-a6-(parseInt(a9)-bc)/2;var ba=aN-aJ-(parseInt(bi)-bh)/2;var be=aO.posToMercPix(ah);be.x-=bb;be.y+=ba;ah=aO.mercPixToPos(be);a6=aP;aJ=aN;if(typeof bg=="function"){bg(aO.getCenterPosition())}if(y&&y.frame){y.panToPosition(aO.getCenterPosition())}P();q()};this.getBoundingBox=function(){var bc=aO.posToMercPix(aO.getCenterPosition());var ba=(a0*D/2);var bg=(av*D/2);var bd=new PixelPoint(bc.x+bg,bc.y+ba);var be=new PixelPoint(bc.x-bg,bc.y-ba);var a9=aO.mercPixToPos(bd);var bb=aO.mercPixToPos(be);var bf=new BoundingBox(bb,a9);return bf};this.getBoundingBoxViewable=function(){var bb=aO.posToMercPix(aO.getCenterPosition());var ba=parseInt(aO.mapDiv.style.height)/2;var bg=parseInt(aO.mapDiv.style.width)/2;var be=new PixelPoint(bb.x+bg,bb.y+ba);var bd=new PixelPoint(bb.x-bg,bb.y-ba);var bf=aO.mercPixToPos(be);var a9=aO.mercPixToPos(bd);var bc=new BoundingBox(a9,bf);return bc};this.setOnlyLoadTilesInViewport=function(a9){ap=(a9)?true:false};this.getOnlyLoadTilesInViewport=function(){return ap};this.getGridSize=function(){return a0+" "+av};this.setTileBuffer=function(a9){if(a9){C=2}else{C=1}};this.setTileBorder=function(ba){if(ba){aH=1}else{aH=0}for(var bb in n){if(n.hasOwnProperty(bb)){if(n[bb].tileArray){for(var bc=0;bc<a0;++bc){for(var a9=0;a9<av;++a9){n[bb].tileArray[a9][bc].border=aH}}}}}};this.getTileSize=function(){return D};this.setTileSize=function(a9){D=parseInt(a9,10);j=D;if(aa){s=true}};this.positionToMapLayerPixel=function(bh){if(!bh||!ah){throw new Exception("Map.positionToMapLayerPixel: bad input: "+bh)}var bb=aO.getCenterPosition();var bj=aO.posToMercPix(bb);var bg=parseInt(aO.mapDiv.style.height)/2;var bf=parseInt(aO.mapDiv.style.width)/2;var bc=new PixelPoint(bj.x-bf,bj.y+bg);var be=this.posToMercPix(bh);var bd=Utilities.radsPerPixelAtZoom(D,B.getGXConvertedZoomLevel());var a9=Utilities.lon2pix(180,bd);var bi=-(bc.roundX()-be.roundX());if(bi>a9){bi-=a9*2}else{if(bi<(-a9)){bi+=a9*2}}var ba=new PixelPoint(bi-aP,bc.roundY()-be.roundY()-aN);return ba};this.addMapControl=function(bc){if(!bc){throw new Exception("adding invalid control to map.")}else{if(!bc.type||bc.map){throw new Exception("adding invalid control to map, with properties type:"+bc.type+" map:"+bc.map)}}var ba=bc.type;if(this.existsMapControl(ba)){this.removeMapControl(ba)}a[ba]=bc;bc.map=this;var a9=bc.appendThis();if(a9){this.getMapDiv().appendChild(a9)}var bb=new deCarta.DOMDimensions(this.getMapDiv());bc.position(bb)};this.existsMapControl=function(a9){if(a[a9]){return true}else{return false}};this.removeMapControl=function(a9){if(!a9||!(a9&&a[a9])){return}var ba=a[a9];a[a9]=undefined;this.getMapDiv().removeChild(ba.removeThis());Utilities.purge(ba)};this.positionMapControls=function(){var a9;var ba=new deCarta.DOMDimensions(this.getMapDiv());for(a9 in a){if(a.hasOwnProperty(a9)&&a[a9].position){a[a9].position(ba)}}};this.getMapLayers=function(){return n};this.hide=function(){this.getMapDiv().style.display="none"};this.show=function(){this.getMapDiv().style.display="block";this.positionMapControls()};this.setCompatibility=function(ba,a9){switch(ba){case"restrictDragToDiv":if(a9){this.addEventListener("mouseout",v)}else{this.clearListeners("mouseout")}break;default:throw new Exception("Map.setCompatibility: illegal flag: "+ba.toString()+" passed in as argument.");break}};function p(){aF=new DefaultInfoWindow({autoHeight:true})}this.addEventListener=function(bb,bc){var ba=false;for(var a9=0;a9<U.length;a9++){if(U[a9]==bb){U[bb]=bc;ba=true;break}}if(!ba){U.push(bb);U[bb]=bc}};this.getEventListener=function(ba){for(var a9=0;a9<U.length;a9++){if(U[a9]==ba){return U[ba]}}return null};this.clearInstanceListeners=function(){for(var a9=0;a9<U.length;a9++){U[U[a9]]=null;U[a9]=null}};this.clearListeners=function(ba){for(var a9=0;a9<U.length;a9++){if(U[a9]==ba){U[U[a9]]=null;U[a9]=null}}};function aA(bb){if(!GLOBALS.ALLOWDOMEVENTS){return true}bb=bb?bb:window.event;var a9;if(bb.target){a9=bb.target}else{if(bb.srcElement){a9=bb.srcElement}}if(a9&&a9.nodeType==3){a9=a9.parentNode}if(deCarta.IdManager.checkTag(a9,"ignoreForMapEvents")){return true}if(bb.type=="mouseup"){aj=new Date();var bc=new PixelPoint(bb.clientX,bb.clientY);var ba=aO.screenPixToPos(bc);if(U.mouseup){U.mouseup(ba)}if((aj-aC)<300&&U.rightclick&&((c&&bb.button==2)||(!c&&bb.which==3))){if(this.rtClickBoxUpHandler){this.rtClickBoxUpHandler(bb)}U.rightclick(ba,bb);bb.preventDefault();bb.stopPropagation();return false}}else{if(bb.type=="dblclick"){if(E){clearTimeout(E);E=undefined}ad(bb)}else{if(bb.type=="click"&&((aj-aC)<300)){H(bb)}}}}function H(bb){bb=bb?bb:window.event;var a9;if(bb.target){a9=bb.target}else{if(bb.srcElement){a9=bb.srcElement}}if(a9&&a9.nodeType==3){a9=a9.parentNode}if(deCarta.IdManager.checkTag(a9,"ignoreForMapEvents")){return false}aq.style.cursor="pointer";aq.unselectable="on";var bc=new PixelPoint(bb.clientX,bb.clientY);var ba=aO.screenPixToPos(bc);if(U.dblclick&&bb.type=="dblclick"){U.dblclick(ba);return false}if(U.click&&bb.type=="click"){U.click(ba);return false}return false}function ae(bd){if(!GLOBALS.ALLOWDOMEVENTS){return true}bd=bd?bd:window.event;aC=new Date();var ba;if(bd.target){ba=bd.target}else{if(bd.srcElement){ba=bd.srcElement}}if(ba&&ba.nodeType==3){ba=ba.parentNode}if(deCarta.IdManager.checkTag(ba,"ignoreForMapEvents")){return true}var ba;if(bd.target){ba=bd.target}else{if(bd.srcElement){ba=bd.srcElement}}if(ba&&ba.nodeType==3){ba=ba.parentNode}if(deCarta.IdManager.checkTag(ba,"ignoreForMapEvents")){return true}if((!c&&bd.which==3)||(c&&bd.button==2)){if(a2){bd.stopPropagation?bd.stopPropagation():bd.cancelBubble=true;var bh=bd.clientX;var bg=bd.clientY;var bb=document.getElementById("decarta-bbox-div");if(!bb){bb=document.createElement("div");bb.className="decarta-bbox-div";bb.id="decarta-bbox-div";aq.appendChild(bb)}bb.style.display="block";bb.style.width=null;bb.style.height=null;var be=Utilities.getAbsoluteTop(aO.mapDiv);var bf=Utilities.getAbsoluteLeft(aO.mapDiv);bb.style.top=(bg-be)+"px";bb.style.left=(bh-bf)+"px";aq.style.cursor="move";this.rtClickBoxUpHandler=function(bk){if(!bb){return}aq.style.cursor="default";var bj,bi;if(bb.style.width&&bb.style.height){bj=new PixelPoint(parseInt(bb.style.left)+Utilities.getAbsoluteLeft(aO.mapDiv)+parseInt((bb.style.width)?bb.style.width:0),parseInt(bb.style.top)+Utilities.getAbsoluteTop(aO.mapDiv));bi=new PixelPoint(parseInt(bb.style.left)+Utilities.getAbsoluteLeft(aO.mapDiv),parseInt(bb.style.top)+Utilities.getAbsoluteTop(aO.mapDiv)+parseInt(bb.style.height?bb.style.height:0));var bm=aO.screenPixToPos(bj);var bn=aO.screenPixToPos(bi);var bl=new BoundingBox(bn,bm);if(aQ){aQ.hide()}B.setZoomLevel(B.getZoomLevelToFitBoundingBox(bl));aO.centerOnPosition(bl.getCenterPosition(),function(){if(U.zoomend){U.zoomend()}})}bb.style.display="none";bb=undefined;aO.rtClickBoxMoveHandler=null;aO.rtClickBoxUpHandler=null;return false};document.body.onmouseup=this.rtClickBoxUpHandler;this.rtClickBoxMoveHandler=function(bj){if(!bb){return}bj=bj?bj:window.event;var bi=bj.clientX;var bk=bj.clientY;if(bj.clientX>bh&&bj.clientY>bg){bb.style.height=(bk-bg)+"px";bb.style.width=(bi-bh)+"px"}else{if(bj.clientX<bh&&bj.clientY<bg){bb.style.height=(bg-bk)+"px";bb.style.width=(bh-bi)+"px";bb.style.top=(bg-(bg-bk)-be)+"px";bb.style.left=(bh-(bh-bi)-bf)+"px"}else{if(bj.clientX<bh&&bj.clientY>bg){bb.style.height=(bk-bg)+"px";bb.style.width=(bh-bi)+"px";bb.style.left=(bh-(bh-bi)-bf)+"px"}else{if(bj.clientX>bh&&bj.clientY<bg){bb.style.height=(bg-bk)+"px";bb.style.width=(bi-bh)+"px";bb.style.top=(bg-(bg-bk)-be)+"px"}}}}return false};document.body.onmousemove=this.rtClickBoxMoveHandler}return true}if((!c&&bd.which==2)||(c&&bd.button==4)){return true}if(U.mousedown){var bc=new PixelPoint(bd.clientX,bd.clientY);var a9=aO.screenPixToPos(bc);U.mousedown(a9)}aU=true;aq.style.cursor="move";ai=bd.clientX;af=bd.clientY;document.body.onmousemove=u;document.body.onmouseup=v;return false}function v(a9){aU=false;aq.style.cursor="default";document.body.onmousemove=null;document.body.onmouseup=null;if(aY&&U.moveend){U.moveend();aY=false}if(an){an.calculate()}for(var ba in n){if(n.hasOwnProperty(ba)){n[ba].showTilesInViewport()}}ay();if(am){m();am=false}if(y&&y.frame){y.panToPosition(aO.getCenterPosition())}return false}function m(){var a9=(Z.x-ax.x);var bc=(Z.y-ax.y);var bb=a9*Math.abs(a9);var ba=bc*Math.abs(bc);bb=bb>256?256:bb;bb=bb<-256?-256:bb;ba=ba>256?256:ba;ba=ba<-256?-256:ba;t(bb,ba)}function t(a9,ba){if(!a9&&!ba){E=undefined;return}a9=a9<0?Math.ceil(a9*0.6):Math.floor(a9*0.6);ba=ba<0?Math.ceil(ba*0.6):Math.floor(ba*0.6);au+=a9;aP+=a9;ar+=ba;aN+=ba;aE(aP,aN);if(Math.abs(au)>j||Math.abs(ar)>j){a4()}E=setTimeout(function(){t(a9,ba)},100)}function ad(bf){var bd;if(bf.target){bd=bf.target}else{if(bf.srcElement){bd=bf.srcElement}}if(bd&&bd.nodeType==3){bd=bd.parentNode}if(deCarta.IdManager.checkTag(bd,"ignoreForMapEvents")){return false}f=true;if(U.dblclick){H(bf)}if(!at){return}var bg=bf.clientX;var be=bf.clientY;var ba=Utilities.getAbsoluteLeft(aO.mapDiv)-Utilities.getScrollLeft();var a9=Utilities.getAbsoluteTop(aO.mapDiv)-Utilities.getScrollTop();var bc=(parseInt(bg-ba)-Math.round(parseInt(aO.mapDiv.style.width)/2))*-1;var bb=(parseInt(be-a9)-Math.round(parseInt(aO.mapDiv.style.height)/2))*-1;z(bc,bb)}function u(bc){var bd;var bb;bc=bc?bc:window.event;if(!aY){if(U.movestart){U.movestart()}}if(U.move){bd=new PixelPoint(bc.clientX,bc.clientY);bb=aO.screenPixToPos(bd);U.move(bb)}if(!ak){if(bc.type=="mouseup"&&U.mouseup){bd=new PixelPoint(bc.clientX,bc.clientY);bb=aO.screenPixToPos(bd);U.mouseup(bb);v(bc)}return false}aY=true;if(!aU){return false}var ba=bc.clientX-ai;var a9=bc.clientY-af;au+=ba;ar+=a9;if(Math.abs(au)>j||Math.abs(ar)>j){a4()}if(!am&&T){am=true}ax.x=aP;ax.y=aN;aP+=ba;aN+=a9;Z.x=aP;Z.y=aN;aE(aP,aN);if(y&&y.frame){y.panMapDivWinToPos(aO.getCenterPosition())}ai=bc.clientX;af=bc.clientY;return false}function K(bb){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(!bb){bb=window.event}var ba=bb.target?bb.target:bb.srcElement;var a9=(bb.relatedTarget)?bb.relatedTarget:bb.toElement;try{if(a9&&ba&&(a9.id==ba.id)){return true}}catch(bb){}if(U.mouseout){U.mouseout()}}function O(bb){if(!F){return}var bc=new Date().getTime();if((bc-this.lastWheelTime)<300){return}this.lastWheelTime=bc;var bj=0;if(!bb){bb=window.event}bj=bb.detail?bb.detail*-1:bb.wheelDelta/40;bj=(bj>0)?1:-1;var ba=bb.clientX;var a9=bb.clientY;var bh=Utilities.getAbsoluteLeft(aO.mapDiv)-Utilities.getScrollLeft();var bg=Utilities.getAbsoluteTop(aO.mapDiv)-Utilities.getScrollTop();var be=parseInt(ba-bh);var bd=parseInt(a9-bg);var bi=aO.getZoomController().getZoomLevel();var bf=aO.getZoomController().getClosestValidLevel(bi-bj);aO.getZoomController().zoomToNewLevel(bf,be,bd);if(bb.preventDefault){bb.preventDefault()}bb.returnValue=false}function M(){if(window.addEventListener){window.addEventListener("DOMMouseScroll",O,false)}window.onmousewheel=document.onmousewheel=O}function W(){if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",O,false)}window.onmousewheel=aR}this.getMapDiv=function(){return aO.mapDiv};this.getBubble=function(){return aF};this.getChooser=function(){return N};this.getCopyright=function(){return aS};this.getTileDiv=function(){return aa};this.getZoomLck=function(){return Q};this.loaded=function(){return(aa?true:false)};this.hidePinsBeforeZoom=function(){ac.operateOnData(function(a9){if(a9){a9.zoomHide()}})};this.showPinsAfterZoom=function(){ac.operateOnData(function(a9){if(a9){a9.zoomShow()}})};function aX(){ac.operateOnData(function(a9){if(!a9){return}a9.setPosition(a9.position);a9.hideInfoWindow()});aO.showPinsAfterZoom()}function ay(){ac.operateOnData(function(ba){if(!ba){return}var bb=ba.setPosition(ba.position);if(bb){var a9=ba.map.getInfoWindow();var bc=(a9)?a9.associatedPin:null;if(a9&&bc&&bc.equals(ba)){ba.hideInfoWindow();ba.showInfoWindow()}}});aO.showPinsAfterZoom()}this.zoomMap=function(bb,ba){if(!n[GLOBALS.STREET]&&!n[GLOBALS.SATELLITE]&&!n[GLOBALS.HYBRID]){return false}if(Q){return false}if(typeof ba=="function"){g.zoomMap=ba}else{g.zoomMap=null}var be=B.selected;if(be==bb){if(g.zoomMap){g.zoomMap();g.zoomMap=undefined}return false}var bh=aO.getCenterPosition();var a9=Utilities.getRequestId();B.setZoomLevel(bb);aO.hidePinsBeforeZoom();Q=true;if(V&&(Math.abs(be-bb)<=2)){if(!aQ){q()}aQ.show();if((a5&&a5.mapType=="HYBRID")||(!a5.mapType&&Credentials.mapType=="HYBRID")){n[GLOBALS.HYBRID].hide()}for(var bg in n){if(n.hasOwnProperty(bg)){n[bg].zoom(be-bb,aQ,au,ar)}}}else{if(aQ){aQ.hide()}}for(var bd in n){if(n.hasOwnProperty(bd)){if(n[bd].refUrl&&n[bd].layerName=="decarta-street"){var bf=n[bd].refUrl}if(n[bd].refUrl&&n[bd].layerName=="decarta-satellite"){var bc=n[bd].refUrl}}}JSRequest.emulatedZoomRequest(bh,bb,bf,bc,r);if(y&&y.frame){y.zoomMap()}return true};function aR(){return false}this.setCountryCode=function(a9){if(!a9){throw new Exception("error calling Map.setCountryCode()")}Credentials.ISOCountryCode=a9};this.getGXPixelPoint=function(a9){this.posToMercPix(a9)};this.posToMercPix=function(bc){var ba=Utilities.radsPerPixelAtZoom(D,B.getGXConvertedZoomLevel());var bb=Utilities.lat2pix(bc.lat,ba);var a9=Utilities.lon2pix(bc.lon,ba);return new PixelPoint(a9,bb)};this.mercPixToPos=function(a9){var bc=Utilities.radsPerPixelAtZoom(D,B.getGXConvertedZoomLevel());var ba=Utilities.pix2lat(a9.y,bc);var bb=Utilities.pix2lon(a9.x,bc);return new Position(ba,bb)};this.screenPixToPos=function(bc){var bd=bc.y-Utilities.getAbsoluteTop(aO.mapDiv)+Utilities.getScrollTop();var ba=bc.x-Utilities.getAbsoluteLeft(aO.mapDiv)+Utilities.getScrollLeft();var bf=aO.posToMercPix(aO.getCenterPosition());var bg=bf.x-(parseInt(aO.mapDiv.style.width)/2);var bh=bf.y+(parseInt(aO.mapDiv.style.height)/2);var bb=new PixelPoint(bg,bh);var be=new PixelPoint(bb.x+ba,bb.y-bd);var a9=aO.mercPixToPos(be);return a9};function ao(bb){var bf=bb.XLS.Response.requestID;var bk,a9;var bh=bb.XLS.Response.PortrayMapResponse.TileGrid[0].Pan;var bc;if(deCarta.JSONParser.parseErrors(bb)){bc=null}else{for(var bd=0;bd<bh.length;bd++){if(bh[bd].direction=="E"){aG.x=parseFloat(bh[bd].numTiles)*D;a9=bh[bd].toLon}else{aG.y=-parseFloat(bh[bd].numTiles)*D;bk=bh[bd].toLat}}var bi=bb.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content;if(isNaN(bk)||isNaN(a9)){ah=new Position(bi)}else{ah=new Position(bk,a9)}var ba=bb.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content;B.setRadius((parseFloat((ba))/1000)*av);var be=0;try{be=parseInt(bb.XLS.Response.PortrayMapResponse.TileGrid[0].GridLayer.maxImageHostAliases,10)}catch(bg){}var bj=[bb.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL,bb.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL];o(bj,be);if(aF){aF.hide()}aX();bc=aO.getCenterPosition()}if((bf>=0)&&g[bf]){g[bf](bc);g[bf]=undefined}}function r(a9){ao(a9);Q=false;if(U.zoomend){U.zoomend()}if(g.zoomMap){g.zoomMap();g.zoomMap=undefined}}function o(a9,bd){if(an){an.calculate()}al();bd=bd||0;var bc=new deCarta.MapLayerReferenceUrl((a9[1]));bc.createGlobeXplorerUrl();var ba=new deCarta.MapLayerReferenceUrl((a9[0]),bd);ba.createDeCartaTransparentUrl();ba.setParameter("config",a5.transparentConfiguration);var bb=new deCarta.MapLayerReferenceUrl((a9[0]),bd);bb.createDeCartaUrl();bb.setParameter("config",a5.configuration);if(n[GLOBALS.SATELLITE]){n[GLOBALS.SATELLITE].populate(bc)}if(n[GLOBALS.HYBRID]){n[GLOBALS.HYBRID].populate(ba)}if(n[GLOBALS.STREET]){n[GLOBALS.STREET].populate(bb)}au-=aG.x;ar-=aG.y;aB()}function Y(){if(!aa){a7();return}}function a7(){var a9="decarta-mapviewport";if(!aO.mapDiv.className){aO.mapDiv.className=a9}else{aO.mapDiv.className+=" "+a9}Utilities.setUnselectable(aO.mapDiv);aq=document.createElement("div");aq.style.cssText="position:absolute;overflow:hidden;left:0px;top:0px;width:100%;height:100%;";Utilities.setUnselectable(aq);aO.mapDiv.appendChild(aq);aq.oncontextmenu=aR;aq.onmousedown=ae;aq.onmouseout=K;aq.onmouseup=aA;aq.ondblclick=aA;aq.onclick=aA;aO.mapDiv.onmouseover=M;aO.mapDiv.onmouseout=W;aa=document.createElement("div");var ba="decarta-tiles";aa.id=ba;aa.className=ba;aa.style.top=0+A;aa.style.left=0+A;Utilities.setUnselectable(aa);aq.appendChild(aa);if(!B){B=new ZoomController();aO.addMapControl(B);B.hide()}if(!aF){p()}aa.appendChild(aF.bubble);L()}this.getTilesContainer=function(){return aq};function L(){if(n[GLOBALS.SATELLITE]||n[GLOBALS.HYBRID]||n[GLOBALS.STREET]){throw new Exception("buildDefaultTileGrid called on existing tile grid")}if(a5.mapType==GLOBALS.STREET){ab(GLOBALS.STREET)}else{if(a5.mapType==GLOBALS.HYBRID){ab(GLOBALS.HYBRID)}else{if(a5.mapType==GLOBALS.SATELLITE){ab(GLOBALS.SATELLITE)}}}}function ab(ba){if(ba!=GLOBALS.SATELLITE&&ba!=GLOBALS.HYBRID&&ba!=GLOBALS.STREET){throw new Exception("initDefaultMapLayer called with bad value: "+ba)}var bb=parseInt(aO.mapDiv.style.height);var a9=parseInt(aO.mapDiv.style.width);a3();aL=-Math.floor(((av*D)-a9)/2);aI=-Math.floor(((a0*D)-bb)/2);if(ba==GLOBALS.SATELLITE){n[GLOBALS.SATELLITE]=new deCarta.MapLayer(av,a0,aL,aI,D,"decarta-satellite",1,aO);n[GLOBALS.SATELLITE].show();n[GLOBALS.SATELLITE].appendTiles(aa);return}else{if(ba==GLOBALS.HYBRID){if(!n[GLOBALS.SATELLITE]){n[GLOBALS.SATELLITE]=new deCarta.MapLayer(av,a0,aL,aI,D,"decarta-satellite",1,aO);n[GLOBALS.SATELLITE].show();n[GLOBALS.SATELLITE].appendTiles(aa)}n[GLOBALS.HYBRID]=new deCarta.MapLayer(av,a0,aL,aI,D,"decarta-transparent",2,aO);n[GLOBALS.HYBRID].show();n[GLOBALS.HYBRID].appendTiles(aa);return}else{if(ba==GLOBALS.STREET){n[GLOBALS.STREET]=new deCarta.MapLayer(av,a0,aL,aI,D,"decarta-street",3,aO);n[GLOBALS.STREET].show();n[GLOBALS.STREET].appendTiles(aa);return}}}}function q(){aQ=new deCarta.ZoomLayer(av,a0,D);aQ.appendTiles(aa)}function P(){if(aQ&&V){aQ.destroy();delete aQ}}function X(){if(!aa){throw new Exception("resizeMap called without an existing map.")}for(var a9 in n){if(n.hasOwnProperty(a9)){n[a9].hide();n[a9].destroy();n[a9]=undefined}}n={};aa.style.top=0+A;aa.style.left=0+A;L();aP=0;aN=0;ai=0;af=0;aU=false;au=0;ar=0}function al(){a6=aP;aJ=aN;var bb=parseInt(aO.mapDiv.style.height);var ba=parseInt(aO.mapDiv.style.width);a3();aL=-Math.floor(((av*D)-ba)/2);aI=-Math.floor(((a0*D)-bb)/2);for(var bc in n){if(n.hasOwnProperty(bc)){n[bc].reset(-aP-aG.x,-aN-aG.y,aL,aI)}}var a9=[];if(a5.mapType==GLOBALS.STREET){a9.push(n[GLOBALS.STREET])}else{if(a5.mapType==GLOBALS.HYBRID){a9.push(n[GLOBALS.SATELLITE]);a9.push(n[GLOBALS.HYBRID])}else{if(a5.mapType==GLOBALS.SATELLITE){a9.push(n[GLOBALS.SATELLITE])}else{throw new Exception("Map.reset: encountered unexpected _xmlRecFac.mapType of "+a5.mapType)}}}G(a9);ai=0;af=0;aU=false;au=0;ar=0}function G(ba){var bd=ba;var bc=bd.length;var bb;if(!Q||!V){for(bb=0;bb<bc;bb++){bd[bb].show()}return}var be=100;setTimeout(a9,be);function a9(){var bf=(aQ)?(aQ.zoomComplete):true;if(bf){for(bb=0;bb<bc;bb++){bd[bb].show()}}else{setTimeout(a9,be)}}return}function a4(){var a9;if(R){R()}if(au<=-j){au=au+j;for(a9 in n){if(n.hasOwnProperty(a9)){n[a9].rotateTiles(0,1)}}aO.redraw()}else{if(au>=j){au=au-j;for(a9 in n){if(n.hasOwnProperty(a9)){n[a9].rotateTiles(0,-1)}}aO.redraw()}}if(ar<=-j){ar=ar+j;for(a9 in n){if(n.hasOwnProperty(a9)){n[a9].rotateTiles(-1,0)}}aO.redraw()}else{if(ar>=j){ar=ar-j;for(a9 in n){if(n.hasOwnProperty(a9)){n[a9].rotateTiles(1,0)}}aO.redraw()}}}function aE(a9,ba){aa.style.left=a9+A;aa.style.top=ba+A}function z(a9,ba){if(aK){return}if(a9>1){aa.style.left=parseInt(aa.style.left)+1+A}else{if(a9<-1){aa.style.left=parseInt(aa.style.left)-1+A}}if(ba>1){aa.style.top=parseInt(aa.style.top)+1+A}else{if(ba<-1){aa.style.top=parseInt(aa.style.top)-1+A}}aK=true;l(a9,ba,true)}function l(a9,be,bd){if(bd){a1=a9;aZ=be}var bb=Math.round(Math.abs(a1)*0.3);var ba=Math.round(Math.abs(aZ)*0.3);if(bb>0||ba>0){if(a1<0){a1+=bb;au-=bb;aP-=bb}else{if(a1>0){a1-=bb;au+=bb;aP+=bb}}if(aZ<0){aZ+=ba;ar-=ba;aN-=ba}else{if(aZ>0){aZ-=ba;ar+=ba;aN+=ba}}aE(aP,aN);if(Math.abs(au)>j||Math.abs(ar)>j){a4()}setTimeout(l,h)}else{aK=false;if(U.moveend){U.moveend()}if(g.panToPosition){g.panToPosition(aO.getCenterPosition());g.panToPosition=undefined}if(an){an.calculate()}if(f&&aw){aO.getZoomController().zoomInOneLevel()}f=false;for(var bc in n){if(n.hasOwnProperty(bc)){n[bc].showTilesInViewport()}}ay()}}function aD(){if(!aO.getTileDiv()){return null}var a9=d;if(!a9){a9=document.createElement("div");a9.id="svgvml_canvas";aO.getTileDiv().appendChild(a9)}a9.style.position="absolute";a9.style.zIndex=100;d=a9;return a9}function az(){if(a8=="server"){return}var a9=aD();a9.innerHTML=""}function k(){if(!aO.getTileDiv()){return null}var a9=aD();var bd=aO.getGridSize().split(" ");var bc=parseInt(bd[1])*D;var bg=parseInt(bd[0])*D;a9.style.width=bc+A;a9.style.height=bg+A;var bf=aO.mapDiv;var bb=-Math.floor((bc-parseInt(bf.style.width))/2);var ba=-Math.floor((bg-parseInt(bf.style.height))/2);var bh=aa;a9.style.left=bb-parseInt(bh.style.left)+A;a9.style.top=ba-parseInt(bh.style.top)+A;a9.innerHTML="";var be=Raphael(a9);be.bbox=aO.getBoundingBox();return be}function aB(a9){a9=a9||false;if(a5.overlays.length==0&&!a9){aW=null;return}if(aK||!aO.getTileDiv()){return}aW=k();var bb=a5.overlays;for(var bc=0;bc<bb.length;bc++){var ba=bb[bc];ba.raphael_element=null;aO.drawShape(ba,true)}}this.getRaphaelPaper=function(){return aW};this.getMapOverviewController=function(){return y};function a3(){var bc=parseInt(aO.mapDiv.style.height);var bb=parseInt(aO.mapDiv.style.width);a0=Math.ceil(bc/D)+C;if(a0%2==0){a0++}av=Math.ceil(bb/D)+C;if(av%2==0){av++}var a9=a0*D;var ba=av*D;aa.style.width=ba+A;aa.style.height=a9+A}}deCarta.MapLayer=function(f,j,h,c,k,g,d,a,b){this.init(f,j,h,c,k,g,d,a,b)};deCarta.MapLayer.dgAliasIndex=0;deCarta.MapLayer.dgAliasMax=3;deCarta.MapLayer.prototype.fadeSpeed=300;deCarta.MapLayer.prototype.owner=null;deCarta.MapLayer.prototype.onlyLoadTilesInViewport=false;deCarta.MapLayer.prototype.xTiles=null;deCarta.MapLayer.prototype.yTiles=null;deCarta.MapLayer.prototype.xOffset=0;deCarta.MapLayer.prototype.yOffset=0;deCarta.MapLayer.prototype.leftIndex=0;deCarta.MapLayer.prototype.topIndex=0;deCarta.MapLayer.prototype.tileSize=null;deCarta.MapLayer.prototype.layerName="mapLayer";deCarta.MapLayer.prototype.cssClass="decarta-maptile";deCarta.MapLayer.prototype.cssZIndex=20;deCarta.MapLayer.prototype.tileArray=null;deCarta.MapLayer.prototype.srcOnHidden=null;deCarta.MapLayer.prototype.srcOnError=null;deCarta.MapLayer.prototype.isVisible=false;deCarta.MapLayer.prototype.numTilesLoaded=0;deCarta.MapLayer.prototype.delayedLoading=false;deCarta.MapLayer.prototype.refUrl=null;deCarta.MapLayer.prototype.init=function(d,j,g,b,l,f,c,a){var k,h;this.xTiles=d;this.yTiles=j;this.xOffset=g;this.yOffset=b;this.tileSize=l;if(f){this.layerName=f}if(c){this.cssZIndex=c}this.owner=a;this.onlyLoadTilesInViewport=this.owner.getOnlyLoadTilesInViewport();this.tileArray=[];this.setDefaultSrc();for(k=0;k<this.xTiles;k++){this.tileArray[k]=[];for(h=0;h<this.yTiles;h++){this.tileArray[k][h]=this.mapTileFactory(k,h);if(this.owner.type=="MapOverviewController"){deCarta.IdManager.setTag(this.tileArray[k][h],"ignoreForMapEvents")}}}};deCarta.MapLayer.prototype.setDefaultSrc=function(){if(!Utilities.ie6){this.srcOnHidden=Credentials.transparentPNG;this.srcOnError=Credentials.transparentPNG}else{this.srcOnHidden=Credentials.transparentGIF;this.srcOnError=Credentials.transparentGIF}};deCarta.MapLayer.prototype.mapTileOnError=function(b){var a;if(!b){a=window.event.srcElement}else{a=b.currentTarget}if(a&&a.src&&a.srcOnError){a.src=a.srcOnError}};deCarta.MapLayer.prototype.mapTileFactory=function(a,f){var d=Math.floor(this.xTiles/2);var b=Math.floor(this.yTiles/2);var c=document.createElement("IMG");c.ownerLayer=this;c.fromCenterX=a-d;c.fromCenterY=b-f;c.id="Tile_"+a+"_"+f+"_"+c.ownerLayer.layerName;c.className=this.cssClass;if(this.srcOnHidden){c.altSrc=this.srcOnHidden;c.src=this.srcOnHidden}else{c.altSrc="";c.src=""}c.style.display="none";c.style.zIndex=this.cssZIndex;c.style.height=this.tileSize+"px";c.style.width=this.tileSize+"px";c.onerror=this.mapTileOnError;c.style.left=(a*this.tileSize)+this.xOffset+"px";c.style.top=(f*this.tileSize)+this.yOffset+"px";Utilities.setUnselectable(c);c.coords=new Object();c.coords.ul=null;c.coords.ur=null;c.coords.lr=null;c.coords.ll=null;c.tileViewed=false;c.setTileCoords=deCarta.MapLayer.setTileCoords;c.isTileInViewPort=deCarta.MapLayer.isTileInViewPort;c.loaded=false;c.setSrc=deCarta.MapLayer.setSrc;if(Utilities.ie6){c.loader=document.createElement("img");c.loader.owner=c;c.loader.loadTile=function(){this.owner.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.src+"')";this.owner.src=Credentials.transparentGIF;this.owner.ownerLayer.numTilesLoaded++;return true};c.loader.onload=c.loader.loadTile;c.onload=function(){if(this.src==Credentials.transparentGIF){return}c.style.display="block"};c.show=function(){this.style.display="block";this.style.zIndex=30};c.hide=function(){this.style.display="none"}}else{c.loader=document.createElement("img");c.loader.owner=c;c.delayedShow=false;c.show=function(){if(!this.loaded){return}if(this.fading){return}if(!this.ownerLayer.isVisible){return}if(this.ownerLayer.owner.getTileFading()){this.fading=true;this.style.display="block";Utilities.fade(this,{from:0,to:100,duration:this.ownerLayer.fadeSpeed,onComplete:function(g){g.fading=false}})}else{this.style.display="block";Utilities.setOpacity(this,100)}};c.hide=function(){if(this.ownerLayer.owner.getTileFading()){Utilities.fade(this,{from:100,to:0,duration:this.ownerLayer.fadeSpeed,onComplete:function(g){g.style.display="none";g.fading=false}})}else{this.style.display="none";Utilities.setOpacity(this,0)}};c.loader.loadTile=function(){if(this.src==this.owner.src){return}this.owner.loaded=true;Utilities.setOpacity(this.owner,0);this.owner.style.display="block";this.owner.style.zIndex=30;this.owner.src=this.src;this.owner.ownerLayer.numTilesLoaded++;this.owner.show();return};c.loader.onload=c.loader.loadTile;c.fading=false}return c};deCarta.MapLayer.prototype.showTilesInViewport=function(){if(this.onlyLoadTilesInViewport){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];if(!b.tileViewed){b.setSrc(b.altSrc)}}}}};deCarta.MapLayer.setSrc=function(a){if(this.src==a){return}if(this.ownerLayer.layerName=="decarta-satellite"){if(deCarta.MapLayer.dgAliasIndex>=deCarta.MapLayer.dgAliasMax){deCarta.MapLayer.dgAliasIndex=0}else{deCarta.MapLayer.dgAliasIndex++}a=a.replace(/\/\/www\./,"//www"+deCarta.MapLayer.dgAliasIndex+".")}this.loaded=false;this.altSrc=a;Utilities.setOpacity(this,0);if(this.ownerLayer.isVisible){this.loader.src=a;this.src=Credentials.transparentPNG;if(Utilities.ie6){this.src=Credentials.transparentGIF}this.show()}return};deCarta.MapLayer.setTileCoords=function(a){if(!a){return}var d=a.dynamicProps;var t=d.llMin.split(",");var r=parseInt(d.northing,10);var u=parseInt(d.easting,10);var k=this.ownerLayer;var v=k.owner;var p=v.getZoomController().getZoomLevel();var l=v.getTileSize();var w=Utilities.radsPerPixelAtZoomLevel(l,p);var y=new Position(parseFloat(t[0]),parseFloat(t[1]));var f=Math.round(Utilities.lat2pix(y.lat,w));var c=Math.round(Utilities.lon2pix(y.lon,w));var o=f+(r*l)+(this.fromCenterY*l);var h=c+(u*l)+(this.fromCenterX*l);var j=o+k.tileSize;var b=h+k.tileSize;var s=Utilities.pix2lat(o,w);var g=Utilities.pix2lon(h,w);var m=Utilities.pix2lat(j,w);var q=Utilities.pix2lon(b,w);this.coords.ul=new Position(m,g);this.coords.ur=new Position(m,q);this.coords.lr=new Position(s,q);this.coords.ll=new Position(s,g)};deCarta.MapLayer.isTileInViewPort=function(){var c;var d=this.coords;var g=this.ownerLayer.owner.getBoundingBoxViewable();var b=false;for(c in d){if(d.hasOwnProperty(c)){if(g.contains(d[c])){b=true;break}}}if(!b){var a={};a.ul=new Position(g.maxPosition.lat,g.minPosition.lon);a.ur=new Position(g.maxPosition.lat,g.maxPosition.lon);a.lr=new Position(g.minPosition.lat,g.maxPosition.lon);a.ll=new Position(g.minPosition.lat,g.minPosition.lon);var f=new BoundingBox(d.ll,d.ur);for(c in a){if(a.hasOwnProperty(c)){if(f.contains(a[c])){b=true;break}}}}if(b){return true}else{return false}};deCarta.MapLayer.prototype.appendTiles=function(b){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){b.appendChild(this.tileArray[a][c])}}};deCarta.MapLayer.prototype.hide=function(){if(!this.isVisible){return}var a,b;this.isVisible=false;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].hide()}}};deCarta.MapLayer.prototype.show=function(){if(this.isVisible){return}var a,f;this.isVisible=true;for(a=0;a<this.xTiles;a++){for(f=0;f<this.yTiles;f++){var c=this.tileArray[a][f];var b=c.altSrc.replace(/\:80/,"");var d=c.src.replace(/\:80/,"");if(b!=d&&this.refUrl){c.setSrc(c.altSrc)}c.show()}}};deCarta.MapLayer.prototype.reset=function(c,a,h,b){this.refUrl=null;if(h){this.xOffset=h}if(b){this.yOffset=b}var k,j;var g,f,d;var l="px";c=c||0;a=a||0;this.numTilesLoaded=0;this.isVisible=false;this.leftIndex=0;this.topIndex=0;this.updateFromCenterVals();for(k=0;k<this.xTiles;k++){g=this.xOffset+c+(k*this.tileSize);for(j=0;j<this.yTiles;j++){d=this.tileArray[k][j];d.tileViewed=false;d.style.display="none";if(this.srcOnHidden){d.altSrc=this.srcOnHidden;d.src=this.srcOnHidden;if(d.loader){d.loader.src=this.srcOnHidden}}else{d.altSrc="";d.src="";if(d.loader){d.loader.src=""}}f=this.yOffset+a+(j*this.tileSize);d.style.left=g+l;d.style.top=f+l}}};deCarta.MapLayer.prototype.refresh=function(){var a,c;for(a=0;a<this.xTiles;a++){for(c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];b.setSrc(this.refUrl.getRelSrc(b.fromCenterY,b.fromCenterX))}}};deCarta.MapLayer.prototype.rotateTiles=function(m,j){var o,k;var l=this.yTiles;var f=this.xTiles;var q=this.tileSize;var c;var h;var p=0;var a;var d;if(m){if(m>0){this.topIndex-=1;if(this.topIndex<0){this.topIndex=l-1}h=this.topIndex;p-=l*q;a=1}else{h=this.topIndex;this.topIndex+=1;if(this.topIndex>=l){this.topIndex=0}p+=l*q;a=-1}this.updateFromCenterVals();this.refUrl.pan(a,0);var g=[];for(o=0;o<f;o++){g.push(this.tileArray[o][h])}n(g);for(o=0;o<g.length;o++){c=g[o];d=parseInt(c.style.top)+p;c.style.top=(d)+"px";if(this.onlyLoadTilesInViewport){c.setTileCoords(this.refUrl)}c.setSrc(this.refUrl.getRelSrc(c.fromCenterY,c.fromCenterX))}return}if(j){if(j>0){h=this.leftIndex;this.leftIndex+=1;if(this.leftIndex>=f){this.leftIndex=0}p+=f*q;a=1}else{this.leftIndex-=1;if(this.leftIndex<0){this.leftIndex=f-1}h=this.leftIndex;p-=f*q;a=-1}this.updateFromCenterVals();this.refUrl.pan(0,a);g=[];for(k=0;k<l;k++){g.push(this.tileArray[h][k])}n(g);for(k=0;k<g.length;k++){c=g[k];d=parseInt(c.style.left)+p;c.style.left=(d)+"px";if(this.onlyLoadTilesInViewport){c.setTileCoords(this.refUrl)}c.setSrc(this.refUrl.getRelSrc(c.fromCenterY,c.fromCenterX))}}function n(t){for(var s=1;s<t.length;s++){for(var r=0;r<t.length-1;r++){if((Math.abs(t[r].fromCenterX)+Math.abs(t[r].fromCenterY))>(Math.abs(t[r+1].fromCenterX)+Math.abs(t[r+1].fromCenterY))){b(t,r,r+1)}}}}function b(s,u,r){var t;t=s[u];s[u]=s[r];s[r]=t}};deCarta.MapLayer.prototype.zoom=function(d,c,b,a,f){if(!this.isVisible){return}c.zoom(d,this,b,a,f)};deCarta.MapLayer.prototype.populate=function(f){this.refUrl=f;var j,g,b;var d=[];var c=0;var k;for(j=0;j<this.xTiles;j++){for(g=0;g<this.yTiles;g++){d[c]=this.tileArray[j][g];c++}}k=d.length;h(d);for(b=0;b<k;b++){if(this.onlyLoadTilesInViewport){d[b].setTileCoords(f)}d[b].setSrc(f.getRelSrc(d[b].fromCenterY,d[b].fromCenterX))}function h(n){for(var m=1;m<n.length;m++){for(var l=0;l<n.length-1;l++){if((Math.abs(n[l].fromCenterX)+Math.abs(n[l].fromCenterY))>(Math.abs(n[l+1].fromCenterX)+Math.abs(n[l+1].fromCenterY))){a(n,l,l+1)}}}}function a(m,o,l){var n;n=m[o];m[o]=m[l];m[l]=n}};deCarta.MapLayer.prototype.updateFromCenterVals=function(){var k=this.xTiles;var n=this.yTiles;var b=Math.floor(k/2);var g=-b;var a=Math.floor(n/2);var f=-a;var q=this.leftIndex;var c=this.topIndex;var j,h;if(q>b){j=q-b-1}else{j=q+b}if(c>a){h=c-a-1}else{h=c+a}var d=this.tileArray;var p,m;for(p=0;p<k;p++){for(m=0;m<n;m++){var l=d[p][m];var r=p-j;if(r>b){l.fromCenterX=r-k}else{if(r<g){l.fromCenterX=r+k}else{l.fromCenterX=r}}var o=h-m;if(o>a){l.fromCenterY=o-n}else{if(o<f){l.fromCenterY=o+n}else{l.fromCenterY=o}}}}};deCarta.MapLayer.prototype.resize=function(f,h){if(f==this.xTiles&&h==this.yTiles){return}var b=[];var j=parseInt(this.tileArray[this.leftIndex][this.topIndex].style.top);var a=parseInt(this.tileArray[this.leftIndex][this.topIndex].style.left);var d=Math.floor(this.xTiles/2);var c=Math.floor(this.yTiles/2);var l=0;var g=0;var m;var k;for(l=0;l<this.xTiles;l++){for(g=0;g<this.yTiles;g++){m=(l-this.leftIndex);if(m<0){m+=this.xTiles}k=(g-this.topIndex);if(k<0){k+=this.yTiles}if(m>=f||k>=h){this.owner.getTileDiv().removeChild(this.tileArray[l][g]);this.tileArray[l][g]=null}}}for(l=0;l<f;l++){b[l]=[];for(g=0;g<h;g++){if(l<this.xTiles&&g<this.yTiles){m=(this.leftIndex+l)%this.xTiles;k=(this.topIndex+g)%this.yTiles;b[l][g]=this.tileArray[m][k]}else{b[l][g]=this.mapTileFactory(l,g);b[l][g].style.top=(j+g*this.tileSize)+"px";b[l][g].style.left=(a+l*this.tileSize)+"px";if(this.onlyLoadTilesInViewport){b[l][g].setTileCoords(this.refUrl)}b[l][g].setSrc(this.refUrl.getRelSrc(c-g,l-d));this.owner.getTileDiv().appendChild(b[l][g])}}}this.refUrl.pan(-(h-this.yTiles)/2,(f-this.xTiles)/2);this.tileArray=b;this.xTiles=f;this.yTiles=h;this.leftIndex=0;this.topIndex=0;this.updateFromCenterVals()};deCarta.MapLayer.prototype.destroy=function(){var a,b;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){Utilities.purge(this.tileArray[a][b])}}};deCarta.ZoomLayer=function(a,c,b){this.init(a,c,b)};deCarta.ZoomLayer.prototype.framesTotal=4;deCarta.ZoomLayer.prototype.fps=20;deCarta.ZoomLayer.prototype.msPerFrame=1000/deCarta.ZoomLayer.prototype.fps;deCarta.ZoomLayer.prototype.xTiles=null;deCarta.ZoomLayer.prototype.yTiles=null;deCarta.ZoomLayer.prototype.tileSize=null;deCarta.ZoomLayer.prototype.layerName="zoomLayer";deCarta.ZoomLayer.prototype.cssClass="decarta-maptile";deCarta.ZoomLayer.prototype.cssZIndex=20;deCarta.ZoomLayer.prototype.tileArray=null;deCarta.ZoomLayer.prototype.srcOnHidden=null;deCarta.ZoomLayer.prototype.srcOnError=null;deCarta.ZoomLayer.prototype.isVisible=false;deCarta.ZoomLayer.prototype.init=function(b,f,c){var a,d;this.xTiles=b;this.yTiles=f;this.tileSize=c;this.tileArray=[];this.setDefaultSrc();this.domElement=document.getElementById("decarta-digitalZoomLayer");if(!this.domElement){this.domElement=document.createElement("div")}this.domElement.id="decarta-digitalZoomLayer";this.domElement.style.position="absolute";this.domElement.style.top=0;this.domElement.style.left=0;this.domElement.style.width=(b*c)+"px";this.domElement.style.height=(f*c)+"px";for(a=0;a<this.xTiles;a++){this.tileArray[a]=[];for(d=0;d<this.yTiles;d++){this.tileArray[a][d]=this.mapTileFactory(a,d)}}};deCarta.ZoomLayer.prototype.setDefaultSrc=function(){if(!Utilities.ie6){this.srcOnHidden=Credentials.transparentPNG;this.srcOnError=Credentials.transparentPNG}else{this.srcOnHidden=Credentials.transparentGIF;this.srcOnError=Credentials.transparentGIF}};deCarta.ZoomLayer.prototype.mapTileOnError=function(b){var a;if(!b){a=window.event.srcElement}else{a=b.currentTarget}if(a&&a.src&&a.srcOnError){a.src=a.srcOnError}};deCarta.ZoomLayer.prototype.mapTileFactory=function(a,g){var b="px";var f=Math.floor(this.xTiles/2);var c=Math.floor(this.yTiles/2);var d=document.createElement("IMG");d.fromCenterX=a-f;d.fromCenterY=c-g;d.className=this.cssClass;d.altSrc=this.srcOnHidden;d.src=this.srcOnHidden;d.style.zIndex=this.cssZIndex;d.style.height=this.tileSize+b;d.style.width=this.tileSize+b;d.onerror=this.mapTileOnError;d.id="Tile_"+a+"_"+g+"_zoom";Utilities.setUnselectable(d);d.setSrc=deCarta.ZoomLayer.setSrc;return d};deCarta.ZoomLayer.setSrc=function(a){this.src=a};deCarta.ZoomLayer.prototype.appendTiles=function(b){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){this.domElement.appendChild(this.tileArray[a][c])}}b.appendChild(this.domElement)};deCarta.ZoomLayer.prototype.hide=function(){if(!this.isVisible){return}var a,b;this.isVisible=false;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].style.display="none"}}};deCarta.ZoomLayer.prototype.show=function(){if(this.isVisible){return}var a,b;this.isVisible=true;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].style.display="block"}}};deCarta.ZoomLayer.prototype.transferSrcFromMapLayer=function(c){var a,h,g,d;var b="px";var f=Utilities.removeElementToReinsert(this.domElement);for(a=0;a<c.xTiles;a++){if(typeof this.tileArray[a]==="undefined"){this.tileArray[a]=[]}g=a+c.leftIndex;if(g>=c.xTiles){g-=c.xTiles}for(h=0;h<c.yTiles;h++){if(typeof this.tileArray[a][h]==="undefined"){this.tileArray[a][h]=this.mapTileFactory(a,h)}d=h+c.topIndex;if(d>=c.yTiles){d-=c.yTiles}this.tileArray[a][h].style.top=c.tileArray[g][d].style.top;this.tileArray[a][h].style.left=c.tileArray[g][d].style.left;this.tileArray[a][h].style.height=c.tileSize+b;this.tileArray[a][h].style.width=c.tileSize+b;this.tileArray[a][h].setSrc(c.tileArray[g][d].src)}}this.xTiles=c.xTiles;this.yTiles=c.yTiles;f()};deCarta.ZoomLayer.prototype.zoom=function(n,c,u,t,j){var v=this;v.show();v.transferSrcFromMapLayer(c);var g=u;var f=t;var h=Math.pow(2,n);var b=n>0?+1:-1;var q=this.framesTotal;var o=this.msPerFrame;var l=Math.floor((h*v.tileSize-v.tileSize)/(q));var d=-1*Math.floor(v.xTiles/2);var r=d;var k=-1*Math.floor(v.yTiles/2);var a=k;var m;var p;if(n>0){m=Math.floor(h*b*g/(2*q));p=Math.floor(h*b*f/(2*q))}else{m=Math.floor(h*b*g/(q));p=Math.floor(h*b*f/(q))}this.zoomComplete=false;s();function s(){var z=(new Date).getTime();var K,H;var L="px";var D=v.xTiles;var I=v.yTiles;var A=Utilities.removeElementToReinsert(v.domElement);var C=parseInt(v.tileArray[0][0].style.width)+l+"px";var w=parseInt(v.tileArray[0][0].style.height)+l+"px";for(K=0;K<D;K++){var B=parseInt(v.tileArray[K][0].style.left)-l/2+d*l+m+L;for(H=0;H<I;H++){var E=v.tileArray[K][H];E.style.width=C;E.style.height=w;E.style.left=B;E.style.top=parseInt(E.style.top)-l/2+k*l+p+L;k+=1}d+=1;k=a}d=r;q-=1;A();var F=(new Date).getTime();if(q){var M=(F-z);var G=this.msPerFrame-M;setTimeout(s,Math.max(G,25))}else{v.zoomComplete=true;if(typeof j==="function"){j()}}}};deCarta.ZoomLayer.prototype.destroy=function(){var a,c;for(a=0;a<this.xTiles;a++){for(c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];Utilities.purge(b);if(b.parentNode){b.parentNode.removeChild(b)}}}};deCarta.MapLayerReferenceUrl=function(a,b){this.init(a,b)};deCarta.MapLayerReferenceUrl.prototype.baseUrl=null;deCarta.MapLayerReferenceUrl.prototype.imageHosts=null;deCarta.MapLayerReferenceUrl.prototype.numImageHosts=null;deCarta.MapLayerReferenceUrl.prototype.nextImageHost=null;deCarta.MapLayerReferenceUrl.prototype.staticProps=null;deCarta.MapLayerReferenceUrl.prototype.dynamicProps=null;deCarta.MapLayerReferenceUrl.prototype.urlregx=new RegExp("\\amp;","g");deCarta.MapLayerReferenceUrl.prototype.init=function(a,b){this.baseUrl=a;this.dynamicProps={};this.dynamicProps.northing=0;this.dynamicProps.easting=0;this.llMax=null;this.llMin=null;this.dynamicProps.format="";this.dynamicProps.config="";this.imageHosts=[];this.nextImageHost=0;if(b){this.numImageHosts=b+1}else{this.numImageHosts=1}};deCarta.MapLayerReferenceUrl.prototype.getFullHostName=function(){var d=this.baseUrl.indexOf("?");var c=this.baseUrl.substr(0,d+1);var b=/^[\S]*\/\/([\S]+)/;var a=c.replace(b,"$1");var f=a.split("/")[0];return f};deCarta.MapLayerReferenceUrl.prototype.getProtocol=function(){var c=this.baseUrl.indexOf("?");var b=this.baseUrl.substr(0,c+1);var a=/^([a-zA-Z:]*\/\/)([\s\S]*)/;var d=b.replace(a,"$1");return d};deCarta.MapLayerReferenceUrl.prototype.generateHostAliases=function(){var d;this.imageHosts=[];var j=this.baseUrl.indexOf("?");var k=this.baseUrl.substr(0,j+1);if(this.numImageHosts==1){this.imageHosts[0]=k+this.staticProps;return}else{var g=k.split(".");if(g.length>1){var m=g[0];var f=g.slice(1).join(".");m=m.replace(/-[0-9]+$/,"");this.imageHosts[0]=m+"."+f+this.staticProps;for(d=1;d<this.numImageHosts;d++){if(d<10){this.imageHosts[d]=m+"-0"+d+"."+f+this.staticProps;continue}else{this.imageHosts[d]=m+"-"+d+"."+f+this.staticProps}}}else{var l=this.getProtocol();var a=this.getFullHostName();var b="";if(a.split(":").length>1){b=":"+a.split(":")[1];a=a.split(":")[0]}a=a.replace(/-[0-9]+$/,"");var c=this.baseUrl.indexOf("/",l.length);var h=this.baseUrl.substr(c,j+1-c);this.imageHosts[0]=l+a+b+h+this.staticProps;for(d=1;d<this.numImageHosts;d++){if(d<10){this.imageHosts[d]=l+a+"-0"+d+b+h+this.staticProps;continue}else{this.imageHosts[d]=l+a+"-"+d+b+h+this.staticProps}}}}};deCarta.MapLayerReferenceUrl.prototype.createGlobeXplorerUrl=function(){var c,d,h;var b=[];var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}else{if(d.indexOf("key=")==0){if(d.length>4&&!Credentials.dgkey){}else{h=Credentials.dgkey||"";d="key="+h}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.createDeCartaTransparentUrl=function(){var c,d;var b=[];this.baseUrl=this.baseUrl.replace(this.urlregx,"");var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("FORMAT=")==0){this.dynamicProps.format="PNG";d=null}else{if(d.indexOf("CONFIG=")==0){this.dynamicProps.config=d.split("=")[1];d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.createDeCartaUrl=function(){var c,d;var b=[];this.baseUrl=this.baseUrl.replace(this.urlregx,"");var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("FORMAT=")==0){this.dynamicProps.format=d.split("=")[1];d=null}else{if(d.indexOf("CONFIG=")==0){this.dynamicProps.config=d.split("=")[1];d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.getNextImageHost=function(){if(this.numImageHosts==1){return this.imageHosts[0]}else{var a=this.imageHosts[this.nextImageHost++];if(this.nextImageHost>=this.numImageHosts){this.nextImageHost=0}return a}};deCarta.MapLayerReferenceUrl.prototype.pan=function(a,b){this.dynamicProps.northing+=a;this.dynamicProps.easting+=b};deCarta.MapLayerReferenceUrl.prototype.getRelSrc=function(g,b){var f=this.getNextImageHost();var d=this.dynamicProps.northing+g;var j=this.dynamicProps.easting+b;var a=this.dynamicProps.config||"";if(a){a="&CONFIG="+a}var c=this.dynamicProps.format||"";if(c){c="&FORMAT="+c}var h=f+c+a+"&N="+d+"&E="+j;return h};deCarta.MapLayerReferenceUrl.prototype.setParameter=function(j,h){var c;var g=this.dynamicProps;for(c in g){if(g.hasOwnProperty(c)){if(c==j){g[j]=h;return}}}var f=this.staticProps.split("&");var d=f.length;var b=j+"=";var a=false;for(c=0;c<d;c++){if(f[c].indexOf(b)==0){f[c]=b+h;a=true;break}}if(!a){f[d]=b+h}this.staticProps=f.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.getParameter=function(h){var b;var g=null;var f=this.dynamicProps;for(b in f){if(f.hasOwnProperty(b)){if(b==h){g=f[h];return g}}}var d=this.staticProps.split("&");var c=d.length;var a=h+"=";for(b=0;b<c;b++){if(d[b].indexOf(a)==0){g=d[b].split("=")[1];return g}}return null};deCarta.MapLayerReferenceUrl.prototype.deleteParameter=function(c){var g;var d=this.dynamicProps;for(g in d){if(d.hasOwnProperty(g)){if(g==c){d[c]=null;return true}}}var h=this.staticProps.split("&");var k=[];var a;var b=false;var f=h.length;var j=c+"=";for(g=0;g<f;g++){a=h[g];if(a.indexOf(j)==0){a=null;b=true}if(a){k.push(a)}}if(b){this.staticProps=k.join("&");this.generateHostAliases();return true}else{return false}};function MapOverviewController(W,c,h){this.map=null;this.mapVisible=false;this.frame=null;this.type="MapOverviewController";this.mapDiv=null;this.zoomDif=W||4;this.width=c||120;this.height=h||120;this._queuedOperations=[];var s=this;var w=Utilities.ie;var T=false;var V=new Array();var z={};var Q=null;var D=null;var Y=null;var ae=true;var j=null;var R=null;var aa=null;var v=[];var n=null;var aj=null;var Z=null;var ac=8;var t;var d;var p;var o;var ai=2;var M=false;var k=new PixelPoint(0,0);var I=0;var H=0;var b=0;var f=0;var P=0;var N=0;var r="px";var A=0;var y=0;var S=false;this.initialize=function(){this.frame=document.createElement("div");this.frame.id="MapOverviewFrame";this.frame.className="decarta-mapOverviewController-frame";deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");this.frame.onmousedown=function(am){if(!GLOBALS.ALLOWDOMEVENTS){return true}am=am?am:window.event;am.stoppropagation?am.stoppropagation():am.cancelBubble=true;return false};af();L()};this.open=function(){s.mapVisible=true;R.src="img/map_overview_hide.png";s.frame.style.height=s.width+5+"px";s.frame.style.width=s.height+5+"px"};this.close=function(){s.mapVisible=false;R.src="img/map_overview_show.png";s.frame.style.height="17px";s.frame.style.width="17px"};function af(){j=document.createElement("div");j.id="MapOverviewToggle";j.className="decarta-mapOverviewController-mapToggle";j.onclick=function(am){if(!GLOBALS.ALLOWDOMEVENTS){return true}am=am?am:window.event;am.stoppropagation?am.stoppropagation():am.cancelBubble=true;if(s.mapVisible){s.close()}else{s.open()}return true};deCarta.IdManager.setTag(j,"ignoreForMapEvents");s.frame.appendChild(j);R=document.createElement("img");R.src="img/map_overview_show.png";R.className="decarta-mapOverviewController-mapToggleImg";j.appendChild(R);deCarta.IdManager.setTag(R,"ignoreForMapEvents")}function L(){var am=document.createElement("div");am.id="MapOverviewWrapper";am.className="decarta-mapOverviewController-mapDivWrapper";am.style.width=s.width+r;am.style.height=s.height+r;s.frame.appendChild(am);deCarta.IdManager.setTag(am,"ignoreForMapEvents");s.mapDiv=document.createElement("div");s.mapDiv.id="MapOverview";s.mapDiv.className="decarta-mapOverviewController-mapDiv";s.mapDiv.style.width=s.width+"px";s.mapDiv.style.height=s.height+"px";am.appendChild(s.mapDiv);deCarta.IdManager.setTag(s.mapDiv,"ignoreForMapEvents");aj=s.map.getTileSize();Z=aj;n=s.map.getXmlRecFac();s.mapDiv.onmousedown=function(ar){if(!GLOBALS.ALLOWDOMEVENTS){return true}ar=ar?ar:window.event;if((!w&&ar.which==3)||(w&&ar.button==2)){return true}if((!w&&ar.which==2)||(w&&ar.button==4)){return true}var aq;if(ar.target){aq=ar.target}else{if(ar.srcElement){aq=ar.srcElement}}if(aq&&aq.nodeType==3){aq=aq.parentNode}var at=new Date();var ap=true;s.mapDiv.style.cursor="move";var ao=ar.clientX;var an=ar.clientY;document.body.onmousemove=function(ax){var ay;var aw;ax=ax?ax:window.event;if(!ap){return false}var av=ax.clientX-ao;var au=ax.clientY-an;P+=av;N+=au;if(Math.abs(P)>Z||Math.abs(N)>Z){U()}I+=av;H+=au;C(I,H);ao=ax.clientX;an=ax.clientY;return false};document.body.onmouseup=function(au){ap=false;s.mapDiv.style.cursor="default";document.body.onmousemove=null;document.body.onmouseup=null;for(var av in z){if(z.hasOwnProperty(av)){z[av].showTilesInViewport()}}s.map.panToPosition(s.getCenterPosition());return false};return false}}function G(){if(Y){ak()}else{Y=document.createElement("div");Y.className="decarta-mapOverviewController-mapArrayDivWin";ak();deCarta.IdManager.setTag(Y,"ignoreForMapEvents");Q.appendChild(Y)}}function ak(){var an=Math.floor(s.map.mapDiv.offsetWidth/Math.pow(2,s.getZoomDifNow()));var am=Math.floor(s.map.mapDiv.offsetHeight/Math.pow(2,s.getZoomDifNow()));if(an>=s.width||am>=s.height){Y.style.display="none"}else{Y.style.display="block"}Y.style.width=an+"px";Y.style.height=am+"px";Y.style.left=(s.width-an)/2-I+"px";Y.style.top=(s.height-am)/2-H+"px"}function g(){var an=Math.floor(s.map.mapDiv.offsetWidth/Math.pow(2,s.getZoomDifNow()));var am=Math.floor(s.map.mapDiv.offsetHeight/Math.pow(2,s.getZoomDifNow()));if(an>=s.width||am>=s.height){D.style.display="none"}else{D.style.display=""}D.style.width=an+"px";D.style.height=am+"px";D.style.left=(s.width-an)/2+"px";D.style.top=(s.height-am)/2+"px"}function O(){if(D){g()}else{D=document.createElement("div");D.className="decarta-mapOverviewController-mapDivWin";g();deCarta.IdManager.setTag(D,"ignoreForMapEvents");s.mapDiv.appendChild(D);D.onmousedown=function(at){if(!GLOBALS.ALLOWDOMEVENTS){return true}at=at?at:window.event;at.stoppropagation?at.stoppropagation():at.cancelBubble=true;if((!w&&at.which==3)||(w&&at.button==2)){return true}if((!w&&at.which==2)||(w&&at.button==4)){return true}var aq=true;var ar=true;var ap=true;if(D.offsetWidth>=s*c){ar=false}if(D.offsetHeight>=s*h){ap=false}D.style.cursor="move";var an=at.clientX;var am=at.clientY;var ao=null;document.body.onmousemove=function(aA){aA=aA?aA:window.event;if(!aq){return false}if(!ar||!ap){return false}var aC=aA.clientX-an;var aE=0;var az=s.width-D.offsetWidth;var ax=D.offsetLeft+aC;if(ax>az){ax=az}if(ax<aE){ax=aE}D.style.left=ax+r;var aB=aA.clientY-am;var aD=0;var ay=s.height-D.offsetHeight;var aw=D.offsetTop+aB;if(aw>ay){aw=ay}if(aw<aD){aw=aD}D.style.top=aw+r;an=aA.clientX;am=aA.clientY;var av=0;var au=0;if(ax>=az){av=1}if(ax<=aE){av=-1}if(aw>=ay){au=1}if(aw<=aD){au=-1}if(av||au){m(av*(-5),au*(-5));if(ao){clearInterval(ao)}ao=setInterval(function(){if(av||au){m(av*(-5),au*(-5))}else{if(ao){clearInterval(ao)}ao=0}},300)}else{if(ao){clearInterval(ao)}ao=0}return false};document.body.onmouseup=function(aA){document.body.onmousemove=null;document.body.onmouseup=null;aq=false;D.style.cursor="default";aA=aA?aA:window.event;aA.stoppropagation?aA.stoppropagation():aA.cancelBubble=true;if(ao){clearInterval(ao)}ao=0;var au=s.getCenterPosition();var aB=s.posToMercPix(au);var aw=(s.mapDiv.offsetWidth-D.offsetWidth)/2;var az=D.offsetLeft-aw;var ax=(s.mapDiv.offsetHeight-D.offsetHeight)/2;var ay=D.offsetTop-ax;var aC=new PixelPoint(Math.round(aB.x+az),Math.round(aB.y-ay));var av=s.mercPixToPos(aC);s.map.panToPosition(av);return false};return false}}}this.sliderMapDivWin=function(am,an){D.style.left=D.offsetLeft+am+r;D.style.top=D.offsetTop+an+r};this.panMapDivWinToPos=function(ap){var ao=s.getCenterPosition();var an=this.posToMercPix(ao);var am=this.posToMercPix(ap);D.style.left=(s.width-D.offsetWidth)/2+(am.x-an.x)+r;D.style.top=(s.height-D.offsetHeight)/2-(am.y-an.y)+r};this.centerOnPosition=function(am,aq,ao){var ar=Utilities.getRequestId();if(typeof aq=="function"){v[ar]=aq}else{v[ar]=null}var ap=Utilities.getRequestId();var at=l();var an=n.createMapRequest(am,aj,ar,at,null,ao,ap);JSRequest.send(an,function(au){aa=am.clone();ac=at;al();u(au)},null,function(au){v[au]=undefined})};this.zoomMap=function(at){if(!z[GLOBALS.STREET]&&!z[GLOBALS.SATELLITE]&&!z[GLOBALS.HYBRID]){return false}if(T){return false}if(typeof at=="function"){v.zoomMap=at}else{v.zoomMap=null}var aq=ac;var ao=l();if(aq==ao){if(v.zoomMap){v.zoomMap();v.zoomMap=undefined}G();O();return false}var ap=s.getCenterPosition();var au=Utilities.getRequestId();T=true;for(var am in z){if(z.hasOwnProperty(am)){if(z[am].refUrl&&z[am].layerName=="decarta-street"){var an=z[am].refUrl}if(z[am].refUrl&&z[am].layerName=="decarta-satellite"){var ar=z[am].refUrl}}}ac=ao;JSRequest.emulatedZoomRequest(ap,ao,an,ar,ab);return true};function ab(am){u(am);T=false;if(V.zoomend){V.zoomend()}if(v.zoomMap){v.zoomMap();v.zoomMap=undefined}}function al(){if(!Q){ag();return}}function ag(){Utilities.setUnselectable(s.mapDiv);Q=document.createElement("div");Q.className="decarta-mapOverviewController-mapArrayDiv";Q.id="mapOverviewTilesDiv";Q.style.top=0+"px";Q.style.left=0+"px";Utilities.setUnselectable(Q);s.mapDiv.appendChild(Q);F()}function F(){if(z[GLOBALS.SATELLITE]||z[GLOBALS.HYBRID]||z[GLOBALS.STREET]){throw new Exception("buildDefaultTileGrid called on existing tile grid")}if(n.mapType==GLOBALS.STREET){ad(GLOBALS.STREET)}else{if(n.mapType==GLOBALS.HYBRID){ad(GLOBALS.HYBRID)}else{if(n.mapType==GLOBALS.SATELLITE){ad(GLOBALS.SATELLITE)}}}}function ad(an){if(an!=GLOBALS.SATELLITE&&an!=GLOBALS.HYBRID&&an!=GLOBALS.STREET){throw new Exception("initDefaultMapLayer called with bad value: "+an)}var ao=parseInt(s.mapDiv.style.height);var am=parseInt(s.mapDiv.style.width);t=Math.ceil(ao/aj)+ai;if(t%2==0){t++}d=Math.ceil(am/aj)+ai;if(d%2==0){d++}p=-Math.floor(((d*aj)-am)/2);o=-Math.floor(((t*aj)-ao)/2);if(an==GLOBALS.SATELLITE){z[GLOBALS.SATELLITE]=new deCarta.MapLayer(d,t,p,o,aj,"decarta-satellite",11,s,false);z[GLOBALS.SATELLITE].show();z[GLOBALS.SATELLITE].appendTiles(Q);return}else{if(an==GLOBALS.HYBRID){if(!z[GLOBALS.SATELLITE]){z[GLOBALS.SATELLITE]=new deCarta.MapLayer(d,t,p,o,aj,"decarta-satellite",11,s,false);z[GLOBALS.SATELLITE].show();z[GLOBALS.SATELLITE].appendTiles(Q)}z[GLOBALS.HYBRID]=new deCarta.MapLayer(d,t,p,o,aj,"decarta-transparent",12,s,false);z[GLOBALS.HYBRID].show();z[GLOBALS.HYBRID].appendTiles(Q);return}else{if(an==GLOBALS.STREET){z[GLOBALS.STREET]=new deCarta.MapLayer(d,t,p,o,aj,"decarta-street",13,s,false);z[GLOBALS.STREET].show();z[GLOBALS.STREET].appendTiles(Q);return}}}}function u(ao){var at=ao.XLS.Response.requestID;var ay,am;var av=ao.XLS.Response.PortrayMapResponse.TileGrid[0].Pan;var ap;if(deCarta.JSONParser.parseErrors(ao)){ap=null}else{for(var aq=0;aq<av.length;aq++){if(av[aq].direction=="E"){k.x=parseFloat(av[aq].numTiles)*aj;am=av[aq].toLon}else{k.y=-parseFloat(av[aq].numTiles)*aj;ay=av[aq].toLat}}var aw=ao.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content;if(isNaN(ay)||isNaN(am)){aa=new Position(aw)}else{aa=new Position(ay,am)}var an=ao.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content;K((parseFloat((an))/1000)*d);var ar=0;try{ar=parseInt(ao.XLS.Response.PortrayMapResponse.TileGrid[0].GridLayer.maxImageHostAliases,10)}catch(au){}var ax=[ao.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL,ao.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL];B(ax,ar);ap=s.getCenterPosition()}if((at>=0)&&v[at]){v[at](ap);v[at]=undefined}G();O();for(var aq=0;aq<s._queuedOperations.length;aq++){s._queuedOperations[aq]();delete s._queuedOperations[aq]}s._queuedOperations=[]}function B(am,aq){X();aq=aq||0;var ap=new deCarta.MapLayerReferenceUrl((am[1]));ap.createGlobeXplorerUrl();var an=new deCarta.MapLayerReferenceUrl((am[0]),aq);an.createDeCartaTransparentUrl();an.setParameter("config",n.transparentConfiguration);var ao=new deCarta.MapLayerReferenceUrl((am[0]),aq);ao.createDeCartaUrl();ao.setParameter("config",n.configuration);if(z[GLOBALS.SATELLITE]){z[GLOBALS.SATELLITE].populate(ap)}if(z[GLOBALS.HYBRID]){z[GLOBALS.HYBRID].populate(an)}if(z[GLOBALS.STREET]){z[GLOBALS.STREET].populate(ao)}P-=k.x;N-=k.y}function X(){b=I;f=H;var ao=parseInt(s.mapDiv.style.height);var an=parseInt(s.mapDiv.style.width);t=Math.ceil(ao/aj)+ai;if(t%2==0){t++}d=Math.ceil(an/aj)+ai;if(d%2==0){d++}p=-Math.floor(((d*aj)-an)/2);o=-Math.floor(((t*aj)-ao)/2);for(var ap in z){if(z.hasOwnProperty(ap)){z[ap].reset(-I-k.x,-H-k.y,p,o)}}var am=[];if(n.mapType==GLOBALS.STREET){am.push(z[GLOBALS.STREET])}else{if(n.mapType==GLOBALS.HYBRID){am.push(z[GLOBALS.SATELLITE]);am.push(z[GLOBALS.HYBRID])}else{if(n.mapType==GLOBALS.SATELLITE){am.push(z[GLOBALS.SATELLITE])}else{throw new Exception("Map.reset: encountered unexpected _xmlRecFac.mapType of "+n.mapType)}}}q(am);P=0;N=0}function q(am){var ap=am;var ao=ap.length;var an;for(an=0;an<ao;an++){ap[an].show()}}this.setMapType=function(an){if(!(an==GLOBALS.STREET||an==GLOBALS.HYBRID||an==GLOBALS.SATELLITE)){throw new Exception("unsupported mapType. Use '"+GLOBALS.STREET+"' || '"+GLOBALS.HYBRID+"' || '"+GLOBALS.SATELLITE+"'")}n.mapType=an;var am=false;if(!z||Utilities.isObjectEmpty(z)){return}if(an==GLOBALS.STREET){if(z[GLOBALS.HYBRID]){z[GLOBALS.HYBRID].hide()}if(z[GLOBALS.SATELLITE]){z[GLOBALS.SATELLITE].hide()}if(!z[GLOBALS.STREET]){ad(GLOBALS.STREET);am=true}else{z[GLOBALS.STREET].show()}}else{if(an==GLOBALS.HYBRID){if(z[GLOBALS.STREET]){z[GLOBALS.STREET].hide()}if(!z[GLOBALS.SATELLITE]){ad(GLOBALS.SATELLITE);am=true}else{z[GLOBALS.SATELLITE].show()}if(!z[GLOBALS.HYBRID]){ad(GLOBALS.HYBRID);am=true}else{z[GLOBALS.HYBRID].show()}}else{if(an==GLOBALS.SATELLITE){if(z[GLOBALS.HYBRID]){z[GLOBALS.HYBRID].hide()}if(z[GLOBALS.STREET]){z[GLOBALS.STREET].hide()}if(!z[GLOBALS.SATELLITE]){ad(GLOBALS.SATELLITE);am=true}else{z[GLOBALS.SATELLITE].show()}}}}if(am){}};this.panToPosition=function(at,am){var ao=at.clone();try{var av=s.getCenterPosition()}catch(ap){this._queuedOperations.push(Utilities.scope(function(){this.panToPosition(ao,am)},this));return}var ar=this.posToMercPix(av);var an=this.posToMercPix(ao);var aq=new PixelPoint(Math.round(ar.x-an.x),Math.round(ar.y-an.y));if(aa&&E()){var au=Utilities.centerContextToBoundingBox(av,E());if(au.extendedContains(ao)){if(typeof am=="function"){v.panToPosition=am}else{v.panToPosition=null}if(aq.x==0&&aq.y==0){if(v.panToPosition){v.panToPosition(s.getCenterPosition());v.panToPosition=undefined}ak();g();return}else{m(aq.x,-1*aq.y);ak();g()}}else{this.centerOnPosition(ao,am)}}else{this.centerOnPosition(ao,am)}};function m(am,an){if(S){return}if(am>1){Q.style.left=parseInt(Q.style.left)+1+r}else{if(am<-1){Q.style.left=parseInt(Q.style.left)-1+r}}if(an>1){Q.style.top=parseInt(Q.style.top)+1+r}else{if(an<-1){Q.style.top=parseInt(Q.style.top)-1+r}}S=true;a(am,an,true)}function a(am,au,at){var ao=am;var an=au;var aq=Math.round(Math.abs(ao)*0.3);var ap=Math.round(Math.abs(an)*0.3);while(aq>0||ap>0){if(ao<0){ao+=aq;P-=aq;I-=aq}else{if(ao>0){ao-=aq;P+=aq;I+=aq}}if(an<0){an+=ap;N-=ap;H-=ap}else{if(an>0){an-=ap;N+=ap;H+=ap}}C(I,H);if(Math.abs(P)>Z||Math.abs(N)>Z){U()}aq=Math.round(Math.abs(ao)*0.3);ap=Math.round(Math.abs(an)*0.3)}if(V.moveend){V.moveend()}if(v.panToPosition){v.panToPosition(s.getCenterPosition());v.panToPosition=undefined}S=false;for(var ar in z){if(z.hasOwnProperty(ar)){z[ar].showTilesInViewport()}}}function U(){var am;if(P<=-Z){P=P+Z;for(am in z){if(z.hasOwnProperty(am)){z[am].rotateTiles(0,1)}}ah()}else{if(P>=Z){P=P-Z;for(am in z){if(z.hasOwnProperty(am)){z[am].rotateTiles(0,-1)}}ah()}}if(N<=-Z){N=N+Z;for(am in z){if(z.hasOwnProperty(am)){z[am].rotateTiles(-1,0)}}ah()}else{if(N>=Z){N=N-Z;for(am in z){if(z.hasOwnProperty(am)){z[am].rotateTiles(1,0)}}ah()}}}function K(am){A=am;y=A/d*t}function E(){return y}function C(am,an){Q.style.left=am+r;Q.style.top=an+r}this.getOnlyLoadTilesInViewport=function(){return M};this.getCenterPosition=function(){if(!aa){throw new Exception("Center Position not set")}var ao=I-b;var an=H-f;if(ao==0&&an==0){return aa}var am=s.posToMercPix(aa);am.x-=ao;am.y+=an;var ap=s.mercPixToPos(am);return ap};this.getZoomLevel=function(){return ac};this.posToMercPix=function(ap){var an=Utilities.radsPerPixelAtZoom(aj,21-ac);var ao=Utilities.lat2pix(ap.lat,an);var am=Utilities.lon2pix(ap.lon,an);return new PixelPoint(am,ao)};this.mercPixToPos=function(am){var ap=Utilities.radsPerPixelAtZoom(aj,21-ac);var an=Utilities.pix2lat(am.y,ap);var ao=Utilities.pix2lon(am.x,ap);return new Position(an,ao)};function ah(){}this.getZoomDifNow=function(){return ac-s.map.getZoomController().getZoomLevel()};function l(){var am=s.map.getZoomController();if(!am){return 5+s.zoomDif}var an=am.getZoomLevel()+s.zoomDif;if(an>am.upperBound){an=am.upperBound}if(an<am.lowerBound){an=am.lowerBound}return an}this.appendThis=function(){if(!this.frame){this.initialize()}var am=this.frame||null;return am};this.position=function(am){if(!this.map){return}if(this.frame){}};this.getTileFading=function(){return false}}function MapTypeController(){this.init()}MapTypeController.prototype.map=null;MapTypeController.prototype.type="MapTypeController";MapTypeController.prototype.frame=null;MapTypeController.prototype.cssClass="decarta-mapTypeController";MapTypeController.prototype.linkCssClass="decarta-mapTypeControllerLink";MapTypeController.prototype.streetLabel=GLOBALS.STREET;MapTypeController.prototype.hybridLabel=GLOBALS.HYBRID;MapTypeController.prototype.satelliteLabel=GLOBALS.SATELLITE;MapTypeController.prototype.init=function(){};MapTypeController.prototype.build=function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");var c=document.createElement("span");c.innerHTML=" | ";deCarta.IdManager.setTag(c,"ignoreForMapEvents");var a=document.createElement("span");a.innerHTML=" | ";deCarta.IdManager.setTag(a,"ignoreForMapEvents");var f=document.createElement("a");f.className=this.linkCssClass;f.innerHTML=this.streetLabel;f.href="#";f.mapType=GLOBALS.STREET;f.owner=this;f.onclick=this.handleClick;deCarta.IdManager.setTag(f,"ignoreForMapEvents");var b=document.createElement("a");b.className=this.linkCssClass;b.innerHTML=this.hybridLabel;b.href="#";b.mapType=GLOBALS.HYBRID;b.owner=this;b.onclick=this.handleClick;deCarta.IdManager.setTag(b,"ignoreForMapEvents");var d=document.createElement("a");d.className=this.linkCssClass;d.innerHTML=this.satelliteLabel;d.href="#";d.owner=this;d.mapType=GLOBALS.SATELLITE;d.onclick=this.handleClick;deCarta.IdManager.setTag(d,"ignoreForMapEvents");this.frame.appendChild(f);this.frame.appendChild(c);this.frame.appendChild(b);this.frame.appendChild(a);this.frame.appendChild(d)};MapTypeController.prototype.appendThis=function(){if(!this.frame){this.build()}return this.frame};MapTypeController.prototype.removeThis=function(){this.map=null;return this.frame};MapTypeController.prototype.position=function(a){this.frame.style.top="5px";this.frame.style.left=a.width-207+"px"};MapTypeController.prototype.handleClick=function(){if(!GLOBALS.ALLOWDOMEVENTS){return true}this.owner.map.setMapType(this.mapType);return false};deCarta.Math={};deCarta.Math.MercatorSpherical=function(){var d=null;var b=null;var h=null;var j=null;function a(l){return(l*Math.PI/180)}function k(l){return(l*180/Math.PI)}function f(m){var p=a(m);var n=Math.sin(p);var o=Math.log((1+n)/(1-n))/2;var l=k(o);return l}function c(m){var p=a(m);var n=Math.exp(2*p);var o=Math.asin((n-1)/(n+1));var l=k(o);return l}function g(){if(!d||(!b&&b!==0)||(!h&&h!==0)){return false}j=h/Math.abs(d.maxPosition.lon-d.minPosition.lon);return true}this.getBoundingBox=function(){return d};this.setBoundingBox=function(l){if(l.minPosition==undefined||l.maxPosition==undefined){throw new Exception("deCarta.Math.MercatorSpherical.setPixelHeight passed invalid boundingBox of: "+l)}else{d=l}};this.getPixelHeight=function(){return b};this.setPixelHeight=function(l){var m=parseInt(l,10);if(isNaN(m)||(m<0)){throw new Exception("deCarta.Math.MercatorSpherical.setPixelHeight passed invalid height of: "+l)}else{b=m}};this.getPixelWidth=function(){return h};this.setPixelWidth=function(m){var l=parseInt(m,10);if(isNaN(l)||(l<0)){throw new Exception("deCarta.Math.MercatorSpherical.setPixelWidth passed invalid width of: "+m)}else{h=l}};this.positionToPixels=function(o){if(!g()||!o||(!o.lat&&o.lat!=0)||(!o.lon&&o.lon!=0)){throw new Exception("deCarta.Math.MercatorSpherical.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating positionToPixels")}var m=new PixelPoint(0,0);m.x=j*(d.minPosition.lon-o.lon)*-1;var n=f(d.maxPosition.lat)-f(o.lat);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);m.y=b*n/l;return m};this.pixelsToPosition=function(m){if(!g()||!m||(!m.x&&m.x!=0)||(!m.y&&m.y!=0)){throw new Exception("deCarta.Math.MercatorSpherical.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating pixelsToPositiion")}var o=new Position(0,0);o.lon=d.minPosition.lon+(m.x/j);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);var n=(m.y/b)*l;o.lat=c(f(d.maxPosition.lat)-n);return o}};deCarta.Math.MercatorEllipsoidal=function(){var d=null;var b=null;var h=null;var j=null;function a(l){return(l*Math.PI/180)}function k(l){return(l*180/Math.PI)}function f(o){var n=0.081819190842;var q=a(o);var l=n*Math.sin(q);var p=Math.log(Math.pow(((1-l)/(1+l)),n/2)*Math.tan((Math.PI/4)+(q/2)));var m=k(p);return m}function c(n){var q=a(n);var p=Math.pow(Math.E,-q);var m=r();for(var o=0;o<6;o++){m=s(m)}var l=k(m);return l;function r(){return Math.PI/2-2*Math.atan(p)}function s(z){var u=0.0818191908426216;var t=u*Math.sin(z);var w=p*Math.pow((1-t)/(1+t),u/2);var v=(Math.PI/2)-(2*Math.atan(w));return v}}function g(){if(!d||(!b&&b!==0)||(!h&&h!==0)){return false}j=h/Math.abs(d.maxPosition.lon-d.minPosition.lon);return true}this.getBoundingBox=function(){return d};this.setBoundingBox=function(l){if(l.minPosition==undefined||l.maxPosition==undefined){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelHeight passed invalid boundingBox of: "+l)}else{d=l}};this.getPixelHeight=function(){return b};this.setPixelHeight=function(l){var m=parseInt(l,10);if(isNaN(m)||(m<0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelHeight passed invalid height of: "+l)}else{b=m}};this.getPixelWidth=function(){return h};this.setPixelWidth=function(m){var l=parseInt(m,10);if(isNaN(l)||(l<0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelWidth passed invalid width of: "+m)}else{h=l}};this.positionToPixels=function(o){if(!g()||!o||(!o.lat&&o.lat!=0)||(!o.lon&&o.lon!=0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating positionToPixels")}var m=new PixelPoint(0,0);m.x=j*(d.minPosition.lon-o.lon)*-1;var n=f(d.maxPosition.lat)-f(o.lat);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);m.y=b*n/l;return m};this.pixelsToPosition=function(m){if(!g()||!m||(!m.x&&m.x!=0)||(!m.y&&m.y!=0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating pixelsToPositiion")}var o=new Position(0,0);o.lon=d.minPosition.lon+(m.x/j);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);var n=(m.y/b)*l;o.lat=c(f(d.maxPosition.lat)-n);return o}};deCarta.Math.greatCircleDist=function(m,l,a){if(!m||!l){throw new Exception("Utilities.greatCircleDist: must have valid coords")}var d=Math.PI*m.lat/180;var h=Math.cos(d);var j=Math.PI*m.lon/180;var c=Math.PI*l.lat/180;var g=Math.cos(c);var f=Math.PI*l.lon/180;var k=Math.abs(Math.abs(j)-Math.abs(f));var o=6372795;var b;var n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(((c-d)/2)),2)+(h*g*Math.pow(Math.sin(k/2),2))));b=o*n;if(!a||a.value=="M"){return b}switch(a.value){case"KM":b/=1000;break;case"MI":b/=1609;break;case"FT":b*=3.28084;break;default:throw new Exception("Utilities.greatCircleDist: unexpected uom value of: "+a.value);break}return b};deCarta.Math.pointInPolygon=function(h,g){function o(r,t,s){if(t.lat<s.lat){if(r){return false}else{return true}}else{if(!r){return false}else{return true}}}function q(s,t,r){if(t.lon<r.lon){if(!s){return false}else{return true}}else{if(s){return false}else{return true}}}var b;var j;var a=0;var p=0;if(g.lat<h[0].lat){j=true}else{j=false}if(g.lon<h[0].lon){b=false}else{b=true}for(var m in h){var f=q(b,g,h[m]);var l=o(j,g,h[m]);if(f&&l){var c=h[m].lat-h[m-1].lat;var d=h[m].lon-h[m-1].lon;var k=c/d;c=g.lat-h[m-1].lat;d=g.lon-h[m-1].lon;var n=c/d;if((b&&!j)||(!b&&!j)){if(n>k){p++}else{a++}}if((!b&&j)||(b&&j)){if(n<k){p++}else{a++}}b=!b;j=!j}else{if(f){b=!b}if(l){j=!j;if(b){a++}else{p++}}}}if(a%2==0){return false}else{return true}};deCarta.Math.headingFromPositions=function(c,a){if(!c||(!c.lat&&c.lat!=0)||(!c.lon&&c.lon!=0)||!a||(!a.lat&&a.lat!=0)||(!a.lon&&a.lon!=0)){throw new Exception("deCarta.Math.headingFromPosition: bad arguments.")}var f=Math.PI/180;var h=c.lat*f;var d=c.lon*f;var g=a.lat*f;var b=a.lon*f;var j=Math.atan2(Math.sin(b-d)*Math.cos(g),Math.cos(h)*Math.sin(g)-Math.sin(h)*Math.cos(g)*Math.cos(b-d));return j/f};deCarta.ObjectToJSON=function(k,d,a){var f;var h="";var c="";if(typeof a==="number"){for(f=0;f<a;f+=1){c+=" "}}else{if(typeof a==="string"){c=a}}var j=d;if(d&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number")){throw new Exception("Bad replacer in deCarta.ObjectToJSON")}return g("",{"":k});function b(l){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;n.lastIndex=0;return n.test(l)?'"'+l.replace(n,function(o){var p=m[o];return typeof p==="string"?p:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function g(s,p){var n,m,t,l,q=h,o,r=p[s];if(r&&typeof r==="object"&&typeof r.toJSON==="function"){r=r.toJSON(s)}if(typeof j==="function"){r=j.call(p,s,r)}switch(typeof r){case"string":return b(r);case"number":return isFinite(r)?String(r):"null";case"boolean":case"null":return String(r);case"object":if(!r){return"null"}h+=c;o=[];if(Object.prototype.toString.apply(r)==="[object Array]"){l=r.length;for(n=0;n<l;n+=1){o[n]=g(n,r)||"null"}t=o.length===0?"[]":h?"[\n"+h+o.join(",\n"+h)+"\n"+q+"]":"["+o.join(",")+"]";h=q;return t}if(j&&typeof j==="object"){l=j.length;for(n=0;n<l;n+=1){m=j[n];if(typeof m==="string"){t=g(m,r);if(t){o.push(b(m)+(h?": ":":")+t)}}}}else{for(m in r){if(Object.hasOwnProperty.call(r,m)){t=g(m,r);if(t){o.push(b(m)+(h?": ":":")+t)}}}}t=o.length===0?"{}":h?"{\n"+h+o.join(",\n"+h)+"\n"+q+"}":"{"+o.join(",")+"}";h=q;return t}}};function OpenSearchQuery(){this.url=null;this.callback=null;this.params=null}OpenSearchQuery.prototype.setCallback=function(a){this.callback=a};OpenSearchQuery.prototype.setURL=function(a){this.url=a};OpenSearchQuery.prototype.setParams=function(b){this.params="?";for(var a in b){if(b.hasOwnProperty(a)){this.params+=a+"="+b[a]+"&"}}};OpenSearchQuery.prototype.send=function(){var b=this;if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(c){}}var a=new XMLHttpRequest();a.open("POST",this.url+this.params,true);a.onreadystatechange=function(){if(a.readyState==4){b.callback(a.responseText)}};a.send(null)};function POI(d,a,b,c,f){this.name=d;this.position=a;this.address=b;this.phoneNumber=c;this.distance=null;this.properties=f||{};this.toString=function(){return this.name+" "+this.position+" "+this.address+" "+this.phoneNumber}}function POIQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var b=[];var a=this;this.authenticate=function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating POIQuery, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.query=function(f,h,c){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("POIQuery.query: callBack must be a function, arg was: "+h)}var d=this.xmlRecFac.createPOIRequest(f,g);JSRequest.send(d,a.queryCallback,null,c)};this.fullDetailsQuery=function(h,g,c){var f=Utilities.getRequestId();if(typeof g=="function"){b[f]=g}else{throw new Exception("POIQuery.fullDetailsQuery: callBack must be a function, arg was: "+g)}var d=this.xmlRecFac.createFullDetailsPOIRequest(h,f);JSRequest.send(d,a.fullDetailsQueryCallback,null,c)};this.queryCallback=function(h){var j=false;var d;var f=[];var g;if(deCarta.JSONParser.parseErrors(h)){g=h.XLS.Response.requestID}else{if(deCarta.Array.isArray(h.XLS.Response)){g=h.XLS.Response[0].requestID;j=true;for(d=0;d<h.XLS.Response.length;d++){f.push([]);c(h.XLS.Response[d].DirectoryResponse.POIContext)}}else{g=h.XLS.Response.requestID;c(h.XLS.Response.DirectoryResponse.POIContext)}}if((g>=0)&&b[g]){b[g](f);b[g]=undefined}function c(n){var l;if(!n){return}else{if(n.length==undefined){l=[];l.push(n)}else{l=n}}for(var k=0;k<l.length;k++){var m=deCarta.JSONParser.parsePOI(l[k]);if(j){f[d].push(m)}else{f.push(m)}}}};this.fullDetailsQueryCallback=function(d){var c=d.XLS.Response.requestID;if((c>=0)&&b[c]){b[c]((d.XLS.Response.DirectoryResponse.POIContext.POI));b[c]=undefined}}}function PanController(a){this.init(a)}PanController.prototype.map=null;PanController.prototype.type="PanController";PanController.prototype.frame=null;PanController.prototype.cssClass="decarta-panController";PanController.prototype.opts={screenPosition:"topLeft",xMargin:0,yMargin:0};PanController.prototype.init=function(a){if(!a){a={}}this.setOpts(a)};PanController.prototype.setOpts=function(a){if(typeof a.screenPosition!=="undefined"){this.opts.screenPosition=a.screenPosition}if(typeof a.xMargin!=="undefined"){this.opts.xMargin=a.xMargin}if(typeof a.yMargin!=="undefined"){this.opts.yMargin=a.yMargin}};PanController.prototype.build=function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;var h=document.createElement("img");h.className="decarta-panController-north";h.src=Credentials.imgPath+"z2t_pan_north.png";h.onclick=this.map.panNorth;var b=document.createElement("img");b.className="decarta-panController-south";b.src=Credentials.imgPath+"z2t_pan_south.png";b.onclick=this.map.panSouth;var d=document.createElement("img");d.className="decarta-panController-east";d.src=Credentials.imgPath+"z2t_pan_east.png";d.onclick=this.map.panEast;var a=document.createElement("img");a.className="decarta-panController-west";a.src=Credentials.imgPath+"z2t_pan_west.png";a.onclick=this.map.panWest;var g=document.createElement("img");g.className="decarta-panController-center";g.src=Credentials.imgPath+"z2t_pan_center_gray.png";var f=this;g.onclick=function(){if(g.src.indexOf("loading-ball.gif")>-1){return}g.src=Credentials.imgPath+"loading-ball.gif";var j=function(m){m=m.coords||m;var n=new Position(m.latitude+" "+m.longitude);return n};var c=function(m){g.src=Credentials.imgPath+"z2t_pan_center_gray.png";f.map.panToPosition(j(m))};var k=function(){g.src=Credentials.imgPath+"z2t_pan_center_gray.png";alert("unable to position")};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(c,k)}else{if(window.google&&google.gears){var l=google.gears.factory.create("beta.geolocation");if((l)&&(l.getPermission())){l.getCurrentPosition(c,k)}}else{g.src=Credentials.imgPath+"z2t_pan_center_gray.png"}}};this.frame.appendChild(h);this.frame.appendChild(b);this.frame.appendChild(d);this.frame.appendChild(a);this.frame.appendChild(g);this.position()};PanController.prototype.appendThis=function(){if(!this.frame){this.build()}return this.frame};PanController.prototype.removeThis=function(){this.map=null;return this.frame};PanController.prototype.position=function(a){switch(this.opts.screenPosition){default:case"topLeft":this.frame.style.marginLeft=this.opts.xMargin+"px";this.frame.style.marginTop=this.opts.yMargin+"px";break;case"topRight":throw ("Not Implemented");break}};function Pin(f,k,v,w){if(!f){throw new Exception("Error instantiating Pin, must at least provide a Position.");return false}var p=this;var l=new Array();var y=170;var C=null;var A=null;var u=false;var h=false;var m=null;var g=null;var j=null;this.type="pin";this.position=null;if(f&&f.clone){this.position=f.clone()}this.icon=w||new Icon(Credentials.pinIconPath,12,12,24,24);this.map=null;this.isVisible=true;this.id="";this.pinImg=null;this.pinImg=document.createElement("img");var d="decarta-pin";this.pinImg.className=d;this.pinImg.style.position="absolute";this.pinImg.id=f.toString();this.pinImg.src=this.icon.src;this.pinImg.style.width=parseInt(this.icon.width)+"px";this.pinImg.style.height=parseInt(this.icon.height)+"px";Pin.zIndexCounter++;this.pinImg.style.zIndex=Pin.zIndexCounter;this.pinImg.style.cursor="pointer";this.pinImg.style.display="block";this.pinImg.msg=k||"";if(Utilities.ie6&&this.pinImg.src.match(new RegExp("\\bpng\\b","g"))){Utilities.fixPng(this.pinImg)}deCarta.IdManager.setTag(this.pinImg,"ignoreForMapEvents");this.poi=null;this.hoverIconOn=null;this.hoverIconOff=null;this.pinTxt=null;this.pinTxt=document.createElement("DIV");this.pinTxt.id="decarta-textoverlay";this.pinTxt.innerHTML=this.icon.overlay.text;this.pinTxt.className=this.icon.overlay.className;this.pinTxt.style.position="absolute";this.pinTxt.style.color=this.icon.overlay.color;this.pinTxt.style.fontSize=this.icon.overlay.size;this.pinTxt.style.fontFamily=this.icon.overlay.fontFamily;if(this.icon.overlay.text==""){this.pinTxt.style.display="none"}else{this.pinTxt.style.display="block"}Pin.zIndexCounter++;this.pinTxt.style.zIndex=Pin.zIndexCounter;this.pinTxt.style.cursor="pointer";deCarta.IdManager.setTag(this.pinTxt,"ignoreForMapEvents");this.animateDrop=false;this.dropSpeed=30;this.animate=function(D,E){if(D=="DROP"){this.animateDrop=true;if(E=="FAST"){this.dropSpeed=20}else{this.dropSpeed=35}}};this.animateDropPosition=300;function o(){if(p.animateDropPosition>0){p.pinImg.style.top=(parseInt(p.pinImg.style.top)+10)+"px";p.pinTxt.style.top=(parseInt(p.pinTxt.style.top)+10)+"px";p.animateDropPosition-=10;setTimeout(o,p.dropSpeed)}}this.getZIndex=function(){return(this.pinImg.style.zIndex)};this.setZIndex=function(E){var D=parseInt(E,10);if(!isNaN(D)){this.pinImg.style.zIndex=D;if(this.pinTxt){this.pinTxt.style.zIndex=D+1}}else{this.pinImg.style.zIndex=0;if(this.pinTxt){this.pinTxt.style.zIndex=1}}};this.setId=function(D){this.id=D};this.getId=function(){return this.id};this.setCursorStyle=function(D){this.pinImg.style.cursor=D;this.pinTxt.style.cursor=D};this.getCursorStyle=function(){return this.pinImg.style.cursor};this.setIcon=function(D){p.pinImg.src=D.src;if(p.icon.anchorY==D.anchorY&&p.icon.anchorX==D.anchorX&&D._previousY&&D._previousX){p.pinImg.style.top=(parseInt(p.pinImg.style.top)+D._previousY-D.anchorY)+"px";p.pinImg.style.left=(parseInt(p.pinImg.style.left)+D._previousX-D.anchorX)+"px"}else{p.pinImg.style.top=(parseInt(p.pinImg.style.top)+p.icon.anchorY-D.anchorY)+"px";p.pinImg.style.left=(parseInt(p.pinImg.style.left)+p.icon.anchorX-D.anchorX)+"px"}p.pinImg.style.width=D.width+"px";p.pinImg.style.height=D.height+"px";p.icon=D;if(D.overlay.text!=""){p.pinTxt.style.display="block";p.pinTxt.innerHTML=this.icon.overlay.text;p.pinTxt.style.position="absolute";if(D.overlay.className){p.pinTxt.style.className=D.overlay.className}if(D.overlay.color){p.pinTxt.style.color=D.overlay.color}if(D.overlay.size){p.pinTxt.style.fontSize=D.overlay.size}if(D.overlay.fontFamily){p.pinTxt.style.fontFamily=D.overlay.fontFamily}p.pinTxt.style.left=(parseInt(p.pinImg.style.left)+parseInt(p.icon.overlay.anchorX))+"px";p.pinTxt.style.top=(parseInt(p.pinImg.style.top)+parseInt(p.icon.overlay.anchorY))+"px"}else{p.pinTxt.innerHTML="";p.pinTxt.style.display="none"}if(Utilities.ie6&&this.pinImg.src.match(new RegExp("\\bpng\\b","g"))){var E=this.pinImg.src;this.pinImg.src=Credentials.transparentGIF;this.pinImg.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+E+"',sizingMethod='scale')"}};this.getIcon=function(){return p.icon};this.setX=function(D){var E=D-p.icon.anchorX;if(p.pinImg.offsetLeft==E){return false}p.pinImg.style.left=E+"px";if(p.pinTxt){p.pinTxt.style.left=(E+p.icon.overlay.anchorX)+"px"}return true};this.setY=function(E){if(p.animateDrop){p.pinImg.style.top=(E-p.icon.anchorY-p.animateDropPosition)+"px";if(p.pinTxt){p.pinTxt.style.top=(E-p.icon.anchorY+p.icon.overlay.anchorY-p.animateDropPosition)+"px"}}else{var D=E-p.icon.anchorY;if(p.pinImg.offsetTop==D){return false}p.pinImg.style.top=(D)+"px";if(p.pinTxt){p.pinTxt.style.top=(D+p.icon.overlay.anchorY)+"px"}}if(p.animateDrop){o()}return true};this.getPosition=function(){return p.position};this.setPosition=function(G){if(p.map!=null){var F=p.map.positionToMapLayerPixel(G);var E=p.setX(F.x);var D=p.setY(F.y)}p.position=G;return((E||D)?true:false)};this.setMessage=function(D){p.pinImg.msg=D;if(p.map&&p.pinImg&&p.map.getInfoWindow()&&(p==p.map.getInfoWindow().associatedPin)){p.map.getInfoWindow().setContent(D)}};this.getMessage=function(){return p.pinImg.msg};this.hide=function(){p.isVisible=false;p.pinImg.style.display="none";p.pinTxt.style.display="none"};this.show=function(){p.isVisible=true;p.pinImg.style.display="block";if(p.pinTxt.innerHTML!=""){p.pinTxt.style.display="block"}};this.zoomHide=function(){if(p.isVisible){p.pinImg.style.display="none";p.pinTxt.style.display="none"}};this.zoomShow=function(){if(p.isVisible){p.pinImg.style.display="block";if(p.pinTxt.innerHTML!=""){p.pinTxt.style.display="block"}}};this.showInfoWindow=function(){p.map.getInfoWindow().setPosition(parseInt(p.pinImg.style.left),parseInt(p.pinImg.style.top));p.map.getInfoWindow().setContent(p.pinImg.msg);p.map.getInfoWindow().show(p)};this.hideInfoWindow=function(){p.map.getInfoWindow().hide()};this.addEventListener=function(E,F){var G=false;for(var D=0;D<l.length;D++){if(l[D]==E){l[E]=F;G=true;break}}if(!G){l.push(E);l[E]=F;if(E=="click"||E=="dblclick"||E=="rightclick"){deCarta.Events.addEvent(p.pinImg,"mousedown",r);deCarta.Events.addEvent(p.pinImg,"mouseup",s);deCarta.Events.addEvent(p.pinTxt,"mousedown",r);deCarta.Events.addEvent(p.pinTxt,"mouseup",s)}else{if(E=="mouseover"){deCarta.Events.addEvent(p.pinImg,"mouseover",B);deCarta.Events.addEvent(p.pinTxt,"mouseover",B)}else{if(E=="mouseout"){deCarta.Events.addEvent(p.pinImg,"mouseout",z);deCarta.Events.addEvent(p.pinTxt,"mouseout",z)}}}}};this.clearInstanceListeners=function(){for(var D=0;D<l.length;D++){l[l[D]]=null;l[D]=null}};this.clearListeners=function(E){for(var D=0;D<l.length;D++){if(l[D]==E){l[l[D]]=null}}l[D]=null};function r(D){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(D.button==2||D.which==3){u=true;return false}if(l.mousedown){l.mousedown(p)}return false}function s(D){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(u){t();return false}if(l.mouseup){l.mouseup(p)}if(!C){A=setTimeout(q,y);C=new Date()}else{clearTimeout(A);n()}return false}function q(){c();if(l.click){l.click(p)}}function n(){c();if(l.dblclick){l.dblclick(p)}}function t(){c();if(l.rightclick){l.rightclick(p)}}this.pickup=function(){if(!h){deCarta.Events.addEvent(window.document,"mousemove",a)}};this.drop=function(){if(h){b()}};function a(U){var L=U.clientX;var K=U.clientY;var X=p.pinImg;var I=parseInt(X.style.top,10);var E=parseInt(X.style.left,10);var P=p.pinTxt;var M=parseInt(P.style.top,10);var H=parseInt(P.style.left,10);var V=p.map;var G=0;var F=0;var N=0;var D=0;if(!h){h=true;m=new PixelPoint(L,K);g=new PixelPoint(E,I);j=new PixelPoint(H,M)}var Q=K-Utilities.getAbsoluteTop(V.mapDiv)+Utilities.getScrollTop();var R=L-Utilities.getAbsoluteLeft(V.mapDiv)+Utilities.getScrollLeft();var O=I+parseInt(V.getTileDiv().style.top,10);var S=O+X.clientHeight/2;var W=E+parseInt(V.getTileDiv().style.left,10);var T=W+X.clientWidth/2;if(S!=Q){F=Q-S}N=I+F;X.style.top=N+"px";P.style.top=(M+F)+"px";if(T!=R){G=R-T}D=E+G;X.style.left=D+"px";P.style.left=(H+G)+"px";return false}function b(G){deCarta.Events.removeEvent(window.document,"mousemove",a);var M=parseInt(p.pinImg.style.left,10)-g.x;var L=-(parseInt(p.pinImg.style.top,10)-g.y);var N=p.map.getZoomController().getGXConvertedZoomLevel();var F=Utilities.radsPerPixelAtZoom(p.map.getTileSize(),N);var K=Utilities.lon2pix(p.position.lon,F);var I=Utilities.lat2pix(p.position.lat,F);var D=Utilities.pix2lon((K+M),F);var H=Utilities.pix2lat((I+L),F);var E=new Position(H,D);p.setPosition(E);h=false;m=null;g=null;j=null;return false}function B(){if(!GLOBALS.ALLOWDOMEVENTS){return}if(l.mouseover){l.mouseover(p)}}function z(){if(!GLOBALS.ALLOWDOMEVENTS){return}if(l.mouseout){l.mouseout(p)}}function c(){C=null;A=null;u=false}if(v&&(v=="onmouseover"||v=="mouseover")){p.addEventListener("mouseover",p.showInfoWindow);p.addEventListener("mouseout",p.hideInfoWindow)}else{if(v&&(v=="onclick"||v=="click")){p.addEventListener("click",p.showInfoWindow)}}this.destroy=function(){if(p&&p.map){if(p.pinImg){p.pinImg=p.map.getTileDiv().removeChild(p.pinImg);if(p.pinImg){Utilities.purge(p.pinImg)}p.pinImg=null}if(p.pinTxt){p.pinTxt=p.map.getTileDiv().removeChild(p.pinTxt);if(p.pinTxt){Utilities.purge(p.pinTxt)}p.pinTxt=null}}p=null};this.toString=function(){if(!p){p=this}var D=p.position.toString();return D};this.equals=function(D){if(D&&D.toString()==this.toString()&&D.pinImg==this.pinImg){return true}else{return false}};this.getViewableBoundingBox=function(H){var M=Utilities.lat2pix(p.position.lat,H);var E=Utilities.lon2pix(p.position.lon,H);var L=M+p.icon.anchorY;var R=E+parseInt(p.pinImg.style.width)-p.icon.anchorX;var Q=M-parseInt(p.pinImg.style.height)+p.icon.anchorY;var I=E-p.icon.anchorX;var N=Utilities.pix2lat(L,H);var D=Utilities.pix2lon(R,H);var O=Utilities.pix2lat(Q,H);var F=Utilities.pix2lon(I,H);var K=new Position(N,D);var G=new Position(O,F);var P=new BoundingBox(G,K);return P}}Pin.zIndexCounter=100;function PixelPoint(a,c){try{this.x=parseFloat(a);this.y=parseFloat(c);if(isNaN(this.x)||isNaN(this.y)){throw new Exception("")}}catch(b){throw new Exception("PixelPoint: bad constructor values for x: "+a+" and y: "+c)}}PixelPoint.prototype.getX=function(){return this.x};PixelPoint.prototype.roundX=function(){return Math.round(this.x)};PixelPoint.prototype.setX=function(a){this.x=parseFloat(a);if(isNaN(this.x)){throw new Exception("PixelPoint: setX bad argument x: "+a)}};PixelPoint.prototype.getY=function(){return this.y};PixelPoint.prototype.roundY=function(){return Math.round(this.y)};PixelPoint.prototype.setY=function(a){this.y=parseFloat(a);if(isNaN(this.y)){throw new Exception("PixelPoint: setY bad argument y: "+a)}};PixelPoint.prototype.toString=function(){return this.x+" "+this.y};PixelPoint.prototype.equals=function(a){if(a&&a.toString()==this.toString()){return true}else{return false}};function Position(f,b){this.lat=0;this.lon=0;if(arguments.length==1){var d=f.split(" ");if(d.length!=2){throw new Exception("error initializing Position object")}try{this.lat=parseFloat(d[0]);this.lon=parseFloat(d[1]);if(isNaN(this.lat)||isNaN(this.lon)){throw new Exception()}}catch(c){throw new Exception("error initializing Position object")}}else{if(arguments.length==2){try{this.lat=parseFloat(f);this.lon=parseFloat(b);if(isNaN(this.lat)||isNaN(this.lon)){throw new Exception()}}catch(c){throw new Exception("error initializing Position object")}}else{throw new Exception("error initializing Position object")}}if(this.lat>90){this.lat=89.5}if(this.lat<-90){this.lat=-89.5}if(this.lon>180||this.lon<-180){var a=this.lon%360;if(a<=-180){a=(360+a)}else{if(a>=180){a=-(360-a)}}this.lon=a}this.customProperties={}}Position.prototype.clone=function(){return new Position(this.toString())};Position.prototype.getLat=function(){return this.lat};Position.prototype.getLon=function(){return this.lon};Position.prototype.setLat=function(a){this.lat=a};Position.prototype.setLon=function(a){this.lon=a};Position.prototype.getLatLon=function(){return this.lat+" "+this.lon};Position.prototype.getLatCommaLon=function(){return this.lat+", "+this.lon};Position.prototype.equals=function(a){if(a&&a.getLatLon()==this.getLatLon()){return true}else{return false}};Position.prototype.toString=function(){return this.lat.toFixed(14)+" "+this.lon.toFixed(14)};deCarta.PositionAnimator=function(b,a){if(b&&a){this.animate(b,a)}};deCarta.PositionAnimator.prototype={animate:function(c,a){this.map=c;var b={start:null,end:null,duration:300,onStep:null,onEnd:null};if(!a.start||!a.end||!a.onStep||!c){throw ("You need to specify a start point, and end point and a callback for a position animation")}a=Utilities.extend(b,a);this.start=a.start;this.end=a.end;this.duration=a.duration;this.onStep=a.onStep;this.onEnd=a.onEnd;this.endTime=new Date().getTime()+this.duration;this.step()},step:function(){var d=1-((this.endTime-new Date().getTime())/this.duration);if(d>=0.99){if(typeof this.onEnd==="function"){this.onEnd(this.end)}}else{var g=this.posToPix(this.start);var c=this.posToPix(this.end);var b=c.x-g.x;var a=c.y-g.y;var j=b*d;var h=a*d;var f=this.pixToPos({x:g.x+j,y:g.y+h});if(typeof this.onStep==="function"){this.onStep(f)}setTimeout(this.step.scope(this),20)}},posToPix:function(c){var a=this.map.getZoomController().getGXConvertedZoomLevel();var b=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),a);return{x:Utilities.lon2pix(c.lon,b),y:Utilities.lat2pix(c.lat,b)}},pixToPos:function(a){var b=this.map.getZoomController().getGXConvertedZoomLevel();var c=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),b);return new Position(Utilities.pix2lat(a.y,c),Utilities.pix2lon(a.x,c))}};function Radius(c,b){this.distance=c;this.uom=b||new UOM("KM");var a;if(b=="KM"){a="K"}else{if(b=="M"){a="M"}else{if(b=="MI"){a="R"}else{if(b=="FT"){a="F"}}}}this.uomdds=a;this.toString=function(){return this.distance+" "+this.uom};this.getDegrees=function(){if(this.uom=="KM"){return this.distance/111.111}else{if(this.uom=="M"){return(this.distance/1000)/111.111}else{if(this.uom=="MI"){return(this.distance*1.609)/111.111}else{if(this.uom=="FT"){return((this.distance/3.28)/1000)/111.111}}}}}}function Route(){this.alternates=[];this.TotalTime="";this.TotalTimeObject={};this.TotalDistance="";this.viaPointSequence="";this.RouteInstructions=[];this.RouteGeometry=[];this.routeID="";this.boundingBox=null;this.centerPosition=null;this.uom=null;this.id=Math.floor(Math.random()*10000000);this.title="";this.description="";this.customProperties={}}function ManeuverMap(){this.desc;this.URL;this.height;this.width;this.format;this.boundingBox}function RouteInstruction(){this.maneuverMap=undefined;this.Instruction="";this.distance="";this.duration="";this.position=null;this.tour=""}function RoutePreference(b,c,a){this.maneuverMaps=false;this.maneuverMapConfig={format:"GIF",height:200,width:200};this.routePreference=b||"Fastest";this.vehicleType=null;this.validVehicleTypes={PassengerCar:"Regular passenger cars","4WD":"Vehicles with four wheel drive",HOV:"High Occupancy Vehicles",Emergency:"Emergency Vehicles, Ambulance",Taxi:"Taxis",PublicBus:"Public buses, ex: city bus",DeliveryTruck:"Delivery Trucks",TransportTruck:"Transport Trucks",Motorcycle:"Motorcycles",Pedestrian:"Pedestrians"};this.uom=c||new UOM("KM");this.routeQueryType=a||"RTXT";this.rules=null;this.optimized=false;this.expectedStartTime=null;this.alternateRoutes=0;this.avoidAreas=[];this.avoidList=[];this.generalizationFactor=0;this.generalizationBBox=null;this.returnRouteGeometry=true;this.returnRouteInstructions=true;this.useExclusionZone=false}RoutePreference.prototype.setOptimized=function(a){this.optimized=a};RoutePreference.prototype.getOptimized=function(){return this.optimized};RoutePreference.prototype.setRules=function(a){this.rules=a};RoutePreference.prototype.getRules=function(){return this.rules};RoutePreference.prototype.setExpectedStartTime=function(a){this.expectedStartTime=a};RoutePreference.prototype.getExpectedStartTime=function(){return this.expectedStartTime};RoutePreference.prototype.getAvoidAreas=function(){return this.avoidAreas};RoutePreference.prototype.addAvoidArea=function(a){if(!a){this.avoidAreas=[]}else{this.avoidAreas.push(a)}};RoutePreference.prototype.getAvoidList=function(){return this.avoidList};RoutePreference.prototype.setVehicleType=function(a){if(a in this.validVehicleTypes){this.vehicleType=a;return}throw new Exception("RoutePreference.setVehicleType: invalid type: "+a)};RoutePreference.prototype.getVehicleType=function(){return this.vehicleType};RoutePreference.prototype.getValidVehicleType=function(){return this.validVehicleTypes};RoutePreference.prototype.setAvoidList=function(a){if(typeof a=="string"||a instanceof "String"){switch(a.toLowerCase()){case"ferry":this.avoidList.push("Ferry");return;case"toll":this.avoidList.push("Toll");return;case"tunnels":this.avoidList.push("Tunnels");return;case"bridges":this.avoidList.push("Bridges");return;default:break}}throw new Exception("RoutePreference.setAvoidList: invalid argument: feature: "+a)};RoutePreference.prototype.getGeneralizationFactor=function(){return this.generalizationFactor};RoutePreference.prototype.setGeneralizationFactor=function(a,c){try{this.generalizationBBox=Utilities.positionsToBoundingBox(a);this.generalizationFactor=Utilities.generalizationFactor(this.generalizationBBox,c)}catch(b){throw b}};RoutePreference.prototype.setUseExclusionZone=function(a){this.useExclusionZone=a};function RouteQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var b=[];var a=this;this.authenticate=function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating RouteQuery, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.query=function(c,g,j,d){var h=Utilities.getRequestId();if(typeof j=="function"){b[h]=j}else{throw new Exception("RouteQuery.query: callBack must be a function, arg was: "+j)}var f=this.xmlRecFac.createRouteGeometryRequest(c,h,g);JSRequest.send(f,a.queryCallback,null,d)};this.queryById=function(h,g,c){var f=Utilities.getRequestId();if(typeof g=="function"){b[f]=g}else{throw new Exception("RouteQuery.queryById: callBack must be a function, arg was: "+g)}var d=this.xmlRecFac.createRouteGeometryByIdRequest(h,f);JSRequest.send(d,a.queryCallback,null,c)};this.queryCallback=function(f){var d=f.XLS.Response.requestID;var c;if(deCarta.JSONParser.parseErrors(f)){c=null}else{c=deCarta.JSONParser.parseRoutes(f)}if((d>=0)&&b[d]){b[d](c);b[d]=undefined}}}function ScaleBar(a){if(!a){a={}}this.setOpts(a);this.init()}ScaleBar.prototype.map=null;ScaleBar.prototype.type="ScaleBar";ScaleBar.prototype.frameHeight=40;ScaleBar.prototype.frameWidth=120;ScaleBar.prototype.frame=null;ScaleBar.prototype.cssClass="decarta-scaleBar";ScaleBar.prototype.measureImperial=null;ScaleBar.prototype.measureMetric=null;ScaleBar.prototype.measureCssClass="decarta-scaleBarMeasure";ScaleBar.prototype.scaleImperial=null;ScaleBar.prototype.scaleImperialCssClass="decarta-scaleBarImperialScale";ScaleBar.prototype.scaleMetric=null;ScaleBar.prototype.scaleMetricCssClass="decarta-scaleBarMetricScale";ScaleBar.prototype.opts={screenPosition:"bottomRight",xMargin:0,yMargin:0};ScaleBar.prototype.setOpts=function(a){if(typeof a.screenPosition!=="undefined"){this.opts.screenPosition=a.screenPosition}if(typeof a.xMargin!=="undefined"){this.opts.xMargin=a.xMargin}if(typeof a.yMargin!=="undefined"){this.opts.yMargin=a.yMargin}};ScaleBar.prototype.init=function(){};ScaleBar.prototype.build=function(){this.measureImperial=document.createElement("div");this.measureImperial.className=this.measureCssClass;Utilities.setUnselectable(this.measureImperial);this.scaleImperial=document.createElement("div");this.scaleImperial.className=this.scaleImperialCssClass;if(Utilities.ie6){this.scaleImperial.innerHTML="&nbsp;"}Utilities.setUnselectable(this.scaleImperial);this.measureMetric=document.createElement("div");this.measureMetric.className=this.measureCssClass;Utilities.setUnselectable(this.measureMetric);this.scaleMetric=document.createElement("div");this.scaleMetric.className=this.scaleMetricCssClass;if(Utilities.ie6){this.scaleMetric.innerHTML="&nbsp;"}Utilities.setUnselectable(this.scaleMetric);this.frame=document.createElement("div");this.frame.id=this.cssClass;this.frame.className=this.cssClass;Utilities.setUnselectable(this.frame);this.frame.appendChild(this.measureImperial);this.frame.appendChild(this.scaleImperial);this.frame.appendChild(this.scaleMetric);this.frame.appendChild(this.measureMetric)};ScaleBar.prototype.appendThis=function(){if(!this.frame){this.build()}return this.frame};ScaleBar.prototype.removeThis=function(){this.map=null;return this.frame};ScaleBar.prototype.position=function(b){if(!this.map){return}var a="px";switch(this.opts.screenPosition){case"topLeft":this.frame.style.top=this.opts.yMargin+a;this.frame.style.left=this.opts.xMargin+a;break;case"topRight":this.frame.style.top=this.opts.yMargin+a;this.frame.style.left=b.width-this.opts.xMargin-this.frameWidth+a;break;case"bottomLeft":this.frame.style.top=b.height-this.opts.yMargin-this.frameHeight+a;this.frame.style.left=this.opts.xMargin+a;break;default:case"bottomRight":this.frame.style.top=b.height-this.opts.yMargin-this.frameHeight+a;this.frame.style.left=b.width-this.opts.xMargin-this.frameWidth+a;break}};ScaleBar.prototype.calculate=function(){if(!this.map||!this.map.getZoomController()){return}try{this.map.getCenterPosition()}catch(m){return}var t=this.map.getZoomController().getGXConvertedZoomLevel();var f=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),t);var d=this.map.getCenterPosition();var a=Math.cos(((d.lat)*(Math.PI/180)));var b=Utilities.lon2pix(d.lon,f);var s=Utilities.pix2lon(b+1,f);var r=Utilities.pix2lon(b,f);var c=s-r;var l=parseFloat(a*111325);var g=(c*l);var o=g*3.28;var n=this.frameWidth-15;this.scaleMetric.style.width=q(g,n)+"px";this.scaleImperial.style.width=k(o,n)+"px";this.measureMetric.innerHTML=j(g,n);this.measureImperial.innerHTML=h(o,n);function k(z,p){var v=[25,50,100,200,500,1000,2000,5280,10560,26400,52800,132000,264000,396000,528000,1056000,1584000,2640000,3168000,3696000,4224000,4752000,5280000,10560000,15840000,21120000,26400000];var A=z*p;var w;var u=v.length;for(w=0;w<u;w++){if(A<=v[w]){break}}w=(w-1>0)?w-1:0;var y=v[w]/z;return y}function h(y,p){var v=[25,50,100,200,500,1000,2000,5280,10560,26400,52800,132000,264000,396000,528000,1056000,1584000,2640000,3168000,3696000,4224000,4752000,5280000,10560000,15840000,21120000,26400000];var A=["25 ft","50 ft","100 ft","200 ft","500 ft","1000 ft","2000 ft","1 mi","2 mi","5 mi","10 mi","25 mi","50 mi","75 mi","100 mi","200 mi","300 mi","500 mi","600 mi","700 mi","800 mi","900 mi","1000 mi","2000 mi","3000 mi","4000 mi","5000 mi"];var z=y*p;var w;var u=v.length;for(w=0;w<u;w++){if(z<=v[w]){break}}w=(w-1>0)?w-1:0;return A[w]}function q(u,p){var w=[10,25,50,100,200,500,1000,2000,5000,10000,25000,50000,75000,100000,200000,300000,500000,600000,700000,800000,900000,1000000,2000000,3000000,4000000,5000000];var A=u*p;var y;var v=w.length;for(y=0;y<v;y++){if(A<=w[y]){break}}y=(y-1>0)?y-1:0;var z=w[y]/u;return z}function j(u,p){var w=[10,25,50,100,200,500,1000,2000,5000,10000,25000,50000,75000,100000,200000,300000,500000,600000,700000,800000,900000,1000000,2000000,3000000,4000000,5000000];var A=["10 m","25 m","50 m","100 m","200 m","500 m","1 km","2 km","5 km","10 km","25 km","50 km","75 km","100 km","200 km","300 km","500 km","600 km","700 km","800 km","900 km","1000 km","2000 km","3000 km","4000 km","5000 km"];var z=u*p;var y;var v=w.length;for(y=0;y<v;y++){if(z<=w[y]){break}}y=(y-1>0)?y-1:0;return A[y]}};ScaleBar.prototype.getDiv=function(){return this.frame};function SearchCriteria(g,b,a,d,c,f){this.queryString=g;this.position=null;if(b&&b.clone){this.position=b.clone()}else{throw new Exception("SearchCriteria constructor: position not valid")}this.radius=a||new Radius(0.5);if(d){this.maximumResponses=d}if(c){this.database=c}if(c){this.defaultUOM=f}}SearchCriteria.prototype=new AbstractSearchCriteria();SearchCriteria.prototype.constructor=AbstractSearchCriteria;function ServerMonitor(){var _callBackArray=[];var _xmlStringBuilder=new deCarta.XMLStringBuilder();this.query=function(callBack){if(!callBack||(typeof callBack!="function")){return false}var reqId=Utilities.getRequestId();_callBackArray[reqId]=callBack;var xmlRequestString=_xmlStringBuilder.createRUOKRequest(reqId);this.sendServerMonitorQueryRequest(xmlRequestString);return true};this.sendServerMonitorQueryRequest=function(xmlRequestString){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(e){}var url=Credentials.url;if(url.indexOf("/openls/openls")>-1){url=url.substring(0,url.indexOf("/openls/openls"));url=url+"/openls/JSON?responseFormat=ALL"}var xmlhttp=null;try{if(XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject()}}catch(e){}if(!xmlhttp){throw new Exception("ServerMonitor: I can't believe your system cannot generate an XMLHttpRequest. Oh the shame.")}xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){var rawResponse=eval(xmlhttp.responseText);var response={};response.status=xmlhttp.status;response.xml=rawResponse.xmlResponse;response.json=rawResponse.response;if(_callBackArray[response.json.XLS.Response.requestID]){_callBackArray[response.json.XLS.Response.requestID](response)}}};xmlhttp.send(xmlRequestString)}}function ShapeDrawingTool(p){this.map=null;this.frame=null;this.type="ShapeDrawingTool";this.domView=true;var j=p||a;var d=this;var m=null;var g=null;var u=null;var h=null;var y=[];var f=Utilities.ie;var r=null;var b=null;var l=null;this.initialize=function(){if(!this.domView){return}this.frame=document.createElement("DIV");this.frame.id="decarta-shapeDrawingTool";this.frame.style.cssText="position:absolute;z-index:9999;left:100px;top:10px;";deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");r=document.createElement("img");r.src=Credentials.imgPath+"draw-tool-drag-selected.png";r.style.cssText="width:31px;height:31px;position:absolute;left:0px;top:0px;";r.onclick=function(){s(true)};this.frame.appendChild(r);var D="circle";m=document.createElement("IMG");m.src=Credentials.imgPath+"draw-tool-"+D+".png";m.style.cssText="width:39px;height:31px;position:absolute;left:31px;top:0px;";m.toolName=D;m.onclick=function(F){F=F||event;F.stoppropagation?F.stoppropagation():F.cancelBubble=true;var E=F.clientX-Utilities.getAbsoluteLeft(m)+Utilities.getScrollLeft();if(E>this.offsetWidth*2/3){g.style.display="block"}else{if(E<this.offsetWidth*2/3){g.style.display="none";d.drawShape(this.toolName)}}};deCarta.IdManager.setTag(m,"ignoreForMapEvents");this.frame.appendChild(m);C();this.frame.appendChild(g)};function C(){g=document.createElement("DIV");g.className="decarta-drawingToolMenu";deCarta.IdManager.setTag(g,"ignoreForMapEvents");var F=document.createElement("DIV");F.innerHTML="Draw a circle";F.className="decarta-drawingToolMenuItemOff";F.onmouseover=function(){this.className="decarta-drawingToolMenuItemOn"};F.onmouseout=function(){this.className="decarta-drawingToolMenuItemOff"};F.onclick=function(){m.toolName="circle";d.drawShape("circle")};deCarta.IdManager.setTag(F,"ignoreForMapEvents");g.appendChild(F);var D=document.createElement("DIV");g.appendChild(D);D.className="decarta-drawingToolMenuItemOff";D.innerHTML="Draw a line";D.onmouseover=function(){this.className="decarta-drawingToolMenuItemOn"};D.onmouseout=function(){this.className="decarta-drawingToolMenuItemOff"};deCarta.IdManager.setTag(D,"ignoreForMapEvents");D.onclick=function(){m.toolName="line";d.drawShape("line")};var E=document.createElement("DIV");g.appendChild(E);E.innerHTML="Draw a polygon";E.className="decarta-drawingToolMenuItemOff";E.onmouseover=function(){this.className="decarta-drawingToolMenuItemOn"};E.onmouseout=function(){this.className="decarta-drawingToolMenuItemOff"};deCarta.IdManager.setTag(E,"ignoreForMapEvents");E.onclick=function(){m.toolName="poly";d.drawShape("poly")}}this.drawShape=function(D){if(D!="circle"&&D!="poly"&&D!="line"){throw new Exception("toolName should be circle or poly or line")}if(!l){z()}B(D)};function B(D){s(true);l=D;if(m){m.src=Credentials.imgPath+"draw-tool-"+l+"-selected.png"}if(r){r.src=Credentials.imgPath+"draw-tool-drag.png"}if(D=="circle"){u=new DDSCircle();u.setFillColor("(77.0.255)")}else{if(D=="line"){u=new DDSLine()}else{u=new DDSLine()}}u.addEventListener("onclick",w);h=new DDSLine();d.map.getTilesContainer().style.cursor="crosshair";EventRegistry.addListener(d.map,"moveend",function(){d.map.getTilesContainer().style.cursor="crosshair"});EventRegistry.addListener(d.map,"zoomend",function(){var F=y;for(var E=0;E<F.length;E++){F[E].setPosition(F[E].position)}});EventRegistry.addListener(d.map,"click",function(F){var G=new v(F);y.push(G);d.addSquarePinToMap(G);if(D=="circle"){if(!u.position){u.position=F;d.map.getTilesContainer().onmousemove=t}else{s();var E=Utilities.positions2Distance(u.position,F);u.setRadius(E);d.map.addOverlay(u);w(u)}}else{u.positions.push(F);if(u.positions.length==2){d.map.addOverlay(u)}if(u.positions.length>2){u.setPositions(u.positions)}d.map.getTilesContainer().onmousemove=t}})}function z(){b={};b.click=d.map.getEventListener("click");b.moveend=d.map.getEventListener("moveend");b.zoomend=d.map.getEventListener("zoomend")}function q(){for(var D in b){if(b[D]&&b.hasOwnProperty(D)){d.map.addEventListener(D,b[D])}else{if(b.hasOwnProperty(D)){d.map.clearListeners(D)}}}}function n(G){G=G?G:window.event;G.stoppropagation?G.stoppropagation():G.cancelBubble=true;var F=l;var H=this.squarePin;if(F=="circle"){s(true)}else{if(F=="line"){if(y.length==1){s(true)}else{var D=u.positions;if(this.squarePin==y[0]||H==y[y.length-1]){if(H==y[0]){D.push(H.position)}s();u.setPositions(D);w(u)}else{D.push(H.position);u.setPositions(D);var E=new v(H.position);y.push(E);d.addSquarePinToMap(E)}}}else{if(y.length==1){s(true)}else{D=u.positions;if(this.squarePin==y[0]||H==y[y.length-1]){s();u.type="polygon";u.setFillColor("(77.0.255)");u.setPositions(D);w(u)}else{D.push(H.position);u.setPositions(D);E=new v(H.position);y.push(E);d.addSquarePinToMap(E)}}}}}function o(){g.style.display="none"}function A(){g.style.display="none"}function t(K){K=K?K:window.event;if(!y.length){return}var E=new PixelPoint(K.clientX,K.clientY);var M=y[y.length-1].position;var D=d.map.screenPixToPos(E);var F=Utilities.radsPerPixelAtZoomLevel(d.map.getTileSize(),d.map.getZoomController().getZoomLevel());var N=D.lon-M.lon;if(N>180){N=N-360}else{if(N<-180){N=N+360}}var L=D.lat-M.lat;if(D.lat==90||D.lat==-90){return}var I=L/Math.cos(D.lat*Math.PI/180);var O=Math.atan2(I,N);var G=Math.sin(O)*F*180/Math.PI*Math.cos(D.lat*Math.PI/180);var H=Math.cos(O)*(F*180/Math.PI);if(h){d.map.removeOverlay(h)}if(Math.sqrt(N*N+I*I)<15*F*180/Math.PI){return}D=new Position(D.lat-5*G,D.lon-5*H);M=new Position(M.lat+10*G,M.lon+10*H);h=new DDSLine();h.setPositions([M,D]);d.map.addOverlay(h)}this.appendThis=function(){if(!this.frame){this.initialize()}var D=this.frame||null;return D};this.removeThis=function(){this.map=null;return this.frame};this.position=function(D){if(!this.map){return}if(this.frame){}};this.addSquarePinToMap=function(D){D.setPosition(D.position);d.map.getTileDiv().appendChild(D.frame)};this.removeSquarePinFromMap=function(D){if(!D||!D.frame){return}d.map.getTileDiv().removeChild(D.frame);D.frame=null};this.getSquarePins=function(){return y};function w(D){j(D)}function a(D){var F=D.map;var E=F.positionToMapLayerPixel(D.getPosition());F.getInfoWindow().setPosition(E.x,E.y);k(D);F.getInfoWindow().show(D)}function k(D){var F=c(D);var E=D.map;E.getInfoWindow().setContentSelectable(true);E.getInfoWindow().setContent(F)}function c(L){var D=L.map;var E=document.createElement("div");E.style.width="100%";E.style.height="100%";var F=document.createElement("div");var I=document.createElement("span");I.className="decarta-drawingToolInfoWin";I.innerHTML="Title      ";F.appendChild(I);var K=document.createElement("input");K.type="text";K.value=L?L.title:"";K.id="titleInput";K.size="20";F.appendChild(K);E.appendChild(F);var H=document.createElement("div");H.style.cssText="width:100%;height:100%;overflow:auto;";var G=document.createElement("div");G.className="decarta-drawingToolInfoWin";G.innerHTML="Description";H.appendChild(G);var O=document.createElement("textarea");O.value=L?L.description:"";H.appendChild(O);E.appendChild(H);var N=document.createElement("div");E.appendChild(N);var P=document.createElement("input");P.type="button";P.value="delete";P.onclick=function(){D.getInfoWindow().hide();D.removeOverlay(L)};N.appendChild(P);var M=document.createElement("input");M.type="button";M.value="save";M.onclick=function(){if(K.value){K.value=K.value.replace(/^\s*|\s*$/g,"")}L.setTitle((K.value)?(K.value):"");if(O.value){O.value=O.value.replace(/^\s*|\s*$/g,"")}L.setDescription((O.value)?(O.value):"");D.getInfoWindow().hide();L.customProperties.saved=true};N.appendChild(M);var Q=document.createElement("input");Q.type="button";Q.value="cancel";Q.onclick=function(){D.getInfoWindow().hide();if(L.customProperties.saved!=true){D.removeOverlay(L)}};N.appendChild(Q);return E}function v(D){this.position=D;this.frame=null;this.frame=document.createElement("DIV");this.frame.style.cssText="border:1px solid blue;background-color:white;opacity:50%;z-index:110;position:absolute;width:10px;height:10px;";this.frame.squarePin=this;this.frame.id="decarta_square_pin "+D.toString();var E=d.map.positionToMapLayerPixel(this.position);this.frame.style.left=E.x-5+"px";this.frame.style.top=E.y-5+"px";this.frame.onclick=n;this.setPosition=function(F){this.position=F;var G=d.map.positionToMapLayerPixel(this.position);this.frame.style.left=G.x-5+"px";this.frame.style.top=G.y-5+"px"};this.equals=function(F){if(this.position.equals(F.position)){return true}else{return false}}}function s(E){if(m){var F=m.src;F=F.replace(/-selected\.png$/,".png");m.src=F}if(r){r.src=Credentials.imgPath+"draw-tool-drag-selected.png"}if(g){g.style.display="none"}l=null;for(var D=0;D<y.length;D++){d.removeSquarePinFromMap(y[D])}if(h){d.map.removeOverlay(h)}d.map.getInfoWindow().hide();h=null;y=[];d.map.getTilesContainer().onmousemove=null;d.map.getTilesContainer().style.cursor="default";if(E){if(u&&u.customProperties.saved!=true){d.map.removeOverlay(u)}u=null}q()}this.getDefaultShapeClickHandler=function(){return a};this.setDomView=function(D){D=(D)?true:false;this.domView=D};this.show=function(){if(this.frame){this.frame.style.display="block"}};this.hide=function(){if(this.frame){this.frame.style.display="none"}}}deCarta.String={};deCarta.String.isString=function(a){if(typeof a==="string"||a instanceof String){return true}else{return false}};deCarta.String.trim=function(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")};deCarta.String.rtrim=function(a){return a.replace(/\s*$/,"")};deCarta.String.ltrim=function(a){return a.replace(/^\s*/,"")};deCarta.String.cleanUTF8=function(b){var a=decodeURIComponent(encodeURIComponent(b));return a};deCarta.StyleManager={};deCarta.StyleManager.stylesCreated=false;deCarta.StyleManager.cssString=".decarta-close{position:absolute; width:20px; height:20px; top:2px; left:178px; display:block; cursor:pointer;}.decarta-bubbleContent{padding:16px;}.decarta-bubble{display:none; width:200px; background-color:#ffffff; filter:alpha(opacity=100); opacity:1; border: 1px solid #cccccc; position:absolute; z-index:10000; color:#000000; font-size:11px;}.decarta-copyright{background-color:#ffffff; opacity:50; filter:alpha(opacity=80); opacity:0.8; padding:1px; font-family:arial; color:#000000; font-size:11px; border:1px solid #cccccc; display:block; position:absolute; z-index:9999;}.decarta-mapTypeController{background-color:#ffffff; opacity:50; filter:alpha(opacity=80); opacity:0.8; padding:3px; font-family:Arial; color:#000000; font-size:11px; font-weight:bold; border:1px solid #cccccc; display:block; position:absolute; height:14px;width:154px; visibility:visible; z-index:9999;}.decarta-mapTypeControllerLink{text-decoration:none;}.decarta-zoomButton{padding:0; margin:0; display:block;}.decarta-zoom{cursor: pointer; width: 20px; height:278px;top: 10px; left: 10px; position: absolute; z-index: 9999;}.decarta-zoomTop{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:0px;height:20px;}.decarta-zoomPillar{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:20px;height:170px;}.decarta-zoomBottom{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:190px;height:20px;}.decarta-zoomSlider{maring:0px;padding:0px;position:absolute;left:0px;width:20px;height:10px;}.decarta-drawingToolMenu{position:absolute;left:31px;top:31px;width:120px;background-color:white;display:none;}.decarta-drawingToolMenuItemOn{padding:3px;background-color:#bbb;color:#000;font-size:11px;font-family:arial}.decarta-drawingToolMenuItemOff{padding:3px;background-color:#fff;color:#888;font-size:11px;font-family:arial}.decarta-drawingToolInfoWin{padding:3px;background-color:#fff;color:#888;font-size:11px;font-family:arial}.decarta-scaleBar{position:absolute; width:120px; text-align:left; z-index:9999;}.decarta-scaleBarMeasure{font-family:arial; font-size:8pt; padding:0px 0px 0px 3px; margin:0;}.decarta-scaleBarImperialScale{display:block; padding:0; margin:0; font-size:6px; height:6px; border-left:2px solid #000; border-right:2px solid #000; border-bottom:1px solid #000;}.decarta-scaleBarMetricScale{display:block; padding:0; margin:0; font-size:6px; height:6px; border-left:2px solid #000; border-right:2px solid #000; border-top:1px solid #000;}.decarta-mapviewport{position:relative; z-index:0; overflow:hidden;}.decarta-tiles{position:absolute; left:0px; top:0px; z-index:0;}.decarta-maptile{z-index:0; position:absolute; display:none;}.decarta-bbox-div{border:4px solid #999;position:absolute}.decarta-panController{z-index:100; position:absolute; top:1px; left:1px; height:60px; width:60px; padding:0px; margin:0px; }.decarta-panController-north{position:absolute; top:0px; left:20px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-south{position:absolute; top:40px; left:20px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-east{position:absolute; top:20px; left:40px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-west{position:absolute; top:20px; left:0px; height:20px; width:20px; padding:0px; margin:0px;cursor: pointer; }.decarta-panController-center{position:absolute; top:20px; left:20px; height:20px; width:20px; padding:0px; margin:0px;cursor: pointer; }.decarta-mapOverviewController-mapArrayDivWin{position:absolute;border: 1px solid blue;background-color: rgb(102, 102, 204); opacity: 0.4;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=40)';filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=40);z-index:10020;}.decarta-mapOverviewController-mapDivWin{position:absolute;border: 1px solid blue;background-color: rgb(102, 102, 204); opacity: 0.4;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=40)';filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=40);z-index:10021;}.decarta-mapOverviewController-mapDiv{position:absolute;left:0px;top:0px;overflow:hidden;}.decarta-mapOverviewController-frame{position:absolute;right:0px;bottom:0px;width:17px;height:17px;z-index:10010;background-color:gray;}.decarta-mapOverviewController-mapToggle{position: absolute; right: 0px; bottom: 0px; width: 17px; height: 17px;z-index:10020;}.decarta-mapOverviewController-mapToggleImg{position:absolute;left:0px;top:0px;width:17px;height:17px;}.decarta-mapOverviewController-mapDivWrapper{position:absolute;left:5px;top:5px;overflow:hidden;}.decarta-mapOverviewController-mapArrayDiv{position:absolute; left:0px; top:0px;}";deCarta.StyleManager.init=function(){if(deCarta.StyleManager.stylesCreated){return}if(document.styleSheets[0]&&document.styleSheets[0].cssText){document.styleSheets[0].cssText+=deCarta.StyleManager.cssString}else{var a=document.createElement("style");a.appendChild(document.createTextNode(deCarta.StyleManager.cssString));document.getElementsByTagName("head")[0].appendChild(a)}deCarta.StyleManager.stylesCreated=true};deCarta.StyleManager.getCurrentStyle=function(b,a){var c=b.style[d(a)];if(!c){if(document.defaultView){c=document.defaultView.getComputedStyle(b,"").getPropertyValue(a)}else{if(b.currentStyle){c=b.currentStyle[d(a)]}}}return c;function d(f){for(var g=/-([a-z])/;g.test(f);f=f.replace(g,RegExp.$1.toUpperCase())){}return f}};function TextOverlay(g,b,h,c,d,a,f){this.text=g||"";this.anchorX=b||0;this.anchorY=h||0;this.color=c||null;this.size=d||null;this.fontFamily=a||null;this.className=f||null;this.toString=function(){return this.text+" "+this.anchorX+" "+this.anchorY+" "+this.size+" "+this.fontFamily+" "+this.className}}TextOverlay.prototype.getAnchorX=function(){return this.anchorX};TextOverlay.prototype.getAnchorY=function(){return this.anchorY};TextOverlay.prototype.getText=function(){return this.text};TextOverlay.prototype.getClassName=function(){return this.className};TextOverlay.prototype.getColor=function(){return this.color};TextOverlay.prototype.getSize=function(){return this.size};TextOverlay.prototype.getFontFamily=function(){return this.fontFamily};TextOverlay.prototype.setAnchorX=function(a){this.anchorX=a};TextOverlay.prototype.setAnchorY=function(a){this.anchorY=a};TextOverlay.prototype.setText=function(a){this.text=a};TextOverlay.prototype.setClassName=function(a){this.className=a};TextOverlay.prototype.setColor=function(a){this.color=a};TextOverlay.prototype.setSize=function(a){this.size=a};TextOverlay.prototype.setFontFamily=function(a){this.fontFamily=a};function TrafficIncident(a,c,b){this.position=a;this.description=c||"";this.severity=b||"";this.toString=function(){return this.position+"  "+this.description}}function TrafficIncidentQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var c=null;var b=[];var a=this;this.authenticate=function(f,d){if(!f||!d){throw new Exception("Error authenticating TrafficIncidentQuery, invalid parameters.")}Credentials.clientName=f;Credentials.clientPassword=d;this.xmlRecFac.clientName=f;this.xmlRecFac.clientPassword=d};this.query=function(f,h,d){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("TrafficIncidentQuery.query: callBack must be a function, arg was: "+h)}c=this.xmlRecFac.createTrafficIncidentRequest(f,g);JSRequest.send(c,a.queryCallback,null,d)};this.queryCallback=function(j){var d=[];var h=j.XLS.Response.requestID;if(deCarta.JSONParser.parseErrors(j)){}else{var g=j.XLS.Response.TrafficResponse.Incident;var l=g.length;if(!l){d.push(new TrafficIncident(new Position(g.Position),g.Description,g.severity))}else{for(var f=0;f<g.length;f++){var k=g[f];d.push(new TrafficIncident(new Position(k.Position),k.Description,k.severity))}}}if((h>=0)&&b[h]){b[h](d);b[h]=undefined}}}function TrafficIncidentSearchCriteria(b,a,c,d){if(c>100){throw new Exception("maximumResponses cannot exceed 100")}this.position=b.clone();this.radius=a;this.maximumResponses=c;this.minimumSeverity=d}function UOM(a){if(a!="KM"&&a!="M"&&a!="MI"&&a!="FT"){throw new Exception("invalid UOM type,  KM M MI FT")}this.value=a;this.toString=function(){return this.value}}function Utilities(){}Utilities.EARTH_RADIUS_METERS=6371000;Utilities.regx2=new RegExp("\\s","g");Utilities.parseRequestIDFromXLS=function(b){var a=/requestID=[\'\"]([0-9]+)/;var d=a.exec(b);var c=null;if(d&&d[1]){c=d[1]}return c};Utilities.isObjectEmpty=function(c){var a=true;for(var b in c){if(c.hasOwnProperty(b)){a=false;break}}return a};Utilities.parseKML=function(k){var b=new RegExp("&","g");k=k.replace(b," ");b=new RegExp("<kml xmlns=");k=k.replace(b,"<kml xmlns:goog=");var c=[];var m=(new DOMParser()).parseFromString(k,"text/xml");m.setProperty("SelectionLanguage","XPath");m.setProperty("SelectionNamespaces","xmlns:goog='http://earth.google.com/kml/2.2' xmlns:atom='http://www.w3.org/2005/Atom'");var f=m.selectNodes("//Placemark");for(var d=0;d<f.length;d++){var a;var h;var l;for(var p=0;p<f[d].childNodes.length;p++){try{if(f[d].childNodes[p].nodeName=="name"){a=Sarissa.getText(f[d].childNodes[p])||""}if(f[d].childNodes[p].nodeName=="description"){h=Sarissa.getText(f[d].childNodes[p])||""}if(f[d].childNodes[p].nodeName=="Point"){var o=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("Point",o[0])}if(f[d].childNodes[p].nodeName=="Polygon"){var n=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("Polygon",n)}if(f[d].childNodes[p].nodeName=="LineString"){var q=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("LineString",q)}if(f[d].childNodes[p].nodeName=="MultiGeometry"){var g=Utilities.parseKMLMultiGeometry(f[d].childNodes[p].childNodes);l=new KMLGeometry("MultiGeometry",g)}}catch(j){continue}}if(l){c.push(new KML(l,a,h));l=undefined;a="";h=""}else{}}return c};Utilities.parseKMLMultiGeometry=function(f){var a=[];for(var b=0;b<f.length;b++){var c=f[b].nodeName;var d=Utilities.parseKMLCoords(f[b].childNodes);a.push(new KMLGeometry(c,d))}return a};Utilities.parseKMLCoords=function(d){var b=[];var a;c(d);function c(m){for(var h=0;h<m.length;h++){if(m[h].nodeName=="coordinates"){var g=Sarissa.getText(m[h]);var g=g.replace(Utilities.regx2,",");var j=g.split(",");var f=0;var k,l;for(var h=0;h<j.length;h++){if(f==0){l=j[h];f++;continue}else{if(f==1){k=j[h];b.push(new Position(k,l));f++;continue}else{if(f==2){f=0;continue}}}}a=b;break}else{if(m[h].childNodes.length){c(m[h].childNodes)}}}}return a};Utilities.getElementByTagName=function(j,h,a){var c=h+":"+a;var g;if(navigator.userAgent.toLowerCase().indexOf("safari")>-1){g=j.getElementsByTagNameNS("*",a)[0];if(!g){var b=j.getElementsByTagName("*");var f=b.length;for(var d=0;d<f;d++){if(b[d].nodeName==c){g=b[d];break}}}}else{g=j.getElementsByTagName(c)[0]}return g};Utilities.px="px";Utilities.LL2VR7=function(b){var g=b[0];var h=10000000;var a=(b.length)+","+(b[0].lat*h)+","+(b[0].lon*h);for(var f=1;f<b.length;f++){var d=Math.round((b[f].lat-g.lat)*h);var c=Math.round((b[f].lon-g.lon)*h);g=b[f];a+=","+d+","+c}return a};Utilities.timer=function(){this.green=null;this.red=null;this.start=function(){this.green=new Date().getTime()};this.stop=function(){this.red=new Date().getTime();return this.red-this.green}};Utilities.ie="\v"=="v";Utilities.ie6=(document.all&&!window.opera&&(typeof document.documentElement.style.maxHeight=="undefined"))?true:false;Utilities.fixPng=function(a){if(a.src){var b=a.src;if(a.style.height&&a.style.width){a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"', sizingMethod='scale')"}else{a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"')"}a.src=Credentials.transparentGIF}else{if(a.style.backgroundImage){var b=a.style.backgroundImage.replace("url(","src='");b=b.replace(")","'");a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader ("+b+"')";a.style.backgroundImage=""}}};Utilities.getScrollTop=function(){var a=0;if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body&&document.body.scrollTop){a=document.body.scrollTop}}return parseInt(a)};Utilities.getScrollLeft=function(){var a=0;if(document.documentElement&&document.documentElement.scrollLeft){a=document.documentElement.scrollLeft}else{if(document.body&&document.body.scrollLeft){a=document.body.scrollLeft}}return parseInt(a)};Utilities.podParse=function(b){var f=parseInt(b.substring(b.indexOf("P")+1,b.indexOf("D")));var a=parseInt(b.substring(b.indexOf("T")+1,b.indexOf("H")));var c=parseInt(b.substring(b.indexOf("H")+1,b.indexOf("M")));var d=parseInt(b.substring(b.indexOf("M")+1,b.indexOf("S")));if(f>0){return((f*24)+a)+" hours "+c+" minutes "}else{if(a>0){return a+" hours "+c+" minutes "}else{if(c>0){return c+" minutes "+d+" seconds "}else{return d+" seconds"}}}};Utilities.podParseJSON=function(b){var g=parseInt(b.substring(b.indexOf("P")+1,b.indexOf("D")));var f=parseInt(b.substring(b.indexOf("T")+1,b.indexOf("H")));var a=parseInt(b.substring(b.indexOf("H")+1,b.indexOf("M")));var c=parseInt(b.substring(b.indexOf("M")+1,b.indexOf("S")));return{days:g,hours:f,minutes:a,seconds:c}};Utilities.htmlizeXMLDom=function(c){var b=new RegExp("\\>","g");var a=new RegExp("\\<","g");var d=(Sarissa.serialize(c));d=d.replace(b,"&gt;");d=d.replace(a,"&lt;");return"<PRE>"+d+"</PRE>"};Utilities.p=function(a){};Utilities.c=function(){};Utilities.generalize=function(l,r,j,q){j=Math.round(j/2);var c=r.getZoomLevel?r.getZoomLevel():r;var d=Utilities.radsPerPixelAtZoomLevel(q,c);var k=l.length;var b=[];var p,h,n,m,a,o,g;for(var f=0;f<k;f++){if(f==0||!p.contains(l[f])){h=Utilities.lat2pix(l[f].lat,d)+j;n=Utilities.lon2pix(l[f].lon,d)+j;m=Utilities.lat2pix(l[f].lat,d)-j;a=Utilities.lon2pix(l[f].lon,d)-j;o=Utilities.pix2lat(h,d)+" "+Utilities.pix2lon(n,d);g=Utilities.pix2lat(m,d)+" "+Utilities.pix2lon(a,d);p=new BoundingBox(new Position(g),new Position(o));b.push(l[f]);continue}}return b};Utilities.grouper=function(v,b,h,k){if(!v||!b||h<=0){throw new Exception("Utilities.grouper: Invalid input posArray: "+v+" zoom: "+b+" radius: "+h)}var n=b.getZoomLevel?b.getZoomLevel():b;var t=Utilities.radsPerPixelAtZoomLevel(k,n);var l=v.length;var c,w,o,a,r,s,u;var m=[];var f=[];var d=0;var q,p;var g=[];for(q=0;q<l;q++){for(p=0;p<d;p++){if(m[p].contains(v[q])){g[p].push(v[q]);break}}if(p!=d){continue}else{w=Utilities.lat2pix(v[q].lat,t)+h;o=Utilities.lon2pix(v[q].lon,t)+h;a=Utilities.lat2pix(v[q].lat,t)-h;r=Utilities.lon2pix(v[q].lon,t)-h;s=Utilities.pix2lat(w,t)+" "+Utilities.pix2lon(o,t);u=Utilities.pix2lat(a,t)+" "+Utilities.pix2lon(r,t);c=new BoundingBox(new Position(u),new Position(s));m[d]=c;f[d]=v[q];g[d]=[];d++;continue}}for(q=0;q<d;q++){g[q].push(f[q])}return g};Utilities.groupObjByPosition=function(c,o,h,n){var g,d;var b,m;var l=[];var a="gTag";var k;var f;if(!c||!c[0].position||!o||h<=0||!n||Position.prototype[a]){throw new Exception("Utilities.groupObjByPosition: Invalid input objArray: "+c+" zoom: "+o+" radius: "+h+" tileSize: "+n)}b=c.length;for(g=0;g<b;g++){l[g]=c[g].position.clone();l[g][a]=c[g]}k=Utilities.grouper(l,o,h,n);f=[];b=k.length;for(g=0;g<b;g++){f[g]=[];m=k[g].length;for(d=0;d<m;d++){f[g][d]=k[g][d][a]}}return f};Utilities.getRequestId=function(){return Math.floor(Math.random()*10000000)};Utilities.getAbsoluteLeft=function(c){var b=c.offsetLeft;var a=c.offsetParent;while(a!=null){b+=a.offsetLeft;a=a.offsetParent}return b};Utilities.getAbsoluteTop=function(c){var b=c.offsetTop;var a=c.offsetParent;while(a!=null){b+=a.offsetTop;a=a.offsetParent}return b};Utilities.unloadMap=function(a){a.removeAllPins();Utilities.purge(a.mapDiv)};Utilities.purge=function(g){var c=g.attributes,f,b,h;if(c){b=c.length;for(f=0;f<b;f+=1){h=c[f].name;if(typeof g[h]==="function"){g[h]=null}}}c=g.childNodes;if(c){b=c.length;for(f=0;f<b;f+=1){Utilities.purge(g.childNodes[f])}}};Utilities.what=function(c){var b="";for(var a in c){b+="  "+a}alert(b)};Utilities.normalizePrefixes=function(k){var f=new RegExp("ns1:","g");var j=k.replace(f,"xls:");var d=new RegExp("ns\\d+:","g");var h=j.replace(d,"gml:");var b=new RegExp('\\sxmlns:ns\\d+="http://www.opengis.net/gml"',"g");var g=h.replace(b,"");var a=new RegExp('xmlns:ns1="http://www.opengis.net/xls"',"g");var c=g.replace(a,'xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml"');return c};Utilities.centerContextToBoundingBox=function(h,g){var a=g/111.111;var f=g/111.111/Math.cos(((h.lat*Math.PI)/180));var j=(h.lon-parseFloat(f));var k=(h.lon+parseFloat(f));var b=a;var c=(h.lat-parseFloat(b));var d=(h.lat+parseFloat(b));return new BoundingBox(new Position(c,j),new Position(d,k))};Utilities.centerContextToBoundingBoxViewable=function(j,b,a){var d=b/111.111;var c=a/111.111;var k=(j.lon-parseFloat(d));var l=(j.lon+parseFloat(d));var h=c*Math.cos(((j.lat*Math.PI)/180));var f=(j.lat-parseFloat(h));var g=(j.lat+parseFloat(h));return new BoundingBox(new Position(f,k),new Position(g,l))};Utilities.latLonToPixels=function(c,f,d){var b=d*((f.lon-c.minPosition.lon)/(c.maxPosition.lon-c.minPosition.lon));var a=d*((c.maxPosition.lat-f.lat)/(c.maxPosition.lat-c.minPosition.lat));return new PixelPoint(Math.round(b),Math.round(a))};Utilities.formatRadiusToString=function(a){if(typeof a=="number"||typeof a!="string"){a=a.toString()}return a.replace(new RegExp(","),".")};Utilities.pixelsToLatLon=function(n,m,j,f,a,b,p,k){try{n=j-n;m=f-m;var o=p.getLat();var h=p.getLon();var g=(k*2)/111.111;var c=g/(a*b);var d=(g/Math.cos(((o*Math.PI)/180)))/(a*b);if(m!=0){o=""+(parseFloat(o)+parseFloat(m*c))}if(n!=0){h=""+(parseFloat(h)-parseFloat(n*d))}return new Position(o,h)}catch(l){throw new Exception(l.message)}};Utilities.positionsToBoundingBoxLonSpanIndexes=function(f){if(!f||f.length<2){throw new Exception("Utilities.positionsToBoundingBox requires at least two positions")}var o=[];o=f.slice(0);d(o);var b=o.length;var a=360;var h=0;var l=b-1;for(var c=0;c<b;c++){l=(b+(c-1)%b)%b;var k=m(o[c].lon,o[l].lon);if(k<a){a=k;h=c}}l=(b+(h-1)%b)%b;var n,g;for(i=0;i<f.length;i++){if(f[i]==o[h]){n=i;break}}for(i=0;i<f.length;i++){if(f[i]==o[l]){g=i;break}}return[n,g];function m(p,j){if(p<j){return j-p}else{return j+360-p}}function d(p){var r=Math.floor((p.length-1-1)/2);for(;r>=0;r--){j(r,p.length-1)}for(r=p.length-1;r>0;r--){var q=p[0];p[0]=p[r];p[r]=q;j(0,r-1)}function j(w,s){var u=w;var v=w*2+1;var t;while(v<=s){if(v<s&&p[v].lon<p[v+1].lon){v=v+1}if(p[u].lon>p[v].lon){break}else{t=p[u];p[u]=p[v];p[v]=t;u=v;v=u*2+1}}}}};Utilities.positionsToBoundingBox=function(b){if(!b||b.length<1){throw new Exception("Utilities.positionsToBoundingBox requires at least one position")}if(b.length==1){return new BoundingBox(b[0],b[0])}var f=Utilities.positionsToBoundingBoxLonSpanIndexes(b);var a=b[f[0]].lon;var h=b[f[1]].lon;var g=90;var d=-90;for(var c=0;c<b.length;c++){if(b[c].lat<g){g=b[c].lat}if(b[c].lat>d){d=b[c].lat}}return new BoundingBox(new Position(g,a),new Position(d,h))};Utilities.pinsToBoundingBox=function(g,d){if(!d){throw new Exception("Utilities.pinsToBoundingBox requires a scale argument")}if(!g||g.length<2){throw new Exception("Utilities.pinsToBoundingBox requires at least two pins")}var n=[];for(var k=0;k<g.length;k++){n[k]=g[k].getPosition()}var b=Utilities.positionsToBoundingBoxLonSpanIndexes(n);var a=g[b[0]].getViewableBoundingBox(d);var l=a.minPosition.lon;var h=g[b[1]].getViewableBoundingBox(d);var m=h.maxPosition.lon;var f=90;var j=-90;for(k=0;k<g.length;k++){var c=g[k].getViewableBoundingBox(d);if(c.minPosition.lat<f){f=c.minPosition.lat}if(c.maxPosition.lat>j){j=c.maxPosition.lat}}return new BoundingBox(new Position(f,l),new Position(j,m))};Utilities.pixYDist=function(j,g,c,d){if(!d){d=GLOBALS.DEFAULT_MAP_TILE_SIZE}var b=c.getGXConvertedZoomLevel();var a=Utilities.radsPerPixelAtZoom(d,b);var h=Math.round(Utilities.lat2pix(j,a));var f=Math.round(Utilities.lat2pix(g,a));return Math.abs(h-f)};Utilities.pixXDist=function(g,d,c,f){if(!f){f=GLOBALS.DEFAULT_MAP_TILE_SIZE}var b=c.getGXConvertedZoomLevel();var a=Utilities.radsPerPixelAtZoom(f,b);var j=Math.round(Utilities.lon2pix(g,a));var h=Math.round(Utilities.lon2pix(d,a));return Math.abs(j-h)};Utilities.lat2pix=function(d,g){var f=(parseFloat(d)*(2*Math.PI))/360;var b=0.08181919084262157;var a=Math.sin(f);var h=b*a;var c=Math.log(((1+a)/(1-a))*Math.pow((1-h)/(1+h),b))/2;return(c/g)};Utilities.lon2pix=function(b,a){return((b/180)*Math.PI)/a};Utilities.radsPerPixelAtZoom=function(b,a){return 2*Math.PI/(b<<a)};Utilities.radsPerPixelAtZoomLevel=function(b,c){var a=Math.abs(21-c);return 2*Math.PI/(b<<a)};Utilities.deCartaToGXZoomLevel=function(b){var a=Math.abs(21-parseInt(b,10));return a};Utilities.pix2lon=function(a,b){return(a*b)*180/Math.PI};Utilities.pix2lat=function(j,g){var h=1e-7;var f=12;var b=Math.pow(Math.E,-j*g);var d=Utilities.mercatorUnproject(b);var a=Utilities.findRadPhi(d,b);var c=0;while(c<f&&Math.abs(d-a)>h){d=a;a=Utilities.findRadPhi(d,b);c++}return a*180/Math.PI};Utilities.mercatorUnproject=function(a){return(Math.PI/2)-2*Math.atan(a)};Utilities.findRadPhi=function(c,b){var a=0.08181919084262157;var d=a*Math.sin(c);return(Math.PI/2)-(2*Math.atan(b*Math.pow((1-d)/(1+d),a/2)))};Utilities.generalizationFactor=function(f,d){if(!f||!d||!f.minPosition){throw new Exception("Utilities.generalizationFactor: bad input.bbox: "+f+"zoomLevel: "+d)}var c=[0.14916746,0.298780196,0.597003797,1.19445287,2.388571783,4.777143566,9.554287132,19.10857426,38.21725985,76.43440838,152.8688168,305.7376335,611.475267,1222.950534,2445.901068,4891.802136,9783.604272,19567.20854,39134.41709,78268.83418,156537.6684,313075.3367];var b=f.minPosition.lat*Math.PI/180;var a=c[d-1];return(a*Math.cos(b))};Utilities.setUnselectable=function(a){if(a){if(typeof a.onselectstart!="undefined"){a.onselectstart=function(c){c=c||event;var b=c.target||c.srcElement;if(b=="[object Text]"&&b.parentNode){b=b.parentNode}if(!deCarta.IdManager.checkTag(b,"txtSelectable")){return false}else{return true}}}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="-moz-none"}else{}}}};Utilities.setSelectable=function(a){if(a){if(typeof a.onselectstart!="undefined"){deCarta.IdManager.setTag(a,"txtSelectable")}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="text"}else{}}}};Utilities.vrToPositions=function(d){if(!d){throw new Exception("vrToPositions: illegal argument: "+d)}var h=d.replace(/%[Vv][Rr]=/,"").split(",");var k=h[0]-1;var a=g(h[1]);var f=g(h[2]);var b=h.slice(3);var l=[];l.push(new Position(a,f));var c;for(c=0;c<k;c++){a+=g(b[0]);f+=g(b[1]);b=b.slice(2);var j=new Position(a,f);l.push(j)}return l;function g(r){var o;var m="";if(r.toString().charAt(0)=="-"){m="-";r=r.slice(1)}r=r.toString();var q=r.length;var p;if(q<=5&&q>0){p=["0","0","0","0","0"];var n=5;for(o=1;o<=q;o++){p[n-o]=r.charAt(q-o)}return(parseFloat(parseFloat(m+"0."+p.join("")).toFixed(5)))}else{if(q>5){p=[];for(o=0;o<q;o++){p.push(r.charAt(o));if(q-o-1==5){p.push(".")}}return(parseFloat(parseFloat(m+p.join("")).toFixed(5)))}else{throw new Exception("vrToPositions failed in vrOffsetToFloat with "+r)}}}};Utilities.vr7ToPositions=function(d){if(!d){throw new Exception("vr7ToPositions: illegal argument: "+d)}var g=d.replace(/%[Vv][Rr]7=/,"").split(",");var k=g[0]-1;var a=h(g[1]);var f=h(g[2]);var b=g.slice(3);var l=[];l.push(new Position(a,f));var c;for(c=0;c<k;c++){a+=h(b[0]);f+=h(b[1]);b=b.slice(2);var j=new Position(a,f);l.push(j)}return l;function h(r){var o;var m="";if(r.toString().charAt(0)=="-"){m="-";r=r.slice(1)}r=r.toString();var q=r.length;var p;if(q<=7&&q>0){p=["0","0","0","0","0","0","0"];var n=7;for(o=1;o<=q;o++){p[n-o]=r.charAt(q-o)}return parseFloat(parseFloat(m+"0."+p.join("")).toFixed(7))}else{if(q>7){p=[];for(o=0;o<q;o++){p.push(r.charAt(o));if(q-o-1==7){p.push(".")}}return parseFloat(parseFloat(m+p.join("")).toFixed(7))}else{throw new Exception("vrToPositions failed in vrOffsetToFloat with "+r)}}}};Utilities.positionsToVr=function(f){if(!f&&!f.length){throw new Exception("positionsToVr: cannot create empty VR string.")}var d;var c=f.length;var g=[];g.push("%VR="+c);g.push(k(f[0].lat));g.push(k(f[0].lon));var j=f[0].lat;var a=f[0].lon;for(d=1;d<c;d++){var b=f[d].lat-j;g.push(k(b));j+=b;var h=f[d].lon-a;g.push(k(h));a+=h}return g.join(",");function k(m){var l=parseFloat(parseFloat(m).toFixed(5).toString().replace(/\./,""));return l}};Utilities.positionsToVr7=function(g){if(!g&&!g.length){throw new Exception("positionsToVr7: cannot create empty VR string.")}var f;var d=g.length;var h=[];h.push("%VR7="+d);h.push(b(g[0].lat));h.push(b(g[0].lon));var k=g[0].lat;var a=g[0].lon;for(f=1;f<d;f++){var c=g[f].lat-k;h.push(b(c));k+=c;var j=g[f].lon-a;h.push(b(j));a+=j}return h.join(",");function b(m){var l=parseFloat(parseFloat(m).toFixed(7).toString().replace(/\./,""));return l}};Utilities.positions2Distance=function(g,f){var h=g.lat*Math.PI/180;var c=f.lat*Math.PI/180;var b=g.lon*Math.PI/180;var k=f.lon*Math.PI/180;var a=6366.191;var j=a*Math.acos(Math.cos(h)*Math.cos(c)*Math.cos(b-k)+Math.sin(h)*Math.sin(c));return new Radius(j,new UOM("KM"))};Utilities.positionsAngle=function(h,f,k){if(!k){k=256}var d=Utilities.radsPerPixelAtZoom(k,21);var b=Utilities.lon2pix(h.lon,d);var j=Utilities.lat2pix(h.lat,d);var a=Utilities.lon2pix(f.lon,d);var g=Utilities.lat2pix(f.lat,d);var c=Math.atan2(g-j,a-b)*180/Math.PI;return c};Utilities.setOpacity=function(d,c){var b=(c/100);var a=d.style;a.opacity=b;a.MozOpacity=(c/100);a.KhtmlOpacity=(c/100);a.filter="alpha(opacity="+c+")";return true};Utilities.extend=function(c,b){for(var a in b){if(typeof c[a]=="Array"||typeof c[a]=="Object"){c[a]=Utilities.extend(c[a],b[a])}c[a]=b[a]}return c};Utilities.fade=function(d,k){var b={from:100,to:0,duration:500,fps:10};b=Utilities.extend(b,k);var f=b.from;Utilities.setOpacity(d,f);var a=1000/b.fps;var g=Math.floor(b.duration/a);var j=(b.to-b.from)/g;var c=0;function h(m,l,n){n++;if(g==n){Utilities.setOpacity(m,b.to);if(typeof b.onComplete==="function"){b.onComplete(m)}}else{l+=j;Utilities.setOpacity(m,l);setTimeout(function(){h(m,l,n)},a)}}h(d,f,c)};Utilities.setStyle=function(a,b){var d=a.style;d.display="none";for(var c in b){if(c=="opacity"){a.setOpacity(b[c])}else{d[(c=="float"||c=="cssFloat")?(Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat"):c]=b[c]}}d.display="block";return a};Utilities.scope=function(c,b){var d=Array.prototype.slice;function h(m,j){var l=m.length,k=j.length;while(k--){m[l+k]=j[k]}return m}function g(k,j){k=d.call(k,0);return h(k,j)}if(arguments.length<2&&(typeof arguments[0]==="Undefined")){return c}var f=c;var a=d.call(arguments,1);return function(){var j=g(a,arguments);return f.apply(b,j)}};Utilities.urlParse=function(f){var a={};var d=f.split("?");a.baseUrl=d[0];a.queryParameters={};var b=d[1].split("&");var h={};for(var c=0;c<b.length;c++){var g=b[c].split("=");h[g[0]]=g[1]}a.queryParameters=h;return a};Utilities.urlCompose=function(a){var f=a.baseUrl+"?";var d=true;var c=a.queryParameters;for(var b in c){if(!d){f+="&"}else{d=false}f+=b+"="+c[b]}return f};Utilities.removeElementToReinsert=function(b){var a=b.parentNode;var c=b.nextSibling;a.removeChild(b);return function(){if(c){a.insertBefore(b,c)}else{a.appendChild(b)}}};Utilities.geolocateConvertPosition=function(a){a=a.coords||a;var b=new Position(a.latitude+" "+a.longitude);return b};Utilities.geolocate=function(a,b){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a,b)}else{if(window.google&&google.gears){var c=google.gears.factory.create("beta.geolocation");if((c)&&(c.getPermission())){c.getCurrentPosition(a,b)}}}};function WSXMLTunnel(){var a=this;this.responseFormat="XML";var b=[];this.send=function(c,f){if(!deCarta.String.isString(c)){if(!window.Sarissa&&!window.Sarissa.serialize){throw new Exception("Sarissa is required to use the WSXMLTunnel with XMLDocument Objects.")}c=Sarissa.serialize(c)}var d=Utilities.parseRequestIDFromXLS(c);if(typeof f=="function"){b[d]=f}else{throw new Exception("WSXMLTunnel.send: callBack must be a function, arg was: "+f)}JSRequest.send(c,this._callBack,this.responseFormat)};this._callBack=function(c){var d,f;if(a.responseFormat=="XML"){d=Sarissa.getDomDocument();d=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(c),"text/xml");d.setProperty("SelectionLanguage","XPath");d.setProperty("SelectionNamespaces","xmlns:xls='http://www.opengis.net/xls' xmlns:gml='http://www.opengis.net/gml'");f=(d.selectSingleNode("//xls:Response/@requestID").value)}else{d=c;if(deCarta.Array.isArray(d.XLS.Response)){f=d.XLS.Response[0].requestID}else{f=d.XLS.Response.requestID}}b[f](d)}}deCarta.XMLStringBuilder=function(){this.overlays=[];this.routeIDOverlay=null;this.rendering="server";this.routeID=null;this.clientName=Credentials.clientName;this.clientPassword=Credentials.clientPassword;this.configuration=Credentials.configuration;this.transparentConfiguration=Credentials.transparentConfiguration;this.mapType=GLOBALS.STREET;this.streetImgFormat="PNG";this.hybridImgFormat="PNG"};deCarta.XMLStringBuilder.prototype.getRequestHeader=function(a,b){a=a||Utilities.getRequestId();var c="<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls'";if(Credentials.rel){c+=" rel='"+Credentials.rel+"' "}c+="xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='"+this.clientName+"' sessionID='"+a+"' clientPassword='"+this.clientPassword+"' configuration='";if(this.mapType=="STREET"){c+=this.configuration+"'"}else{c+=this.transparentConfiguration+"'"}if(b){c+=" defaultUOM='"+b+"' "}c+="/>";return c};deCarta.XMLStringBuilder.prototype.getRequestOpen=function(a,c,b){b=b||"10";c=c||Utilities.getRequestId();var d="<xls:Request maximumResponses='"+b+"' version='1.0' requestID='"+c+"' methodName='"+a+"'>";return d};deCarta.XMLStringBuilder.prototype.getHeader=function(a,c,b,d,f){var g=this.getRequestHeader(d,f);g+=this.getRequestOpen(a,c,b);return g};deCarta.XMLStringBuilder.prototype.getFooter=function(){return"</xls:Request></xls:XLS>"};deCarta.XMLStringBuilder.prototype.createRUOKRequest=function(b){var a=this.getHeader("RuokRequest",b,25,Utilities.getRequestId());a+="<xls:RUOKRequest />"+this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createMapRequest=function(g,k,b,j,c,h,d){var a=this.overlaysToXLSString();if(!a[1]&&!Credentials.trafficEnabled){d=GLOBALS.TILE_SESSION_ID}var f=this.getHeader("PortrayMapRequest",b,null,d);f+="<xls:PortrayMapRequest><xls:Output height='"+k+"' width='"+k+"' ";f+="format='"+(this.mapType=="STREET"?this.streetImgFormat:this.hybridImgFormat)+"' fixedgrid='true' useCache='true'><xls:CenterContext SRS='WGS-84'><xls:CenterPoint><gml:pos>"+g.toString()+"</gml:pos></xls:CenterPoint><xls:Radius unit='KM'>4</xls:Radius></xls:CenterContext><xls:TileGrid rows='1' columns='1'><xls:GridLayer name='deCarta'/><xls:GridLayer name='globexplorer' meta-inf='zoom=";if(!c){f+=Utilities.deCartaToGXZoomLevel(j)}else{f+=Utilities.deCartaToGXZoomLevel(c)+":"+Utilities.deCartaToGXZoomLevel(j)}f+="'/></xls:TileGrid></xls:Output>"+a[0];if(Credentials.trafficEnabled){if(h){f+="<xls:Overlay><xls:Traffic><xls:FlowReporting/></xls:Traffic></xls:Overlay>"}else{f+="<xls:Overlay><xls:Traffic><xls:FlowReporting"+(h?" time='"+h+"'":"")+"/></xls:Traffic></xls:Overlay>"}}f+="</xls:PortrayMapRequest>";f+=this.getFooter();return f};deCarta.XMLStringBuilder.prototype.createGeocodeRequest=function(b,g,f,a){var c=this.getHeader("GeocodeRequest",g);c+="<xls:GeocodeRequest";if(f){c+=" returnFreeForm='true'>"}else{c+=" returnFreeForm='false'>"}if(a){c+='<xls:Point xmlns:xls="http://www.opengis.net/gml"><xls:pos>'+a.getLat()+" "+a.getLon()+"</xls:pos></xls:Point>"}c+="<xls:Address countryCode='"+b.getLocale().getCountry()+"'";c+=" language='"+b.getLocale().getLanguage()+"'>";if(b.type=="FreeForm"){c+="<xls:freeFormAddress>"+b.toString()+"</xls:freeFormAddress>"}else{var d="";var h="";if(!(b.buildingNumber&&b.street)&&(b.streetNameAndNumber)){c+="<xls:StreetNameAndNumber>"+b.streetNameAndNumber+"</xls:StreetNameAndNumber>"}else{if(b.buildingNumber||b.buildingNumber==0){d="<xls:Building number='"+b.buildingNumber+"'/>"}if(b.street){h="<xls:Street>"+b.street+"</xls:Street>"}if(b.street){c+="<xls:StreetAddress>"+d+h+"</xls:StreetAddress>"}}if(b.countrySubdivision){c+="<xls:Place type='CountrySubdivision'>"+b.countrySubdivision+"</xls:Place>"}if(b.countrySecondarySubdivision){c+="<xls:Place type='CountrySecondarySubdivision'>"+b.countrySecondarySubdivision+"</xls:Place>"}if(b.countryTertiarySubdivision){c+="<xls:Place type='CountryTertiarySubdivision'>"+b.countryTertiarySubdivision+"</xls:Place>"}if(b.municipality){c+="<xls:Place type='Municipality'>"+b.municipality+"</xls:Place>"}if(b.municipalitySubdivision){c+="<xls:Place type='MunicipalitySubdivision'>"+b.municipalitySubdivision+"</xls:Place>"}if(b.postalCode){c+="<xls:PostalCode>"+b.postalCode+"</xls:PostalCode>"}}c+="</xls:Address></xls:GeocodeRequest>";c+=this.getFooter();return c};deCarta.XMLStringBuilder.prototype.createReverseGeocodeRequest=function(c,b){var a=this.getHeader("ReverseGeocodeRequest",b);a+="<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+c.toString()+"</gml:pos></gml:Point></xls:Position>";a+="<xls:ReverseGeocodePreference>StreetAddress</xls:ReverseGeocodePreference>";a+="</xls:ReverseGeocodeRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createPOIRequest=function(c,f){var d=deCarta.Array.isArray(c);var b;var a="";if(d){a+=this.getRequestHeader(null,c.defaultUOM);for(b=0;b<c.length;b++){a+=this.getRequestOpen("DirectoryRequest",f,c[b].maximumResponses);a+=this.getDirectoryRequest(c[b]);a+="</xls:Request>"}a+="</xls:XLS>"}else{a+=this.getHeader("DirectoryRequest",f,c.maximumResponses,null,c.defaultUOM);a+=this.getDirectoryRequest(c);a+=this.getFooter()}return a};deCarta.XMLStringBuilder.prototype.createFullDetailsPOIRequest=function(c,b){var a=this.getHeader("DirectoryRequest",b,10);a+='<xls:DirectoryRequest paging="current"><xls:POI ID="'+c+'"/></xls:DirectoryRequest>';a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.getDirectoryRequest=function(d){var c="";c+="<xls:DirectoryRequest";if(d.database!=null){c+=" database='"+d.database+"'"}if(d.sortDirection){c+=" sortDirection='"+d.sortDirection+"'"}if(d.sortCriteria){c+=" sortCriteria='"+d.sortCriteria+"'"}if(d.rankCriteria){c+=" rankCriteria='"+d.rankCriteria+"'"}if(d.allowAggregates){c+=" allowAggregates='true'"}c+=">";if(d.routeId){c+="<xls:POILocation><xls:NearRoute>";if(d.type==="distance"){c+="<xls:distance value='"+d.distance+"' uom='M'/>"}else{if(d.type==="euclideanDistance"){c+="<xls:euclideanDistance value='"+d.distance+"' uom='M'/>"}else{c+="<xls:drivetime>P0DT"+Math.floor(d.duration/60)+"H"+(d.duration%60)+"M0S</xls:drivetime>"}}c+="<xls:RouteID>"+d.routeId+"</xls:RouteID>";c+="</xls:NearRoute></xls:POILocation>"}else{c+="<xls:POILocation><xls:WithinDistance>";c+="<xls:POI ID='1'><gml:Point><gml:pos>"+d.position.toString()+"</gml:pos></gml:Point></xls:POI>";c+="<xls:MinimumDistance value='0' uom='KM'/><xls:MaximumDistance value='"+d.radius.distance+"' uom='"+d.radius.uom.value+"'/>";c+="</xls:WithinDistance></xls:POILocation>"}c+="<xls:POIProperties>";if(!d.retrieveAll){var b=false;for(var a in d.properties){if(d.properties.hasOwnProperty(a)){b=true;c+="<xls:POIProperty value='"+d.properties[a]+"' name='"+a+"'/>"}}if(!b){c+="<xls:POIProperty value='"+d.queryString+"' name='Keyword'/>"}}c+="</xls:POIProperties></xls:DirectoryRequest>";return c};deCarta.XMLStringBuilder.prototype.createRouteGeometryRequest=function(a,g,f){var b=this.getHeader("DetermineRouteRequest",g);b+="<xls:DetermineRouteRequest distanceUnit='"+f.uom+"' routeQueryType='"+f.routeQueryType+"' provideRouteHandle='true'";if(f.alternateRoutes){b+=" numAltRoutes='"+f.alternateRoutes+"'"}b+=">";b+="<xls:RoutePlan";if(Credentials.trafficEnabled){b+=" useRealTimeTraffic='true'"}if(f.optimized){b+=" optimize='true'"}if(f.expectedStartTime){b+=" expectedStartTime='"+f.expectedStartTime+"'"}if(f.useExclusionZone==true){b+=" useExclusionZone='true'"}b+=">";b+="<xls:RoutePreference>"+f.routePreference+"</xls:RoutePreference>";b+="<xls:WayPointList>";for(var d=0;d<a.length;d++){if(d==0){b+="<xls:StartPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:StartPoint>"}else{if(d>0&&d<(a.length-1)){b+="<xls:ViaPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:ViaPoint>"}else{if(d==(a.length-1)){b+="<xls:EndPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:EndPoint>"}}}}b+="</xls:WayPointList>";if(f.vehicleType){b+="<xls:TypeOfVehicle>"+f.vehicleType+"</xls:TypeOfVehicle>"}if(f.avoidList.length>0||f.avoidAreas.length>0){b+="<xls:AvoidList>";for(d=0;d<f.avoidAreas.length;d++){b+=this.avoidAreasToXLSString(f.avoidAreas[d])}for(d=0;d<f.avoidList.length;d++){b+="<xls:AvoidFeature>"+f.avoidList[d].toString()+"</xls:AvoidFeature>"}b+="</xls:AvoidList>"}var c=f.logisticsPreference;if(c&&(c.preferredRoute||c.hazmat||c.vehicleParameters||c.vehicleTypes||c.preferredTurn)){b+="<xls:Logistics>";if(c.preferredRoute){b+="<xls:PreferredRoute>"+c.preferredRoute+"</xls:PreferredRoute>"}if(c.hazmat){b+="<xls:Hazmat>"+c.hazmat+"</xls:Hazmat>"}if(c.vehicleParameters){b+="<xls:VehicleParameters>"+c.vehicleParameters+"</xls:VehicleParameters>"}if(c.vehicleTypes){b+="<xls:VehicleTypes>"+c.vehicleTypes+"</xls:VehicleTypes>"}if(c.preferredTurn){b+="<xls:PreferredTurn>"+c.preferredTurn+"</xls:PreferredTurn>"}b+="</xls:Logistics>"}b+="</xls:RoutePlan>";if(f.returnRouteInstructions){b+="<xls:RouteInstructionsRequest providePoint='true'";if(f.rules){b+=" rules='"+f.rules+"'"}b+="/>"}b+="<xls:RouteGeometryRequest returnRouteIDOnly=";if(f.returnRouteGeometry){b+="'false'"}else{b+="'true'"}if(f.generalizationFactor&&f.generalizationFactor!==0&&f.generalizationBBox){b+=" resolution ='"+f.generalizationFactor+"'>";b+="<xls:BoundingBox><gml:pos>"+f.generalizationBBox.minPosition+"</gml:pos><gml:pos>"+f.generalizationBBox.maxPosition+"</gml:pos></xls:BoundingBox></xls:RouteGeometryRequest>"}else{b+="/>"}if(f.maneuverMaps){b+='<xls:RouteMapRequest><xls:Output format="'+f.maneuverMapConfig.format+'" width="'+f.maneuverMapConfig.width+'" height="'+f.maneuverMapConfig.height+'" /></xls:RouteMapRequest>'}b+="</xls:DetermineRouteRequest>";b+=this.getFooter();return b};deCarta.XMLStringBuilder.prototype.createRouteGeometryByIdRequest=function(d,c,b){var a=this.getHeader("DetermineRouteRequest",c,null,b);a+="<xls:DetermineRouteRequest routeQueryType='RMAN'><xls:RouteHandle serviceID='DetermineRouteService' routeID='"+d+"'/><xls:RouteInstructionsRequest providePoint='true'/><xls:RouteGeometryRequest/>";a+="</xls:DetermineRouteRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createTrafficIncidentRequest=function(b,c){var a=this.getHeader("TrafficRequest",c,b.maxiumResponses);a+="<xls:TrafficRequest><xls:IncidentReporting minimumSeverity='"+b.minimumSeverity+"'/>";a+="<xls:CenterContext SRS='WGS-84'><xls:CenterPoint><gml:pos>"+b.position+"</gml:pos></xls:CenterPoint>";a+="<xls:Radius unit='"+b.radius.uom.value+"'>"+b.radius.distance+"</xls:Radius></xls:CenterContext>";a+="</xls:TrafficRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.overlaysToXLSString=function(){var g=[];if(this.routeIDOverlay){g.push("<xls:Overlay><xls:RouteID>"+this.routeIDOverlay+"</xls:RouteID></xls:Overlay>")}for(var c=0;c<this.overlays.length;c++){if(this.overlays[c].rendering=="client"||(this.rendering!="server"&&this.overlays[c].rendering!="server")){continue}if(!this.overlays[c]||(this.overlays[c]&&!this.overlays[c].isVisible)){continue}var b="";var f=this.overlays[c];b+="<xls:Overlay>";if(f.type=="line"){b+="<xls:Shape color='"+f.fillColor+"_"+f.borderColor+"' style='"+f.borderStyle+"' width='"+f.width+"_"+f.borderWidth+"'";if(f.strokeOpacity){b+=" opacity='"+f.strokeOpacity+"'"}else{b+=" opacity='"+f.opacity+"'"}}else{b+="<xls:Shape type='"+f.type+"' color='"+f.fillColor+"_"+f.borderColor+"' style='"+f.borderStyle+"' width='"+f.borderWidth+"'";if(f.strokeOpacity||f.fillOpacity){var a=f.strokeOpacity||f.opacity;var d=f.fillOpacity||f.opacity;b+=" opacity='"+d+"_"+a+"'"}else{b+=" opacity='"+f.opacity+"'"}}if(f.type=="circle"){b+=" pointspec='LL' radius='"+f.radius.uomdds+f.radius.distance+"'>"+f.position.lat+","+f.position.lon}else{f.VR7=f.VR7||Utilities.LL2VR7(f.positions);if(f.type=="line"){b+=" pointspec='VR7'>"+f.VR7}else{b+=" pointspec='VR7PG'>"+f.VR7}}b+="</xls:Shape></xls:Overlay>";g.push(b)}var h=g.join("");return[h,(g.length>0)?true:false]};deCarta.XMLStringBuilder.prototype.avoidAreasToXLSString=function(b){var c;var a="<xls:AOI>";if(/Line/i.test(b.name)){a+="<gml:LineString>";for(c=0;c<b.pos.length;c++){a+="<gml:pos>"+b.pos[c]+"</gml:pos>"}a+="</gml:LineString>"}else{if(/Polygon/i.test(b.name)){a+="<gml:Polygon><gml:exterior><gml:LinearRing>";for(c=0;c<b.pos.length;c++){a+="<gml:pos>"+b.pos[c]+"</gml:pos>"}a+="</gml:LinearRing></gml:exterior></gml:Polygon>"}else{if(/Rectangle/i.test(b.name)){a+="<gml:Envelope>";a+="<gml:pos>"+b.pos[0]+"</gml:pos><gml:pos>"+b.pos[1]+"</gml:pos>";a+="</gml:Envelope>"}else{if(/Circle/i.test(b.name)){a+="<gml:CircleByCenterPoint numArc='1'>";a+="<gml:pos>"+b.pos[0]+"</gml:pos>";a+="<gml:radius uom='"+b.radius.uom+"'>"+b.radius.distance+"</gml:radius>";a+="</gml:CircleByCenterPoint>"}else{throw new Exception("deCarta.XMLStringBuilder.avoidAreasToXLSString: invalid type of avoid object: "+b.name)}}}}a+="</xls:AOI>";return a};function ZoomController(r,t,a,g,b,f,m){if(!m){m={}}this.opts={};this.setOpts=function(w){this.opts.xMargin=(w.xMargin)?w.xMargin:0;this.opts.yMargin=(w.yMargin)?w.yMargin:0};this.setOpts(m);this.selected=r||5;this.domView=true;this.zoomLevels=17;this.lowerBound=1;this.upperBound=17;this.color=t||"";this.uncheckedSrc=g||Credentials.zoomUnselectedIconPath;this.checkedSrc=a||Credentials.zoomSelectedIconPath;this.bottomCapSrc=f||Credentials.zoomOutIconPath;this.bottomCapSrc=Credentials.imgPath+"z2t_zoom_bottom_gray.png";this.topCapSrc=b||Credentials.zoomInIconPath;this.topCapSrc=Credentials.imgPath+"z2t_zoom_top_gray.png";this.pillarSrc=Credentials.imgPath+"z2t_zoom_rail_gray.png";this.sliderSrc=Credentials.imgPath+"z2t_zoom_selected_gray.png";this.zoomer=null;this.map=null;this.type="ZoomController";this.frame=null;var n=this;var d=null;var q=null;var v=null;var s=null;var l=false;var h=Utilities.ie;var j;var k;var o=true;this.setDomView=function(w){w=(w)?true:false;this.domView=w};this.initialize=function(){if(!this.domView){return false}d=document.createElement("IMG");d.id="decarta-ztop";d.src=this.topCapSrc;d.className="decarta-zoomTop";d.onclick=function(z){if(!GLOBALS.ALLOWDOMEVENTS){return true}z=z||event;z.stoppropagation?z.stoppropagation():z.cancelBubble=true;n.zoomInOneLevel();return true};deCarta.IdManager.setTag(d,"ignoreForMapEvents");v=document.createElement("DIV");v.style.backgroundImage="url("+this.pillarSrc+")";v.style.backgroundRepeat="repeat-y";v.style.backgroundPosition="center";v.id="decarta-zpillar";v.className="decarta-zoomPillar";v.onclick=function(B){if(!GLOBALS.ALLOWDOMEVENTS){return true}B=B||event;B.stoppropagation?B.stoppropagation():B.cancelBubble=true;var z=B.clientY-Utilities.getAbsoluteTop(v)+Utilities.getScrollTop();var A=parseInt(v.offsetHeight);var C=Math.round(z/A*(n.zoomLevels-1))+1;C+=(n.lowerBound-1);n.map.zoomMap(C);return true};deCarta.IdManager.setTag(v,"ignoreForMapEvents");s=document.createElement("IMG");s.src=this.sliderSrc;s.className="decarta-zoomSlider";s.id="decarta-zslider";deCarta.IdManager.setTag(s,"ignoreForMapEvents");s.onmousedown=function(z){if(!GLOBALS.ALLOWDOMEVENTS){return true}z=z?z:window.event;z.stoppropagation?z.stoppropagation():z.cancelBubble=true;if((!h&&z.which==3)||(h&&z.button==2)){return true}if((!h&&z.which==2)||(h&&z.button==4)){return true}l=true;s.style.cursor="move";document.body.onmousemove=p;document.body.onmouseup=u;return false};v.appendChild(s);q=document.createElement("IMG");q.src=this.bottomCapSrc;q.id="decarta-zbottom";q.className="decarta-zoomBottom";q.onclick=function(z){if(!GLOBALS.ALLOWDOMEVENTS){return true}z=z||event;z.stoppropagation?z.stoppropagation():z.cancelBubble=true;n.zoomOutOneLevel();return true};deCarta.IdManager.setTag(q,"ignoreForMapEvents");var y="decarta-zoom";var w=y;n.frame=document.createElement("DIV");n.frame.id=y;n.frame.className=w;n.frame.innerHTML="";if(n.color){n.frame.style.backgroundColor=n.color}deCarta.IdManager.setTag(n.frame,"ignoreForMapEvents");n.frame.appendChild(d);n.frame.appendChild(v);n.frame.appendChild(q);this.zoomer=this.frame;if(!o){this.frame.style.display="none"}c();return true};function u(y){document.body.onmousemove=null;document.body.onmouseup=null;l=false;s.style.cursor="default";y=y?y:window.event;y.stoppropagation?y.stoppropagation():y.cancelBubble=true;var w=y.clientY-Utilities.getAbsoluteTop(v)+Utilities.getScrollTop();var z=Math.round(w/v.offsetHeight*(n.zoomLevels-1))+1;z+=(n.lowerBound-1);if(z<1){z=1}if(z>17){z=17}n.map.zoomMap(z);return false}function p(A){A=A?A:window.event;if(!l){return false}var z=s.offsetHeight/2;var y=v.offsetHeight-s.offsetHeight/2;var w=A.clientY-Utilities.getAbsoluteTop(v)+Utilities.getScrollTop();if(w<=y&&w>=z){s.style.top=w-s.offsetHeight/2+"px"}return false}this.setZoomRange=function(w,y){if(w<1||y>21||w>y){throw new Exception("illegal values setZoomRange: "+w+", "+y)}if(n.selected>y){n.selected=y}if(n.selected<w){n.selected=w}n.lowerBound=w;n.upperBound=y;n.zoomLevels=y-w+1;c()};this.setZoomButtonImages=function(A,z,w,B){if(A){this.checkedSrc=A}if(z){this.uncheckedSrc=z}if(A||z){for(var y=0;y<_zoomButtons.length;y++){_zoomButtons[y].src=this.uncheckedSrc}if(n.selected){_zoomButtons[n.selected-1].src=this.checkedSrc}}if(w){this.topCapSrc=w;d.src=w}if(B){this.bottomCapSrc=B;q.src=B}};this.setColor=function(w){this.frame.style.backgroundColor=w};this.show=function(){o=true;if(this.frame){this.frame.style.display="block"}};this.hide=function(){o=false;if(this.frame){this.frame.style.display="none"}};this.getRadius=function(){return j};this.setRadius=function(A){k=A;var z=n.map.getGridSize().split(" ");var B=z[0];var w=z[1];if(B==w){j=A}else{j=(k/w)*B}};this.getRadiusX=function(){return k};this.setRadiusX=function(w){k=w};this.getMinViewableRadius=function(){var B=n.map.getGridSize().split(" ");var z=B[0]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var A=B[1]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var D=parseInt(n.map.mapDiv.style.width);var C=parseInt(n.map.mapDiv.style.height);var y=(D/A)*k;var w=(C/z)*j;return w<y?w:y};this.getMaxViewableRadius=function(){var B=n.map.getGridSize().split(" ");var z=B[0]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var A=B[1]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var D=parseInt(n.map.mapDiv.style.width);var C=parseInt(n.map.mapDiv.style.height);var y=(D/A)*k;var w=(C/z)*j;return w>y?w:y};this.getMaxRadius=function(){return k<j?j:k};this.getZoomLevel=function(){return n.selected};this.setZoomValue=function(w){this.setZoomLevel(w)};this.setZoomLevel=function(z){if(z&&z<n.lowerBound||z>n.upperBound){throw new Exception("Error calling setZoomLevel, out of range");return false}n.selected=z;if(s&&s.style){var w=parseInt(v.offsetHeight);var y=parseInt(s.offsetHeight);z=z-(n.lowerBound-1);s.style.top=(z-1/2)*w/n.zoomLevels-1/2*y+"px";v.removeChild(s);v.appendChild(s)}};this.getGXConvertedZoomLevel=function(){return Math.abs(21-n.selected)};this.zoomToNewLevel=function(w){if(w&&w<n.lowerBound||w>n.upperBound){throw new Exception("Error calling zoomToNewLevel, out of range");return false}n.map.zoomMap(w)};this.zoomInOneLevel=function(){if(n.selected<=n.lowerBound){return false}n.map.zoomMap(parseInt(n.selected)-1)};this.zoomOutOneLevel=function(){if(n.selected==n.upperBound){return false}n.map.zoomMap(parseInt(n.selected)+1)};this.getZoomLevelToFitBoundingBox=function(A){var E=parseInt(n.map.mapDiv.style.height)/2;var F=parseInt(n.map.mapDiv.style.width)/2;for(var C=20;C>0;--C){var z=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),C);var H=Utilities.lat2pix(A.getCenterPosition().getLat(),z);var K=Utilities.lon2pix(A.getCenterPosition().getLon(),z);var B=Utilities.pix2lat(H+E,z);var I=Utilities.pix2lon(K+F,z);var y=Utilities.pix2lat(H-E,z);var G=Utilities.pix2lon(K-F,z);var w=new BoundingBox(new Position(y,G),new Position(B,I));if(w.contains(A.minPosition)&&w.contains(A.maxPosition)){var D=Math.abs(21-C);D=(D<n.lowerBound?n.lowerBound:D);return D;break}}};this.getZoomLevelToFitPositions=function(w){var y=Utilities.positionsToBoundingBox(w);return n.getZoomLevelToFitBoundingBox(y)};this.getZoomLevelToFitPins=function(A){var y=[];for(var z=0;z<A.length;z++){y[z]=A[z].position.clone()}var B=Utilities.positionsToBoundingBox(y);var C=n.getZoomLevelToFitBoundingBox(B);var w=Utilities.radsPerPixelAtZoom(n.map.getTileSize(),Math.abs(21-C));B=Utilities.pinsToBoundingBox(A,w);return n.getZoomLevelToFitBoundingBox(B)};this.getClosestValidLevel=function(w){if(w<this.lowerBound){return this.lowerBound}if(w>this.upperBound){return this.upperBound}return w};this.appendThis=function(){if(!this.frame){this.initialize()}var w=this.frame||null;return w};this.removeThis=function(){this.map=null;return this.frame};this.position=function(w){if(!this.map){return}if(this.frame){switch(this.opts.screenPosition){default:if(this.map.getPanController()){this.frame.style.top=61+this.opts.yMargin+"px";this.frame.style.left=21+this.opts.xMargin+"px"}else{this.frame.style.top="10px";this.frame.style.left="10px"}break;case"topRight":throw ("Not Implemented");break}this.setZoomLevel(n.selected)}};function c(){if(n.frame){v.style.height=(n.zoomLevels*10)+"px";q.style.top=((n.zoomLevels*10)+20)+"px"}}};